<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="application-name" content="Momentum MAX">
    
    <title>Momentum MAX | Ultimate Edition</title>

    <script>
        window.onerror = function(msg, url, line) {
            const container = document.createElement('div');
            container.style.cssText = "position:fixed; top:0; left:0; width:100%; height:100%; background:#0f172a; color:#ef4444; z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px; font-family:system-ui;";
            container.innerHTML = `<h1 style="font-size:24px; margin-bottom:10px">‚ö†Ô∏è SYSTEM FAILURE</h1><p style="text-align:center; opacity:0.8">${msg}</p><div style="background:#1e293b; padding:10px; border-radius:8px; margin-top:20px; font-family:monospace;">Line: ${line}</div><button onclick="localStorage.clear();window.location.reload()" style="margin-top:40px; background:#ef4444; color:white; border:none; padding:15px 30px; border-radius:12px; font-weight:800;">HARD RESET</button>`;
            document.body.appendChild(container);
        };
    </script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           1. PHYSICS ENGINE & CORE STYLES
           ========================================= */
        :root {
            --app-bg: #0f172a;
            --primary: #6366f1;
            --primary-glow: rgba(99, 102, 241, 0.5);
            --glass-surface: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --ease-elastic: cubic-bezier(0.34, 1.56, 0.64, 1);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
            user-select: none;
            touch-action: manipulation;
        }

        [dir="rtl"] * { font-family: 'Tajawal', sans-serif; }

        body {
            background-color: var(--app-bg);
            color: var(--text-main);
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            margin: 0;
            perspective: 1000px; /* Activates 3D space */
        }

        /* --- 3D CARD SYSTEM --- */
        .card-3d-wrapper {
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        .card-3d {
            background: linear-gradient(145deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out, box-shadow 0.3s ease;
            box-shadow: 
                0 20px 40px -10px rgba(0,0,0,0.5),
                0 0 0 1px rgba(255,255,255,0.05) inset;
        }

        .card-3d:active {
            transform: scale(0.96) rotateX(2deg);
        }

        /* --- ADVANCED ANIMATIONS --- */
        @keyframes float-y {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-12px); }
        }
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 var(--primary-glow); }
            70% { box-shadow: 0 0 0 15px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }
        @keyframes shine-sweep {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(200%) rotate(45deg); }
        }
        @keyframes pop-in {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes slide-up-enter {
            from { transform: translateY(100vh); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .animate-float { animation: float-y 6s ease-in-out infinite; }
        .animate-pop { animation: pop-in 0.5s var(--ease-elastic) forwards; }
        .animate-slide-up { animation: slide-up-enter 0.6s var(--ease-smooth) forwards; }
        
        .shimmer {
            position: relative;
            overflow: hidden;
        }
        .shimmer::after {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 50%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: skewX(-20deg) translateX(-150%);
            animation: shine-sweep 3s infinite;
        }

        /* --- UI COMPONENTS --- */
        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            color: white;
            box-shadow: 0 10px 30px -10px rgba(99, 102, 241, 0.5);
            transition: all 0.2s var(--ease-smooth);
        }
        .btn-primary:active { transform: scale(0.95); filter: brightness(1.1); }

        .input-glass {
            background: rgba(0,0,0,0.2);
            border: 2px solid rgba(255,255,255,0.1);
            color: white;
            transition: all 0.3s;
        }
        .input-glass:focus {
            border-color: var(--primary);
            background: rgba(0,0,0,0.4);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .progress-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 999px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #ec4899);
            transition: width 1s var(--ease-smooth);
        }

        /* --- BACKGROUND FX --- */
        .blob-bg {
            position: fixed;
            filter: blur(100px);
            z-index: -1;
            opacity: 0.4;
            border-radius: 50%;
            animation: float-y 10s infinite reverse;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, createContext, useContext, useRef, useMemo } = React;

        // =========================================
        // 2. ICON SYSTEM (Embedded SVG Library)
        // =========================================
        const Icons = {
            check: <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />,
            lock: <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />,
            user: <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />,
            star: <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />,
            target: <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />,
            brain: <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />,
            wallet: <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />,
            globe: <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />,
            crown: <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
        };

        const Icon = ({ name, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} fill="none" viewBox="0 0 24 24" stroke="currentColor" className={className}>
                {Icons[name] || Icons.star}
            </svg>
        );

        // =========================================
        // 3. AUDIO SYNTHESIZER (No External Files)
        // =========================================
        class AudioEngine {
            constructor() {
                this.ctx = null;
                this.enabled = true;
            }

            init() {
                if (!this.ctx && (window.AudioContext || window.webkitAudioContext)) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.ctx && this.ctx.state === 'suspended') {
                    this.ctx.resume();
                }
            }

            play(type) {
                if (!this.enabled) return;
                this.init();
                if (!this.ctx) return;

                const t = this.ctx.currentTime;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                osc.connect(gain);
                gain.connect(this.ctx.destination);

                if (type === 'tap') {
                    // Soft UI Click
                    osc.frequency.setValueAtTime(400, t);
                    osc.frequency.exponentialRampToValueAtTime(600, t + 0.05);
                    gain.gain.setValueAtTime(0.05, t);
                    gain.gain.exponentialRampToValueAtTime(0.001, t + 0.05);
                    osc.start(t);
                    osc.stop(t + 0.05);
                } else if (type === 'success') {
                    // Success Chord
                    const freqs = [523.25, 659.25, 783.99, 1046.50];
                    freqs.forEach((f, i) => {
                        const o = this.ctx.createOscillator();
                        const g = this.ctx.createGain();
                        o.connect(g);
                        g.connect(this.ctx.destination);
                        o.type = 'triangle';
                        o.frequency.value = f;
                        g.gain.setValueAtTime(0.05, t + i*0.05);
                        g.gain.linearRampToValueAtTime(0.001, t + i*0.05 + 0.4);
                        o.start(t + i*0.05);
                        o.stop(t + i*0.05 + 0.4);
                    });
                } else if (type === 'toggle') {
                    // Toggle Switch
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(200, t);
                    gain.gain.setValueAtTime(0.02, t);
                    gain.gain.linearRampToValueAtTime(0.001, t + 0.1);
                    osc.start(t);
                    osc.stop(t + 0.1);
                }
            }
        }
        
        const Sfx = new AudioEngine();

        // =========================================
        // 4. STORAGE & STATE MANAGEMENT
        // =========================================
        const APP_VERSION = '1.0';
        
        const DEFAULT_STATE = {
            user: { name: '', avatar: null, goal: null, xp: 0, level: 1, isPro: false, joinedAt: null },
            settings: { lang: 'en', sound: true, haptics: true, theme: 'midnight' },
            habits: [],
            friends: [],
            logs: {},
            onboardingStep: 0 // 0 = Language, 1 = Intro, 2 = Name, 3 = Goal, 4 = Paywall, 5 = Done
        };

        const useAppStore = () => {
            const [state, setState] = useState(() => {
                try {
                    const local = localStorage.getItem('momentum_max_v1');
                    return local ? { ...DEFAULT_STATE, ...JSON.parse(local) } : DEFAULT_STATE;
                } catch { return DEFAULT_STATE; }
            });

            const save = (newState) => {
                const final = { ...state, ...newState };
                setState(final);
                localStorage.setItem('momentum_max_v1', JSON.stringify(final));
            };

            return { state, save };
        };

        // =========================================
        // 5. TRANSLATIONS DATABASE
        // =========================================
        const LANG = {
            en: {
                welcome: "Welcome to Momentum MAX",
                tagline: "The ultimate system for high performers.",
                selectLang: "Select Language",
                continue: "Continue",
                nameQ: "What should we call you?",
                namePlace: "Enter your name",
                goalQ: "What is your main focus?",
                goals: [
                    { id: 'fit', label: 'Physical Health', desc: 'Build muscle & endurance', icon: 'star' },
                    { id: 'mind', label: 'Mental Clarity', desc: 'Reduce stress & anxiety', icon: 'brain' },
                    { id: 'work', label: 'Deep Work', desc: 'Maximize productivity', icon: 'target' },
                    { id: 'rich', label: 'Build Wealth', desc: 'Financial freedom', icon: 'wallet' }
                ],
                paywallTitle: "Unlock Your Full Potential",
                paywallSub: "Join the top 1% of achievers.",
                features: ["Unlimited Habits", "AI Smart Coach", "Cloud Sync", "Dark Mode"],
                trial: "Start 7-Day Free Trial",
                free: "Continue with Free Plan",
                loading: "Building your dashboard..."
            },
            ar: {
                welcome: "ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÖŸàŸÖŸÜÿ™ŸÖ ŸÖÿßŸÉÿ≥",
                tagline: "ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ™ŸÉÿßŸÖŸÑ ŸÑŸÑÿ£ÿØÿßÿ° ÿßŸÑÿπÿßŸÑŸä.",
                selectLang: "ÿßÿÆÿ™ÿ± ÿßŸÑŸÑÿ∫ÿ©",
                continue: "ŸÖÿ™ÿßÿ®ÿπÿ©",
                nameQ: "ŸÖÿß ŸáŸà ÿßÿ≥ŸÖŸÉÿü",
                namePlace: "ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖŸÉ ŸáŸÜÿß",
                goalQ: "ŸÖÿß ŸáŸà ÿ™ÿ±ŸÉŸäÿ≤ŸÉ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿü",
                goals: [
                    { id: 'fit', label: 'ÿßŸÑÿµÿ≠ÿ© ÿßŸÑÿ®ÿØŸÜŸäÿ©', desc: 'ÿ®ŸÜÿßÿ° ÿßŸÑÿπÿ∂ŸÑÿßÿ™ ŸàÿßŸÑŸÑŸäÿßŸÇÿ©', icon: 'star' },
                    { id: 'mind', label: 'ÿßŸÑÿµŸÅÿßÿ° ÿßŸÑÿ∞ŸáŸÜŸä', desc: 'ÿ™ŸÇŸÑŸäŸÑ ÿßŸÑÿ™Ÿàÿ™ÿ± ŸàÿßŸÑŸÇŸÑŸÇ', icon: 'brain' },
                    { id: 'work', label: 'ÿßŸÑÿπŸÖŸÑ ÿßŸÑÿπŸÖŸäŸÇ', desc: 'ÿ≤ŸäÿßÿØÿ© ÿßŸÑÿ•ŸÜÿ™ÿßÿ¨Ÿäÿ© ŸàÿßŸÑÿ™ÿ±ŸÉŸäÿ≤', icon: 'target' },
                    { id: 'rich', label: 'ÿ®ŸÜÿßÿ° ÿßŸÑÿ´ÿ±Ÿàÿ©', desc: 'ÿßŸÑÿßÿ≥ÿ™ŸÇŸÑÿßŸÑ ÿßŸÑŸÖÿßŸÑŸä', icon: 'wallet' }
                ],
                paywallTitle: "ÿ£ÿ∑ŸÑŸÇ ÿßŸÑÿπŸÜÿßŸÜ ŸÑŸÇÿØÿ±ÿßÿ™ŸÉ",
                paywallSub: "ÿßŸÜÿ∂ŸÖ ÿ•ŸÑŸâ ÿµŸÅŸàÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ.",
                features: ["ÿπÿßÿØÿßÿ™ ÿ∫Ÿäÿ± ŸÖÿ≠ÿØŸàÿØÿ©", "ÿßŸÑŸÖÿØÿ±ÿ® ÿßŸÑÿ∞ŸÉŸä", "ŸÖÿ≤ÿßŸÖŸÜÿ© ÿ≥ÿ≠ÿßÿ®Ÿäÿ©", "ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä"],
                trial: "ÿßÿ®ÿØÿ£ ÿ™ÿ¨ÿ±ÿ®ÿ© ŸÖÿ¨ÿßŸÜŸäÿ© 7 ÿ£ŸäÿßŸÖ",
                free: "ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ© ÿ®ÿßŸÑÿÆÿ∑ÿ© ÿßŸÑŸÖÿ¨ÿßŸÜŸäÿ©",
                loading: "ÿ¨ÿßÿ±Ÿä ÿ•ÿπÿØÿßÿØ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ..."
            }
        };

        // =========================================
        // 6. UI COMPONENTS
        // =========================================
        
        const Button = ({ children, onClick, variant = 'primary', className = "", ...props }) => {
            const base = "relative w-full py-4 rounded-2xl font-bold text-lg transition-all duration-200 active:scale-95 flex items-center justify-center gap-2";
            const styles = {
                primary: "btn-primary shadow-lg shadow-indigo-500/30",
                secondary: "bg-slate-800 text-white border border-slate-700 hover:bg-slate-700",
                ghost: "bg-transparent text-slate-400 hover:text-white"
            };
            
            return (
                <button 
                    onClick={(e) => { Sfx.play('tap'); onClick && onClick(e); }} 
                    className={`${base} ${styles[variant]} ${className}`}
                    {...props}
                >
                    {children}
                </button>
            );
        };

        const Card = ({ children, selected, onClick, className = "" }) => (
            <div 
                onClick={(e) => { Sfx.play('tap'); onClick && onClick(e); }}
                className={`
                    relative p-5 rounded-3xl border transition-all duration-300 cursor-pointer overflow-hidden group
                    ${selected 
                        ? 'bg-indigo-600 border-indigo-400 shadow-xl shadow-indigo-900/50 scale-[1.02]' 
                        : 'bg-slate-800/50 border-slate-700 hover:bg-slate-800 hover:border-slate-600'}
                    ${className}
                `}
            >
                {selected && <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent shimmer" />}
                {children}
            </div>
        );

        // =========================================
        // 7. ONBOARDING SCREENS
        // =========================================
        const Onboarding = ({ state, update }) => {
            const [localName, setLocalName] = useState("");
            const t = LANG[state.settings.lang];
            const isRTL = state.settings.lang === 'ar';

            const next = () => update({ onboardingStep: state.onboardingStep + 1 });

            // Screen 0: Language
            if (state.onboardingStep === 0) return (
                <div className="h-screen flex flex-col items-center justify-center p-8 animate-pop">
                    <div className="text-6xl mb-6 animate-float">üåç</div>
                    <h1 className="text-3xl font-bold mb-8 text-center">{t.selectLang}</h1>
                    <div className="space-y-4 w-full max-w-sm">
                        <Button variant="secondary" onClick={() => update({ settings: { ...state.settings, lang: 'en' }, onboardingStep: 1 })}>
                            üá∫üá∏ English
                        </Button>
                        <Button variant="secondary" onClick={() => update({ settings: { ...state.settings, lang: 'ar' }, onboardingStep: 1 })}>
                            üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                        </Button>
                    </div>
                </div>
            );

            // Screen 1: Welcome
            if (state.onboardingStep === 1) return (
                <div className="h-screen flex flex-col justify-between p-8 animate-slide-up" dir={isRTL ? 'rtl' : 'ltr'}>
                    <div className="mt-20">
                        <div className="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center mb-6 shadow-xl shadow-indigo-500/20">
                            <Icon name="star" className="text-white w-8 h-8" />
                        </div>
                        <h1 className="text-4xl font-black leading-tight mb-4">{t.welcome}</h1>
                        <p className="text-slate-400 text-lg">{t.tagline}</p>
                    </div>
                    <Button onClick={next}>{t.continue}</Button>
                </div>
            );

            // Screen 2: Name
            if (state.onboardingStep === 2) return (
                <div className="h-screen flex flex-col justify-between p-8 animate-slide-up" dir={isRTL ? 'rtl' : 'ltr'}>
                    <div className="mt-20">
                        <h2 className="text-3xl font-bold mb-8">{t.nameQ}</h2>
                        <input 
                            value={localName}
                            onChange={(e) => setLocalName(e.target.value)}
                            placeholder={t.namePlace}
                            className="w-full bg-transparent border-b-2 border-slate-700 text-3xl font-bold py-4 focus:outline-none focus:border-indigo-500 transition-colors text-center placeholder:text-slate-600"
                            autoFocus
                        />
                    </div>
                    <Button 
                        disabled={!localName} 
                        onClick={() => update({ user: { ...state.user, name: localName }, onboardingStep: 3 })}
                    >
                        {t.continue}
                    </Button>
                </div>
            );

            // Screen 3: Goal
            if (state.onboardingStep === 3) return (
                <div className="h-screen flex flex-col p-6 animate-slide-up" dir={isRTL ? 'rtl' : 'ltr'}>
                    <h2 className="text-2xl font-bold mb-6 mt-10">{t.goalQ}</h2>
                    <div className="space-y-3 flex-1 overflow-y-auto pb-4">
                        {t.goals.map(g => (
                            <Card 
                                key={g.id} 
                                onClick={() => update({ user: { ...state.user, goal: g.id }, onboardingStep: 4 })}
                                className="flex items-center gap-4"
                            >
                                <div className="p-3 bg-white/10 rounded-xl">
                                    <Icon name={g.icon} className="text-indigo-400" />
                                </div>
                                <div>
                                    <h3 className="font-bold text-lg">{g.label}</h3>
                                    <p className="text-sm text-slate-400">{g.desc}</p>
                                </div>
                            </Card>
                        ))}
                    </div>
                </div>
            );

            // Screen 4: Paywall
            if (state.onboardingStep === 4) return (
                <div className="h-screen flex flex-col p-6 animate-pop relative overflow-hidden" dir={isRTL ? 'rtl' : 'ltr'}>
                    {/* Background FX */}
                    <div className="blob-bg top-0 right-0 w-64 h-64 bg-indigo-600"></div>
                    <div className="blob-bg bottom-0 left-0 w-64 h-64 bg-pink-600"></div>

                    <div className="flex-1 flex flex-col items-center justify-center text-center z-10">
                        <div className="text-6xl mb-6 animate-float">üíé</div>
                        <h2 className="text-3xl font-black mb-2">{t.paywallTitle}</h2>
                        <p className="text-slate-300 mb-8">{t.paywallSub}</p>

                        <div className="w-full bg-slate-800/50 backdrop-blur-xl rounded-3xl p-6 border border-white/10 mb-8">
                            <ul className="space-y-4 text-left">
                                {t.features.map((f, i) => (
                                    <li key={i} className="flex items-center gap-3">
                                        <div className="w-6 h-6 rounded-full bg-green-500/20 text-green-400 flex items-center justify-center">
                                            <Icon name="check" size={14} />
                                        </div>
                                        <span className="font-medium">{f}</span>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    </div>

                    <div className="z-10 space-y-4">
                        <Button 
                            onClick={() => { Sfx.play('success'); update({ user: { ...state.user, isPro: true, joinedAt: new Date() }, onboardingStep: 5 }); }}
                            className="pulse-ring"
                        >
                            {t.trial}
                        </Button>
                        <button 
                            onClick={() => update({ user: { ...state.user, isPro: false, joinedAt: new Date() }, onboardingStep: 5 })}
                            className="w-full text-center text-sm text-slate-400 font-medium py-2"
                        >
                            {t.free}
                        </button>
                    </div>
                </div>
            );

            return null;
        };

        // =========================================
        // 8. APP ROOT
        // =========================================
        function App() {
            const { state, save } = useAppStore();
            const [loading, setLoading] = useState(false);

            // If onboarding is not done (step < 5)
            if (state.onboardingStep < 5) {
                return <Onboarding state={state} update={save} />;
            }

            // Part 2 Placeholder
            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-slate-900 text-white animate-pop">
                    <div className="w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                    <p className="font-bold opacity-50">{LANG[state.settings.lang].loading}</p>
                </div>
            );

            return (
                <div className="h-screen w-screen flex flex-col items-center justify-center bg-slate-900 text-white animate-pop">
                    <h1 className="text-2xl font-bold mb-4">Part 1 Complete ‚úÖ</h1>
                    <p className="text-slate-400 mb-8 max-w-xs text-center">Your data (Name, Goal, Language, Pro Status) has been securely saved.</p>
                    <Button onClick={() => { localStorage.clear(); window.location.reload(); }} variant="danger" className="bg-red-500/20 text-red-400">
                        Reset Demo
                    </Button>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
