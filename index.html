<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Momentum MAX">
    <title>Momentum MAX | Enterprise Edition</title>

    <script>
        window.onerror = function(msg, url, line) {
            document.body.innerHTML = `
                <div style="background:#000;color:#ef4444;height:100vh;padding:2rem;font-family:monospace;display:flex;flex-direction:column;justify-content:center;">
                    <h1 style="font-size:2rem;margin-bottom:1rem">SYSTEM KERNEL PANIC</h1>
                    <p style="opacity:0.7">${msg}</p>
                    <div style="background:#222;padding:1rem;margin:1rem 0;border-radius:8px">Line: ${line}</div>
                    <button onclick="localStorage.clear();window.location.reload()" style="background:#ef4444;color:white;border:none;padding:1rem;border-radius:8px;font-weight:bold;margin-top:2rem">HARD RESET DATABASE</button>
                </div>`;
        };
    </script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           ATLAS DESIGN SYSTEM (v1.0)
           ========================================= */
        :root {
            /* Palette: Midnight Nebula */
            --c-bg-main: #020617;
            --c-bg-card: rgba(30, 41, 59, 0.6);
            --c-bg-glass: rgba(255, 255, 255, 0.03);
            --c-primary: #6366f1;
            --c-primary-glow: rgba(99, 102, 241, 0.4);
            --c-accent: #ec4899;
            --c-success: #10b981;
            --c-danger: #ef4444;
            --c-text-main: #f8fafc;
            --c-text-muted: #94a3b8;
            
            /* Physics & Timing */
            --ease-elastic: cubic-bezier(0.34, 1.56, 0.64, 1);
            --ease-out-expo: cubic-bezier(0.19, 1, 0.22, 1);
            --duration-fast: 200ms;
            --duration-normal: 400ms;
            --duration-slow: 800ms;
            
            /* Dimensions */
            --card-radius: 24px;
            --btn-radius: 16px;
            --input-radius: 12px;
        }

        /* RESET & BASE */
        * { font-family: 'Outfit', sans-serif; -webkit-tap-highlight-color: transparent; box-sizing: border-box; touch-action: manipulation; user-select: none; }
        [dir="rtl"] * { font-family: 'Tajawal', sans-serif; }
        
        body {
            background-color: var(--c-bg-main);
            color: var(--c-text-main);
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            perspective: 1200px;
        }

        /* 3D CARD ENGINE */
        .card-3d-wrapper {
            perspective: 1000px;
            transform-style: preserve-3d;
        }
        
        .card-3d {
            position: relative;
            background: linear-gradient(145deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 100%);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 
                0 20px 40px -10px rgba(0,0,0,0.6),
                inset 0 1px 0 rgba(255,255,255,0.1);
            transform-style: preserve-3d;
            transition: transform 0.1s linear, box-shadow 0.3s var(--ease-out-expo);
        }
        
        .card-3d::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(800px circle at var(--mouse-x) var(--mouse-y), rgba(255,255,255,0.06), transparent 40%);
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
            border-radius: inherit;
        }
        
        .card-3d:hover::after { opacity: 1; }
        .card-3d:active { transform: scale(0.96) rotateX(2deg); }

        /* ADVANCED ANIMATIONS */
        @keyframes float-y { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes pulse-ring { 0% { box-shadow: 0 0 0 0 var(--c-primary-glow); } 70% { box-shadow: 0 0 0 20px transparent; } 100% { box-shadow: 0 0 0 0 transparent; } }
        @keyframes enter-slide-up { from { transform: translateY(120%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes enter-pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes shimmer-sweep { 0% { transform: translateX(-150%) skewX(-20deg); } 100% { transform: translateX(250%) skewX(-20deg); } }

        .anim-enter-slide { animation: enter-slide-up 0.8s var(--ease-out-expo) forwards; }
        .anim-enter-pop { animation: enter-pop 0.5s var(--ease-elastic) forwards; }
        .anim-float { animation: float-y 8s ease-in-out infinite; }
        .anim-pulse { animation: pulse-ring 3s infinite; }

        /* COMPONENT UTILS */
        .btn-primary {
            background: linear-gradient(135deg, var(--c-primary) 0%, #8b5cf6 100%);
            color: white;
            box-shadow: 0 8px 32px -8px var(--c-primary-glow);
            transition: all 0.2s;
        }
        .btn-primary:active { transform: scale(0.94); filter: brightness(1.1); }
        
        .shimmer-text {
            background: linear-gradient(90deg, #fff 0%, #a5b4fc 50%, #fff 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: textShine 3s linear infinite;
        }
        @keyframes textShine { to { background-position: 200% center; } }

        .input-hollow {
            background: transparent;
            border: none;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            border-radius: 0;
            color: white;
            transition: 0.3s;
        }
        .input-hollow:focus {
            outline: none;
            border-color: var(--c-primary);
            background: linear-gradient(to top, rgba(99, 102, 241, 0.1), transparent);
        }

        /* BACKGROUND FX */
        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(120px);
            z-index: -1;
            opacity: 0.3;
        }
        .orb-1 { top: -20%; left: -20%; width: 500px; height: 500px; background: var(--c-primary); animation: float-y 10s infinite; }
        .orb-2 { bottom: -20%; right: -20%; width: 600px; height: 600px; background: var(--c-accent); animation: float-y 12s infinite reverse; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, createContext, useContext, useReducer, useRef } = React;

        // =========================================
        // PART 1: THE VECTOR VAULT (Icons)
        // =========================================
        const Icons = {
            bolt: <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            user: <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2 M12 3a4 4 0 1 0 0 8 4 4 0 0 0 0-8z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            chart: <path d="M18 20V10 M12 20V4 M6 20v-6" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            settings: <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            check: <path d="M20 6L9 17l-5-5" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            lock: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            star: <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            fire: <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.6-3.3a7 7 0 0 0 .9 2.8z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            brain: <path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            wallet: <path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><path d="M4 6v12c0 1.1.9 2 2 2h14v-4" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            target: <circle cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="2"/><circle cx="12" cy="12" r="6" stroke="currentColor" strokeWidth="2"/><circle cx="12" cy="12" r="2" stroke="currentColor" strokeWidth="2"/>,
            chevronRight: <path d="M9 18l6-6-6-6" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
        };

        const Icon = ({ name, size=24, className="" }) => (
            <svg viewBox="0 0 24 24" width={size} height={size} fill="none" className={className}>{Icons[name]}</svg>
        );

        // =========================================
        // PART 2: THE SYNTHESIZER (Audio Engine)
        // =========================================
        class AudioSystem {
            constructor() { this.ctx = null; }
            init() { if (!this.ctx && (window.AudioContext || window.webkitAudioContext)) { this.ctx = new (window.AudioContext || window.webkitAudioContext)(); } if(this.ctx && this.ctx.state === 'suspended') this.ctx.resume(); }
            
            play(type) {
                this.init(); if (!this.ctx) return;
                const t = this.ctx.currentTime;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain); gain.connect(this.ctx.destination);

                if (type === 'tap') {
                    osc.frequency.setValueAtTime(400, t);
                    osc.frequency.exponentialRampToValueAtTime(600, t + 0.05);
                    gain.gain.setValueAtTime(0.05, t);
                    gain.gain.exponentialRampToValueAtTime(0.001, t + 0.05);
                    osc.start(t); osc.stop(t + 0.05);
                }
                else if (type === 'success') {
                    // C Major Chord
                    [523.25, 659.25, 783.99, 1046.50].forEach((f, i) => {
                        const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
                        o.connect(g); g.connect(this.ctx.destination);
                        o.type = 'triangle'; o.frequency.value = f;
                        g.gain.setValueAtTime(0.05, t + i*0.05);
                        g.gain.linearRampToValueAtTime(0.001, t + i*0.05 + 0.5);
                        o.start(t + i*0.05); o.stop(t + i*0.05 + 0.5);
                    });
                }
            }
        }
        const Sfx = new AudioSystem();

        // =========================================
        // PART 3: THE BRAIN (State & Storage)
        // =========================================
        const APP_VERSION = 'MAX_1.0';
        
        const DEFAULT_STATE = {
            user: { 
                id: 'USR_'+Date.now(), 
                name: '', 
                avatar: 'ü¶Å', 
                goal: null, 
                xp: 0, 
                level: 1, 
                isPro: false,
                streak: 0,
                joinedAt: null 
            },
            settings: { lang: 'en', sound: true, haptics: true, theme: 'midnight' },
            habits: [],
            friends: [],
            logs: {}, // { '2023-10-20': { habitId: 1 } }
            onboardingStep: 0 // 0=Lang, 1=Intro, 2=Name, 3=Goal, 4=Paywall, 5=Dashboard
        };

        const Storage = {
            load: () => {
                try {
                    const local = localStorage.getItem('momentum_max_db');
                    return local ? { ...DEFAULT_STATE, ...JSON.parse(local) } : DEFAULT_STATE;
                } catch { return DEFAULT_STATE; }
            },
            save: (state) => {
                try { localStorage.setItem('momentum_max_db', JSON.stringify(state)); } catch(e) { console.error("Save failed", e); }
            }
        };

        // Reducer for complex state logic
        const reducer = (state, action) => {
            const next = { ...state };
            switch(action.type) {
                case 'SET_LANG': next.settings.lang = action.payload; break;
                case 'SET_NAME': next.user.name = action.payload; break;
                case 'SET_GOAL': next.user.goal = action.payload; break;
                case 'SET_PRO': next.user.isPro = action.payload; break;
                case 'NEXT_STEP': next.onboardingStep += 1; break;
                case 'COMPLETE_ONBOARDING': 
                    next.user.joinedAt = new Date().toISOString(); 
                    next.onboardingStep = 5; 
                    break;
                case 'ADD_HABIT': next.habits.push(action.payload); break;
                case 'COMPLETE_HABIT':
                    const { id, date } = action.payload;
                    if(!next.logs[date]) next.logs[date] = {};
                    next.logs[date][id] = (next.logs[date][id] || 0) + 1;
                    next.user.xp += 15;
                    // Level up logic
                    if(next.user.xp >= next.user.level * 100) {
                        next.user.level += 1;
                        next.user.xp = 0;
                    }
                    break;
                case 'RESET': return DEFAULT_STATE;
            }
            Storage.save(next);
            return next;
        };

        // =========================================
        // PART 4: TRANSLATION MATRIX
        // =========================================
        const LANG = {
            en: {
                welcome: "Welcome to Momentum MAX",
                tagline: "The ultimate system for high performers.",
                selectLang: "Select Language",
                continue: "Continue",
                nameQ: "What should we call you?",
                namePlace: "Enter your name",
                goalQ: "What is your main focus?",
                goals: [
                    { id: 'fit', label: 'Physical Health', desc: 'Build muscle & endurance', icon: 'fire' },
                    { id: 'mind', label: 'Mental Clarity', desc: 'Reduce stress & anxiety', icon: 'brain' },
                    { id: 'work', label: 'Deep Work', desc: 'Maximize productivity', icon: 'target' },
                    { id: 'rich', label: 'Build Wealth', desc: 'Financial freedom', icon: 'wallet' }
                ],
                paywallTitle: "Unlock Your Potential",
                paywallSub: "Join the top 1% of achievers.",
                features: ["Unlimited Habits", "AI Smart Coach", "Cloud Sync", "Dark Mode"],
                trial: "Start 7-Day Free Trial",
                free: "Continue with Free Plan",
                loading: "Initializing Dashboard...",
                dashboard: "Dashboard"
            },
            ar: {
                welcome: "ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÖŸàŸÖŸÜÿ™ŸÖ ŸÖÿßŸÉÿ≥",
                tagline: "ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ™ŸÉÿßŸÖŸÑ ŸÑŸÑÿ£ÿØÿßÿ° ÿßŸÑÿπÿßŸÑŸä.",
                selectLang: "ÿßÿÆÿ™ÿ± ÿßŸÑŸÑÿ∫ÿ©",
                continue: "ŸÖÿ™ÿßÿ®ÿπÿ©",
                nameQ: "ŸÖÿß ŸáŸà ÿßÿ≥ŸÖŸÉÿü",
                namePlace: "ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖŸÉ ŸáŸÜÿß",
                goalQ: "ŸÖÿß ŸáŸà ÿ™ÿ±ŸÉŸäÿ≤ŸÉ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿü",
                goals: [
                    { id: 'fit', label: 'ÿßŸÑÿµÿ≠ÿ© ÿßŸÑÿ®ÿØŸÜŸäÿ©', desc: 'ÿ®ŸÜÿßÿ° ÿßŸÑÿπÿ∂ŸÑÿßÿ™ ŸàÿßŸÑŸÑŸäÿßŸÇÿ©', icon: 'fire' },
                    { id: 'mind', label: 'ÿßŸÑÿµŸÅÿßÿ° ÿßŸÑÿ∞ŸáŸÜŸä', desc: 'ÿ™ŸÇŸÑŸäŸÑ ÿßŸÑÿ™Ÿàÿ™ÿ± ŸàÿßŸÑŸÇŸÑŸÇ', icon: 'brain' },
                    { id: 'work', label: 'ÿßŸÑÿπŸÖŸÑ ÿßŸÑÿπŸÖŸäŸÇ', desc: 'ÿ≤ŸäÿßÿØÿ© ÿßŸÑÿ•ŸÜÿ™ÿßÿ¨Ÿäÿ© ŸàÿßŸÑÿ™ÿ±ŸÉŸäÿ≤', icon: 'target' },
                    { id: 'rich', label: 'ÿ®ŸÜÿßÿ° ÿßŸÑÿ´ÿ±Ÿàÿ©', desc: 'ÿßŸÑÿßÿ≥ÿ™ŸÇŸÑÿßŸÑ ÿßŸÑŸÖÿßŸÑŸä', icon: 'wallet' }
                ],
                paywallTitle: "ÿ£ÿ∑ŸÑŸÇ ÿßŸÑÿπŸÜÿßŸÜ ŸÑŸÇÿØÿ±ÿßÿ™ŸÉ",
                paywallSub: "ÿßŸÜÿ∂ŸÖ ÿ•ŸÑŸâ ÿµŸÅŸàÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ.",
                features: ["ÿπÿßÿØÿßÿ™ ÿ∫Ÿäÿ± ŸÖÿ≠ÿØŸàÿØÿ©", "ÿßŸÑŸÖÿØÿ±ÿ® ÿßŸÑÿ∞ŸÉŸä", "ŸÖÿ≤ÿßŸÖŸÜÿ© ÿ≥ÿ≠ÿßÿ®Ÿäÿ©", "ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä"],
                trial: "ÿßÿ®ÿØÿ£ ÿ™ÿ¨ÿ±ÿ®ÿ© ŸÖÿ¨ÿßŸÜŸäÿ© 7 ÿ£ŸäÿßŸÖ",
                free: "ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ© ÿ®ÿßŸÑÿÆÿ∑ÿ© ÿßŸÑŸÖÿ¨ÿßŸÜŸäÿ©",
                loading: "ÿ¨ÿßÿ±Ÿä ÿ•ÿπÿØÿßÿØ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ...",
                dashboard: "ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©"
            }
        };

        // =========================================
        // PART 5: UI COMPONENTS
        // =========================================
        const Button = ({ children, onClick, variant='primary', disabled, className="" }) => (
            <button 
                onClick={(e) => { if(!disabled) { Sfx.play('tap'); onClick && onClick(e); } }} 
                disabled={disabled}
                className={`w-full py-4 rounded-2xl font-bold text-lg transition-all active:scale-95 flex items-center justify-center gap-2 
                ${disabled ? 'opacity-50 cursor-not-allowed bg-slate-800 text-slate-500' : 
                  variant === 'primary' ? 'btn-primary text-white shadow-lg shadow-indigo-500/30' : 
                  'bg-slate-800 text-white border border-slate-700'} 
                ${className}`}
            >
                {children}
            </button>
        );

        const Card3D = ({ children, onClick, selected, className="" }) => {
            const ref = useRef(null);
            
            const handleMove = (e) => {
                if(!ref.current) return;
                const rect = ref.current.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                ref.current.style.setProperty('--mouse-x', `${x}px`);
                ref.current.style.setProperty('--mouse-y', `${y}px`);
            };

            return (
                <div 
                    ref={ref}
                    onMouseMove={handleMove}
                    onClick={(e) => { Sfx.play('tap'); onClick && onClick(e); }}
                    className={`card-3d relative p-5 rounded-3xl cursor-pointer overflow-hidden transition-all duration-300
                    ${selected ? 'ring-2 ring-indigo-500 bg-white/10' : 'hover:bg-white/5'} ${className}`}
                >
                    {children}
                </div>
            );
        };

        // =========================================
        // PART 6: ONBOARDING FLOW
        // =========================================
        const Onboarding = ({ state, dispatch }) => {
            const t = LANG[state.settings.lang];
            const isRTL = state.settings.lang === 'ar';
            const step = state.onboardingStep;

            const next = () => dispatch({ type: 'NEXT_STEP' });

            // Step 0: Language
            if (step === 0) return (
                <div className="h-screen flex flex-col items-center justify-center p-8 animate-pop">
                    <div className="text-6xl mb-6 animate-float">üåç</div>
                    <h1 className="text-3xl font-bold mb-8 text-center">{t.selectLang}</h1>
                    <div className="space-y-4 w-full max-w-sm">
                        <Button variant="secondary" onClick={() => { dispatch({type:'SET_LANG', payload:'en'}); next(); }}>üá∫üá∏ English</Button>
                        <Button variant="secondary" onClick={() => { dispatch({type:'SET_LANG', payload:'ar'}); next(); }}>üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</Button>
                    </div>
                </div>
            );

            // Step 1: Welcome
            if (step === 1) return (
                <div className="h-screen flex flex-col justify-between p-8 animate-slide-up" dir={isRTL ? 'rtl' : 'ltr'}>
                    <div className="mt-20">
                        <div className="w-20 h-20 bg-indigo-600 rounded-3xl flex items-center justify-center mb-8 shadow-2xl shadow-indigo-500/20 rotate-3">
                            <Icon name="bolt" size={40} className="text-white" />
                        </div>
                        <h1 className="text-5xl font-black leading-tight mb-4 tracking-tight">{t.welcome}</h1>
                        <p className="text-slate-400 text-xl font-medium">{t.tagline}</p>
                    </div>
                    <Button onClick={next}>{t.continue} <Icon name="chevronRight" /></Button>
                </div>
            );

            // Step 2: Name
            if (step === 2) return (
                <div className="h-screen flex flex-col justify-between p-8 animate-slide-up" dir={isRTL ? 'rtl' : 'ltr'}>
                    <div className="mt-20">
                        <h2 className="text-3xl font-bold mb-8">{t.nameQ}</h2>
                        <input 
                            value={state.user.name}
                            onChange={(e) => dispatch({type:'SET_NAME', payload:e.target.value})}
                            placeholder={t.namePlace}
                            className="input-hollow w-full text-4xl font-bold py-4 text-center placeholder:text-slate-700"
                            autoFocus
                        />
                    </div>
                    <Button disabled={!state.user.name} onClick={next}>{t.continue}</Button>
                </div>
            );

            // Step 3: Goal
            if (step === 3) return (
                <div className="h-screen flex flex-col p-6 animate-slide-up" dir={isRTL ? 'rtl' : 'ltr'}>
                    <h2 className="text-2xl font-bold mb-6 mt-10">{t.goalQ}</h2>
                    <div className="space-y-4 flex-1 overflow-y-auto pb-4">
                        {t.goals.map(g => (
                            <Card3D 
                                key={g.id} 
                                onClick={() => { dispatch({type:'SET_GOAL', payload:g.id}); next(); }}
                                className="flex items-center gap-5 group"
                            >
                                <div className="p-4 bg-white/5 rounded-2xl group-hover:bg-indigo-600 group-hover:text-white transition-colors text-indigo-400">
                                    <Icon name={g.icon} size={28} />
                                </div>
                                <div>
                                    <h3 className="font-bold text-xl">{g.label}</h3>
                                    <p className="text-sm text-slate-400">{g.desc}</p>
                                </div>
                            </Card3D>
                        ))}
                    </div>
                </div>
            );

            // Step 4: Paywall
            if (step === 4) return (
                <div className="h-screen flex flex-col p-6 animate-pop relative overflow-hidden" dir={isRTL ? 'rtl' : 'ltr'}>
                    <div className="orb orb-1"></div>
                    <div className="orb orb-2"></div>

                    <div className="flex-1 flex flex-col items-center justify-center text-center z-10">
                        <div className="text-7xl mb-6 animate-float drop-shadow-2xl">üíé</div>
                        <h2 className="text-3xl font-black mb-2">{t.paywallTitle}</h2>
                        <p className="text-slate-300 mb-8 text-lg">{t.paywallSub}</p>

                        <div className="w-full bg-slate-900/50 backdrop-blur-xl rounded-3xl p-6 border border-white/10 mb-8 shadow-2xl">
                            <ul className="space-y-4 text-left">
                                {t.features.map((f, i) => (
                                    <li key={i} className="flex items-center gap-4">
                                        <div className="w-6 h-6 rounded-full bg-green-500/20 text-green-400 flex items-center justify-center">
                                            <Icon name="check" size={14} />
                                        </div>
                                        <span className="font-medium text-lg">{f}</span>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    </div>

                    <div className="z-10 space-y-4">
                        <Button 
                            onClick={() => { Sfx.play('success'); dispatch({type:'SET_PRO', payload:true}); dispatch({type:'COMPLETE_ONBOARDING'}); }}
                            className="anim-pulse"
                        >
                            {t.trial}
                        </Button>
                        <button 
                            onClick={() => { dispatch({type:'SET_PRO', payload:false}); dispatch({type:'COMPLETE_ONBOARDING'}); }}
                            className="w-full text-center text-sm text-slate-400 font-bold py-2 hover:text-white transition-colors"
                        >
                            {t.free}
                        </button>
                    </div>
                </div>
            );

            return null;
        };

        // =========================================
        // PART 7: APP ORCHESTRATOR
        // =========================================
        function App() {
            const [state, dispatch] = useReducer(reducer, Storage.load());
            const [loading, setLoading] = useState(false);

            // Routing Logic
            if (state.onboardingStep < 5) {
                return <Onboarding state={state} dispatch={dispatch} />;
            }

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-slate-900 text-white animate-pop">
                    <div className="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mb-6"></div>
                    <p className="font-bold opacity-50 text-xl tracking-widest">{LANG[state.settings.lang].loading}</p>
                </div>
            );

            // PART 2 (DASHBOARD) PLACEHOLDER
            return (
                <div className="h-screen w-screen flex flex-col items-center justify-center bg-slate-900 text-white animate-pop p-8 text-center">
                    <div className="text-6xl mb-4">üöÄ</div>
                    <h1 className="text-3xl font-black mb-2">Part 1 Complete</h1>
                    <p className="text-slate-400 mb-8">
                        Your profile is securely saved in the local database.<br/>
                        Name: <b className="text-white">{state.user.name}</b><br/>
                        Goal ID: <b className="text-white">{state.user.goal}</b><br/>
                        Pro Status: <b className={state.user.isPro ? "text-green-400" : "text-slate-500"}>{state.user.isPro ? "MAX Active" : "Free Plan"}</b>
                    </p>
                    <Button onClick={() => dispatch({type:'RESET'})} variant="secondary" className="bg-red-500/10 text-red-400 border-red-500/20 hover:bg-red-500/20">
                        Reset Demo
                    </Button>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
