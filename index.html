<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Momentum Pro â€” Premium Habit System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Cairo:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        [dir="rtl"] * { font-family: 'Cairo', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
        
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
        @keyframes confetti-fall { 0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        @keyframes celebrate { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); } }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.4); } 50% { box-shadow: 0 0 40px rgba(168, 85, 247, 0.8); } }
        @keyframes slide-up { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slide-down { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes bounce-in { 0% { transform: scale(0); opacity: 0; } 50% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }
        @keyframes number-pop { 0% { transform: scale(1); } 50% { transform: scale(1.4); } 100% { transform: scale(1); } }
        @keyframes pulse-glow { 0%, 100% { opacity: 0.7; transform: scale(1); } 50% { opacity: 1; transform: scale(1.05); } }
        @keyframes crown-float { 0%, 100% { transform: translateY(0) rotate(-5deg); } 50% { transform: translateY(-8px) rotate(5deg); } }
        
        .animate-float { animation: float 6s ease-in-out infinite; }
        .animate-slide-up { animation: slide-up 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .animate-slide-down { animation: slide-down 0.3s ease-out; }
        .animate-bounce-in { animation: bounce-in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        .animate-celebrate { animation: celebrate 0.6s ease-in-out; }
        .animate-glow { animation: glow 2s ease-in-out infinite; }
        .animate-number-pop { animation: number-pop 0.3s ease-out; }
        .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .animate-crown { animation: crown-float 3s ease-in-out infinite; }
        
        .shimmer { background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); background-size: 200% 100%; animation: shimmer 2s infinite; }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .premium-card { background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%); box-shadow: 0 4px 24px -4px rgba(0, 0, 0, 0.1); }
        .text-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .text-gold { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .pro-badge-gradient { background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%); }
        .streak-badge { background: linear-gradient(135deg, #ff9a56 0%, #ff6b6b 100%); }
        .level-badge { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .pro-glow { box-shadow: 0 0 30px rgba(255, 215, 0, 0.3), 0 0 60px rgba(255, 165, 0, 0.2); }
        .locked-overlay { background: linear-gradient(135deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.5) 100%); backdrop-filter: blur(4px); }
        .confetti { position: fixed; width: 10px; height: 10px; animation: confetti-fall 3s linear forwards; }
        .habit-card { 
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-style: preserve-3d;
        }
        .habit-card:hover { 
            transform: perspective(1000px) rotateX(-2deg) translateY(-4px); 
            box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.2); 
        }
        .habit-card:active {
            transform: perspective(1000px) rotateX(2deg) scale(0.98);
            box-shadow: 0 5px 15px -5px rgba(0, 0, 0, 0.15);
        }
        .progress-ring { transition: stroke-dashoffset 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .chart-bar { transition: height 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .insight-card { background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border: 1px solid rgba(102, 126, 234, 0.2); }
        .tab-bar { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
        .dark .premium-card { background: linear-gradient(135deg, rgba(30,30,40,0.95) 0%, rgba(20,20,30,0.9) 100%); }
        .dark .tab-bar { background: rgba(26, 26, 46, 0.95); }
        .premium-badge { position: relative; overflow: hidden; }
        .premium-badge::after { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); animation: shimmer 3s infinite; }
        .paywall-bg { background: linear-gradient(180deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.98) 50%, rgba(240, 147, 251, 0.95) 100%); }
        .trial-banner { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .lang-btn { transition: all 0.2s ease; }
        .lang-btn:hover { transform: scale(1.05); }
        .lang-btn.active { ring: 2px solid white; }
        
        /* 3D Button Effects */
        .btn-3d {
            transform-style: preserve-3d;
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform: perspective(1000px) rotateX(0deg) rotateY(0deg) translateZ(0);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .btn-3d:hover {
            transform: perspective(1000px) translateY(-2px) translateZ(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        .btn-3d:active {
            transform: perspective(1000px) rotateX(10deg) scale(0.95) translateZ(-5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        /* Fancy Card 3D */
        .card-3d {
            transform-style: preserve-3d;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform: perspective(1000px) rotateX(0) rotateY(0);
        }
        .card-3d:hover {
            transform: perspective(1000px) rotateX(-2deg) rotateY(2deg) translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .card-3d:active {
            transform: perspective(1000px) rotateX(2deg) scale(0.98);
        }
        
        /* Glass Morphism Button */
        .btn-glass {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        .btn-glass:hover {
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.4);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .btn-glass:active {
            transform: translateY(0) scale(0.98);
        }
        
        /* Neon Glow Button */
        .btn-neon {
            position: relative;
            transition: all 0.3s ease;
        }
        .btn-neon::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ff00ff);
            border-radius: inherit;
            z-index: -1;
            opacity: 0;
            filter: blur(10px);
            transition: opacity 0.3s ease;
        }
        .btn-neon:hover::before {
            opacity: 0.7;
        }
        .btn-neon:active {
            transform: scale(0.95);
        }
        
        /* Bounce Animation */
        @keyframes bounce-click {
            0% { transform: scale(1); }
            30% { transform: scale(0.9); }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.97); }
            100% { transform: scale(1); }
        }
        .bounce-click:active {
            animation: bounce-click 0.4s ease;
        }
        
        /* Pulse Ring */
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(139, 92, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
        }
        .pulse-ring:hover {
            animation: pulse-ring 1.5s ease infinite;
        }
        
        /* Shine Effect */
        .shine {
            position: relative;
            overflow: hidden;
        }
        .shine::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to right,
                transparent 0%,
                rgba(255,255,255,0.3) 50%,
                transparent 100%
            );
            transform: rotate(30deg) translateX(-100%);
            transition: transform 0.6s ease;
        }
        .shine:hover::after {
            transform: rotate(30deg) translateX(100%);
        }
        
        /* Floating Animation */
        @keyframes float-gentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        .float-gentle {
            animation: float-gentle 3s ease-in-out infinite;
        }
        
        /* Ripple Effect Enhanced */
        .ripple {
            position: relative;
            overflow: hidden;
        }
        .ripple::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            background-image: radial-gradient(circle, rgba(255,255,255,0.4) 10%, transparent 10%);
            background-repeat: no-repeat;
            background-position: 50%;
            transform: scale(10, 10);
            opacity: 0;
            transition: transform 0.5s, opacity 1s;
        }
        .ripple:active::after {
            transform: scale(0, 0);
            opacity: 0.4;
            transition: 0s;
        }
        
        /* Option Card Selection */
        .option-card {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform: perspective(500px) rotateX(0);
        }
        .option-card:hover {
            transform: perspective(500px) rotateX(-5deg) translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        .option-card:active {
            transform: perspective(500px) rotateX(5deg) scale(0.97);
        }
        .option-card.selected {
            transform: perspective(500px) scale(1.02);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
        }
        
        /* Compact Header for Mobile */
        @media (max-width: 640px) {
            .header-compact .badge-small {
                font-size: 9px !important;
                padding: 2px 6px !important;
            }
            .header-compact .icon-btn {
                width: 32px !important;
                height: 32px !important;
                font-size: 14px !important;
            }
        }
        
        /* Safe Area for iOS */
        .safe-area-bottom {
            padding-bottom: max(8px, env(safe-area-inset-bottom));
        }
        
        /* Touch feedback */
        .touch-active:active {
            opacity: 0.7;
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, createContext, useContext } = React;

        // ==================== TRANSLATIONS ====================
        const translations = {
            en: {
                // App
                appName: "Momentum Pro",
                appVersion: "Premium Habit System v3.0",
                
                // Welcome Screen
                welcomeTitle: "Welcome to Momentum Pro",
                welcomeSubtitle: "The premium habit tracker that helps you build lasting habits",
                tryProFree: "Try Pro FREE for 7 days:",
                unlimitedHabits: "Unlimited habits",
                ninetyDayAnalytics: "90-day analytics",
                tenPlusThemes: "10+ themes",
                challenges: "Challenges",
                startFreeTrial: "ğŸ‰ Start 7-Day FREE Trial",
                continueFreePlan: "Continue with Free Plan",
                noCreditCard: "No credit card required for trial",
                
                // Header
                hey: "Hey",
                level: "Lv.",
                xp: "XP",
                pro: "Pro",
                proTrial: "Pro Trial",
                daysLeft: "days left",
                keepPro: "Keep Pro â†’",
                tryProFree7Days: "Try Pro FREE for 7 days!",
                startTrial: "Start Trial",
                
                // Tabs
                habits: "Habits",
                analytics: "Analytics",
                rewards: "Rewards",
                settings: "Settings",
                
                // Habits Tab
                todaysProgress: "Today's Progress",
                habitsCompleted: "habits completed",
                templates: "Templates",
                custom: "Custom",
                freeHabits: "free habits",
                startTrialForUnlimited: "Start trial for unlimited",
                freeTrial: "Free Trial",
                
                // Habit Actions
                done: "Done",
                
                // Analytics Tab
                dayOverview: "-Day Overview",
                totalCompletions: "Total Completions",
                bestStreak: "Best Streak",
                perfectDays: "Perfect Days",
                currentLevel: "Current Level",
                proInsights: "Pro Insights",
                habitHeatmap: "Habit Heatmap",
                seePatterns: "See your activity patterns",
                exportData: "Export Data",
                downloadCsvPdf: "Download as CSV/PDF",
                unlockAnalytics: "ğŸ‘‘ Unlock 90-Day Analytics",
                
                // Achievements Tab
                achievementsUnlocked: "Achievements Unlocked",
                nextLevel: "Next Level",
                xpNeeded: "XP needed",
                weeklyChallenges: "Weekly Challenges",
                joinNow: "Join now!",
                startTrialToJoin: "Start trial to join",
                dayStreak: "7-Day Streak",
                perfectWeek: "Perfect Week",
                
                // Settings Tab
                proMember: "Pro Member",
                since: "Since",
                proTrialActive: "Pro Trial Active",
                daysRemaining: "days remaining",
                upgradeToKeepPro: "Upgrade to Keep Pro",
                freePlan: "Free Plan",
                theme: "Theme",
                allUnlocked: "âœ“ All unlocked",
                proFeatures: "Pro Features",
                startFreeTrialBtn: "ğŸ‰ Start Free Trial",
                unlockAllFeatures: "Unlock All Features",
                resetAllData: "Reset All Data",
                
                // Paywall
                upgradeToPro: "Upgrade to Pro",
                unlockPotential: "Unlock your full potential",
                trialActive: "Trial Active",
                enjoyingPro: "Enjoying Pro? Upgrade to keep your features!",
                orChoosePlan: "Or choose a plan:",
                monthly: "monthly",
                yearly: "yearly",
                lifetime: "lifetime",
                oneTime: "One-time",
                billed: "Billed",
                popular: "POPULAR",
                save: "Save",
                bestValue: "Best Value",
                purchase: "Purchase",
                processing: "â³ Processing...",
                cancelAnytime: "Cancel anytime",
                
                // MAX Subscription
                max: "MAX",
                maxSubscription: "Momentum MAX",
                upgradeToMax: "Upgrade to MAX",
                maxMonthly: "MAX Monthly",
                maxYearly: "MAX Yearly",
                maxLifetime: "MAX Lifetime",
                everythingInPro: "Everything in Pro, plus:",
                aiHabitCoach: "AI Habit Coach",
                aiCoachDesc: "Personal AI coaching & insights",
                smartReminders: "Smart Reminders",
                smartRemindersDesc: "AI-optimized notification timing",
                habitAnalytics: "Advanced Analytics",
                advancedAnalyticsDesc: "Deep insights & predictions",
                customChallenges: "Custom Challenges",
                customChallengesDesc: "Create your own challenges",
                prioritySupport: "Priority Support",
                prioritySupportDesc: "24/7 premium support",
                earlyAccess: "Early Access",
                earlyAccessDesc: "New features first",
                
                // Gender Selection
                selectGender: "Select your gender",
                male: "Male",
                female: "Female",
                preferNotToSay: "Prefer not to say",
                kingBadge: "ğŸ‘‘ King",
                queenBadge: "ğŸ‘‘ Queen",
                
                // More Achievements
                firstHabit: "First Habit",
                firstHabitDesc: "Complete your first habit",
                earlyBird: "Early Bird",
                earlyBirdDesc: "Complete a habit before 8 AM",
                nightOwl: "Night Owl",
                nightOwlDesc: "Complete a habit after 10 PM",
                weekendWarrior: "Weekend Warrior",
                weekendWarriorDesc: "Complete all habits on weekend",
                streakMaster: "Streak Master",
                streakMasterDesc: "Reach a 30-day streak",
                socialButterfly: "Social Butterfly",
                socialButterflyDesc: "Add 5 friends",
                perfectionist: "Perfectionist",
                perfectionistDesc: "10 perfect days",
                habitHero: "Habit Hero",
                habitHeroDesc: "Complete 100 habits total",
                centurion: "Centurion",
                centurionDesc: "Reach level 100",
                dedication: "Dedication",
                dedicationDesc: "Use app for 30 days",
                speedRunner: "Speed Runner",
                speedRunnerDesc: "Complete all habits before noon",
                collector: "Collector",
                collectorDesc: "Create 10 different habits",
                
                // Reminders & Notifications
                reminders: "Reminders",
                setReminder: "Set Reminder",
                reminderTime: "Reminder Time",
                reminderDays: "Repeat Days",
                enableNotifications: "Enable Notifications",
                notificationsEnabled: "Notifications Enabled",
                notificationsDisabled: "Notifications Disabled",
                tapToEnable: "Tap to enable push notifications",
                reminderSet: "Reminder set!",
                noReminder: "No reminder",
                everyday: "Everyday",
                weekdays: "Weekdays",
                weekends: "Weekends",
                custom: "Custom",
                sun: "Sun",
                mon: "Mon",
                tue: "Tue",
                wed: "Wed",
                thu: "Thu",
                fri: "Fri",
                sat: "Sat",
                timeToComplete: "Time to complete",
                dontForget: "Don't forget to",
                
                // Friends Feature
                friends: "Friends",
                addFriend: "Add Friend",
                friendId: "Friend ID",
                enterFriendId: "Enter friend's ID",
                yourId: "Your ID",
                copyId: "Copy ID",
                idCopied: "ID Copied!",
                friendsList: "Friends List",
                noFriendsYet: "No friends yet",
                addFriendsToCompete: "Add friends to compete and motivate each other!",
                viewProfile: "View Profile",
                removeFriend: "Remove",
                friendProfile: "Friend Profile",
                friendStreak: "Current Streak",
                friendLevel: "Level",
                friendHabits: "Active Habits",
                friendCompletedToday: "Completed Today",
                friendJoined: "Joined",
                sendEncouragement: "Send Encouragement",
                encouragementSent: "Encouragement sent! ğŸ‰",
                friendActivity: "Recent Activity",
                comparing: "vs You",
                ahead: "ahead",
                behind: "behind",
                tied: "tied",
                
                // Missions & Rewards
                missions: "Missions",
                dailyMissions: "Daily Missions",
                weeklyMissions: "Weekly Missions",
                rewards: "Rewards",
                claimReward: "Claim",
                claimed: "Claimed!",
                locked: "Locked",
                xpReward: "XP Reward",
                levelRewards: "Level Rewards",
                currentRewards: "Your Rewards",
                
                // Daily Missions
                missionComplete1: "Complete 1 habit",
                missionComplete3: "Complete 3 habits",
                missionCompleteAll: "Complete all habits",
                missionStreak3: "Reach 3-day streak",
                missionStreak7: "Reach 7-day streak",
                missionLogin: "Daily login bonus",
                missionPerfectDay: "Perfect day (100%)",
                missionEarlyBird: "Complete a habit before 9am",
                missionNightOwl: "Complete all habits",
                
                // Weekly Missions
                missionWeek5Days: "Complete habits 5 days",
                missionWeek7Days: "7-day perfect week",
                missionAdd3Habits: "Add 3 new habits",
                missionFriend: "Add a friend",
                missionLevel5: "Reach level 5",
                missionLevel10: "Reach level 10",
                
                // Rewards
                rewardBadge: "Special Badge",
                rewardTheme: "Unlock Theme",
                rewardAvatar: "Special Avatar",
                rewardTitle: "Custom Title",
                rewardXpBoost: "2x XP Boost",
                rewardStreakFreeze: "Streak Freeze",
                
                // Level milestones
                level5Reward: "ğŸ–ï¸ Novice Badge",
                level10Reward: "ğŸŒŸ Rising Star Title",
                level15Reward: "ğŸ¨ Ocean Theme",
                level20Reward: "ğŸ‘‘ Gold Avatar",
                level25Reward: "âš¡ 2x XP Day",
                level30Reward: "ğŸ›¡ï¸ Streak Freeze",
                
                // Progress
                progress: "Progress",
                completed: "Completed",
                inProgress: "In Progress",
                notStarted: "Not Started",
                
                // Templates Modal
                quickStartHabits: "Quick start habits",
                startTrialForMore: "Start free trial for unlimited habits",
                goal: "Goal",
                
                // Add Habit Modal
                newHabit: "New Habit",
                habitName: "Habit Name",
                habitNamePlaceholder: "e.g., Morning meditation",
                dailyGoal: "Daily Goal",
                unit: "unit",
                category: "Category",
                createHabit: "Create Habit",
                
                // Habit Detail Modal
                currentStreak: "Current Streak",
                daysCompleted: "Days Completed",
                deleteHabit: "Delete Habit",
                
                // Categories
                all: "All",
                health: "Health",
                fitness: "Fitness",
                wellness: "Wellness",
                learning: "Learning",
                productivity: "Productivity",
                
                // Level Up
                levelUp: "LEVEL UP!",
                
                // Pro Features
                feat_unlimitedHabits: "Unlimited Habits",
                feat_advancedAnalytics: "Advanced Analytics",
                feat_allThemes: "Premium Themes",
                feat_cloudBackup: "Cloud Backup",
                feat_focusMode: "Focus Mode",
                feat_streakProtection: "Streak Protection",
                
                // Quotes
                quote1: "Small daily improvements are the key to staggering long-term results.",
                quote1Author: "James Clear",
                quote2: "We are what we repeatedly do. Excellence is not an act, but a habit.",
                quote2Author: "Aristotle",
                
                // Habit Templates
                drinkWater: "Drink water",
                exercise: "Exercise",
                meditate: "Meditate",
                read: "Read",
                journal: "Journal",
                walk: "Walk",
                glasses: "glasses",
                min: "min",
                pages: "pages",
                steps: "steps",
                
                // Language
                language: "Language",
                english: "English",
                arabic: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                
                // Name Input Screen
                whatsYourName: "What's your name?",
                enterYourName: "Enter your name",
                namePlaceholder: "Your name",
                continue: "Continue",
                
                // Onboarding
                selectLanguage: "Select your language",
                letsGetStarted: "Let's get started!",
                whatBringsYou: "What brings you to Momentum?",
                buildHealthyHabits: "Build healthy habits",
                boostProductivity: "Boost productivity",
                improveWellbeing: "Improve wellbeing",
                trackFitness: "Track fitness goals",
                learnNewSkills: "Learn new skills",
                other: "Other",
                howManyHabits: "How many habits do you want to build?",
                justOne: "Just 1-2",
                aFew: "3-5 habits",
                many: "6+ habits",
                greatChoice: "Great choice!",
                personalizing: "Personalizing your experience...",
                next: "Next",
                back: "Back",
                
                // More habit templates
                takeVitamins: "Take vitamins",
                sleepEarly: "Sleep early",
                noSugar: "No sugar",
                stretching: "Stretching",
                coldShower: "Cold shower",
                skincare: "Skincare",
                yoga: "Yoga",
                runMorning: "Morning run",
                gym: "Go to gym",
                cycling: "Cycling",
                swimming: "Swimming",
                plank: "Plank exercise",
                breathingExercise: "Breathing exercise",
                gratitude: "Gratitude",
                noPhone: "No phone before bed",
                learnLanguage: "Learn language",
                podcast: "Listen to podcast",
                onlineCourse: "Online course",
                practiceSkill: "Practice skill",
                writingPractice: "Writing practice",
                deepWork: "Deep work",
                planDay: "Plan my day",
                inbox0: "Inbox zero",
                reviewGoals: "Review goals",
                networking: "Networking",
                times: "times",
                hours: "hours",
                sessions: "sessions",
                lessons: "lessons",
                
                // Quick Add Increments
                quickAdd: "Quick Add",
                addCustom: "Add custom amount",
                enterAmount: "Enter amount",
                add: "Add",
                cancel: "Cancel",
                
                // Interval Reminders
                intervalReminder: "Interval Reminder",
                remindEvery: "Remind every",
                hoursInterval: "hours",
                startTime: "Start Time",
                endTime: "End Time",
                activeHours: "Active hours only",
                saveReminder: "Save Reminder",
                intervalEnabled: "Interval reminder enabled",
                
                // AI Coach
                aiCoach: "AI Coach",
                askCoach: "Ask your AI coach...",
                coachTip: "Coach Tip",
                personalizedAdvice: "Personalized advice based on your habits",
                analyzing: "Analyzing your habits...",
                getAdvice: "Get Advice",
                coachSuggestions: "Coach Suggestions",
                basedOnHabits: "Based on your habits and progress",
                
                // Close button
                close: "Close",
                
                // Review Popup
                enjoyingApp: "Enjoying Momentum?",
                rateUs: "Rate Us",
                rateUsDesc: "Your feedback helps us improve!",
                rateNow: "â­ Rate Now",
                maybeLater: "Maybe Later",
                noThanks: "No Thanks",
                
                // Invite Friend
                inviteFriend: "Invite Friends",
                inviteDesc: "Share with friends & get 7 days MAX free!",
                inviteReward: "Both you and your friend get 7 days MAX!",
                yourInviteCode: "Your Invite Code",
                shareLink: "Share Link",
                copyLink: "Copy Link",
                linkCopied: "Link Copied! ğŸ‰",
                enterInviteCode: "Enter Friend's Code",
                applyCode: "Apply Code",
                codeApplied: "Code Applied! +7 Days MAX! ğŸ‰",
                invalidCode: "Invalid code",
                alreadyUsed: "Code already used",
            },
            ar: {
                // App
                appName: "Ù…ÙˆÙ…Ù†ØªÙ… Ø¨Ø±Ùˆ",
                appVersion: "Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ…ÙŠØ² v3.0",
                
                // Welcome Screen
                welcomeTitle: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…ÙˆÙ…Ù†ØªÙ… Ø¨Ø±Ùˆ",
                welcomeSubtitle: "Ù…ØªØªØ¨Ø¹ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ…ÙŠØ² Ø§Ù„Ø°ÙŠ ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ Ø¨Ù†Ø§Ø¡ Ø¹Ø§Ø¯Ø§Øª Ø¯Ø§Ø¦Ù…Ø©",
                tryProFree: "Ø¬Ø±Ø¨ Ø¨Ø±Ùˆ Ù…Ø¬Ø§Ù†Ø§Ù‹ Ù„Ù…Ø¯Ø© 7 Ø£ÙŠØ§Ù…:",
                unlimitedHabits: "Ø¹Ø§Ø¯Ø§Øª ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©",
                ninetyDayAnalytics: "ØªØ­Ù„ÙŠÙ„Ø§Øª 90 ÙŠÙˆÙ…Ø§Ù‹",
                tenPlusThemes: "Ø£ÙƒØ«Ø± Ù…Ù† 10 Ø«ÙŠÙ…Ø§Øª",
                challenges: "ØªØ­Ø¯ÙŠØ§Øª",
                startFreeTrial: "ğŸ‰ Ø§Ø¨Ø¯Ø£ ØªØ¬Ø±Ø¨Ø© Ù…Ø¬Ø§Ù†ÙŠØ© 7 Ø£ÙŠØ§Ù…",
                continueFreePlan: "Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©",
                noCreditCard: "Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù† Ù„Ù„ØªØ¬Ø±Ø¨Ø©",
                
                // Header
                hey: "Ù…Ø±Ø­Ø¨Ø§Ù‹",
                level: "Ù….",
                xp: "Ù†Ù‚Ø§Ø·",
                pro: "Ø¨Ø±Ùˆ",
                proTrial: "ØªØ¬Ø±Ø¨Ø© Ø¨Ø±Ùˆ",
                daysLeft: "Ø£ÙŠØ§Ù… Ù…ØªØ¨Ù‚ÙŠØ©",
                keepPro: "â† Ø§Ø­ØªÙØ¸ Ø¨Ø¨Ø±Ùˆ",
                tryProFree7Days: "Ø¬Ø±Ø¨ Ø¨Ø±Ùˆ Ù…Ø¬Ø§Ù†Ø§Ù‹ Ù„Ù…Ø¯Ø© 7 Ø£ÙŠØ§Ù…!",
                startTrial: "Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¬Ø±Ø¨Ø©",
                
                // Tabs
                habits: "Ø§Ù„Ø¹Ø§Ø¯Ø§Øª",
                analytics: "Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª",
                rewards: "Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª",
                settings: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
                
                // Habits Tab
                todaysProgress: "ØªÙ‚Ø¯Ù… Ø§Ù„ÙŠÙˆÙ…",
                habitsCompleted: "Ø¹Ø§Ø¯Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©",
                templates: "Ù‚ÙˆØ§Ù„Ø¨",
                custom: "Ù…Ø®ØµØµ",
                freeHabits: "Ø¹Ø§Ø¯Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ©",
                startTrialForUnlimited: "Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯",
                freeTrial: "ØªØ¬Ø±Ø¨Ø© Ù…Ø¬Ø§Ù†ÙŠØ©",
                
                // Habit Actions
                done: "ØªÙ…",
                
                // Analytics Tab
                dayOverview: " ÙŠÙˆÙ…-Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©",
                totalCompletions: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª",
                bestStreak: "Ø£ÙØ¶Ù„ Ø³Ù„Ø³Ù„Ø©",
                perfectDays: "Ø£ÙŠØ§Ù… Ù…Ø«Ø§Ù„ÙŠØ©",
                currentLevel: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ",
                proInsights: "Ø±Ø¤Ù‰ Ø¨Ø±Ùˆ",
                habitHeatmap: "Ø®Ø±ÙŠØ·Ø© Ø­Ø±Ø§Ø±ÙŠØ© Ù„Ù„Ø¹Ø§Ø¯Ø§Øª",
                seePatterns: "Ø´Ø§Ù‡Ø¯ Ø£Ù†Ù…Ø§Ø· Ù†Ø´Ø§Ø·Ùƒ",
                exportData: "ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
                downloadCsvPdf: "ØªØ­Ù…ÙŠÙ„ ÙƒÙ€ CSV/PDF",
                unlockAnalytics: "ğŸ‘‘ Ø§ÙØªØ­ ØªØ­Ù„ÙŠÙ„Ø§Øª 90 ÙŠÙˆÙ…Ø§Ù‹",
                
                // Achievements Tab
                achievementsUnlocked: "Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©",
                nextLevel: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ",
                xpNeeded: "Ù†Ù‚Ø§Ø· Ù…Ø·Ù„ÙˆØ¨Ø©",
                weeklyChallenges: "Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©",
                joinNow: "Ø§Ù†Ø¶Ù… Ø§Ù„Ø¢Ù†!",
                startTrialToJoin: "Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…",
                dayStreak: "Ø³Ù„Ø³Ù„Ø© 7 Ø£ÙŠØ§Ù…",
                perfectWeek: "Ø£Ø³Ø¨ÙˆØ¹ Ù…Ø«Ø§Ù„ÙŠ",
                
                // Settings Tab
                proMember: "Ø¹Ø¶Ùˆ Ø¨Ø±Ùˆ",
                since: "Ù…Ù†Ø°",
                proTrialActive: "ØªØ¬Ø±Ø¨Ø© Ø¨Ø±Ùˆ Ù†Ø´Ø·Ø©",
                daysRemaining: "Ø£ÙŠØ§Ù… Ù…ØªØ¨Ù‚ÙŠØ©",
                upgradeToKeepPro: "ØªØ±Ù‚ÙŠØ© Ù„Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¨Ø±Ùˆ",
                freePlan: "Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©",
                theme: "Ø§Ù„Ø«ÙŠÙ…",
                allUnlocked: "âœ“ Ø§Ù„ÙƒÙ„ Ù…ÙØªÙˆØ­",
                proFeatures: "Ù…Ù…ÙŠØ²Ø§Øª Ø¨Ø±Ùˆ",
                startFreeTrialBtn: "ğŸ‰ Ø§Ø¨Ø¯Ø£ ØªØ¬Ø±Ø¨Ø© Ù…Ø¬Ø§Ù†ÙŠØ©",
                unlockAllFeatures: "Ø§ÙØªØ­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª",
                resetAllData: "Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
                
                // Paywall
                upgradeToPro: "Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ø¨Ø±Ùˆ",
                unlockPotential: "Ø£Ø·Ù„Ù‚ Ø§Ù„Ø¹Ù†Ø§Ù† Ù„Ø¥Ù…ÙƒØ§Ù†Ø§ØªÙƒ Ø§Ù„ÙƒØ§Ù…Ù„Ø©",
                trialActive: "Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ù†Ø´Ø·Ø©",
                enjoyingPro: "Ù‡Ù„ ØªØ³ØªÙ…ØªØ¹ Ø¨Ø¨Ø±ÙˆØŸ Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ© Ù„Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª!",
                orChoosePlan: "Ø£Ùˆ Ø§Ø®ØªØ± Ø®Ø·Ø©:",
                monthly: "Ø´Ù‡Ø±ÙŠ",
                yearly: "Ø³Ù†ÙˆÙŠ",
                lifetime: "Ù…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©",
                oneTime: "Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©",
                billed: "ÙŠÙØ¯ÙØ¹",
                popular: "Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©",
                save: "ÙˆÙØ±",
                bestValue: "Ø£ÙØ¶Ù„ Ù‚ÙŠÙ…Ø©",
                purchase: "Ø´Ø±Ø§Ø¡",
                processing: "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...",
                cancelAnytime: "Ø¥Ù„ØºØ§Ø¡ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª",
                
                // MAX Subscription
                max: "Ù…Ø§ÙƒØ³",
                maxSubscription: "Ù…ÙˆÙ…Ù†ØªÙ… Ù…Ø§ÙƒØ³",
                upgradeToMax: "Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ù…Ø§ÙƒØ³",
                maxMonthly: "Ù…Ø§ÙƒØ³ Ø´Ù‡Ø±ÙŠ",
                maxYearly: "Ù…Ø§ÙƒØ³ Ø³Ù†ÙˆÙŠ",
                maxLifetime: "Ù…Ø§ÙƒØ³ Ù…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©",
                everythingInPro: "ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ø¨Ø±ÙˆØŒ Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰:",
                aiHabitCoach: "Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø°ÙƒÙŠ",
                aiCoachDesc: "ØªØ¯Ø±ÙŠØ¨ ÙˆØ±Ø¤Ù‰ Ø´Ø®ØµÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
                smartReminders: "ØªØ°ÙƒÙŠØ±Ø§Øª Ø°ÙƒÙŠØ©",
                smartRemindersDesc: "ØªÙˆÙ‚ÙŠØª Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ø­Ø³Ù‘Ù† Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
                habitAnalytics: "ØªØ­Ù„ÙŠÙ„Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©",
                advancedAnalyticsDesc: "Ø±Ø¤Ù‰ Ø¹Ù…ÙŠÙ‚Ø© ÙˆØªÙˆÙ‚Ø¹Ø§Øª",
                customChallenges: "ØªØ­Ø¯ÙŠØ§Øª Ù…Ø®ØµØµØ©",
                customChallengesDesc: "Ø£Ù†Ø´Ø¦ ØªØ­Ø¯ÙŠØ§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©",
                prioritySupport: "Ø¯Ø¹Ù… Ø£ÙˆÙ„ÙˆÙŠØ©",
                prioritySupportDesc: "Ø¯Ø¹Ù… Ù…ØªÙ…ÙŠØ² Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¹Ø©",
                earlyAccess: "ÙˆØµÙˆÙ„ Ù…Ø¨ÙƒØ±",
                earlyAccessDesc: "Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø£ÙˆÙ„Ø§Ù‹",
                
                // Gender Selection
                selectGender: "Ø§Ø®ØªØ± Ø¬Ù†Ø³Ùƒ",
                male: "Ø°ÙƒØ±",
                female: "Ø£Ù†Ø«Ù‰",
                preferNotToSay: "Ø£ÙØ¶Ù„ Ø¹Ø¯Ù… Ø§Ù„Ø¥ÙØµØ§Ø­",
                kingBadge: "ğŸ‘‘ Ù…Ù„Ùƒ",
                queenBadge: "ğŸ‘‘ Ù…Ù„ÙƒØ©",
                
                // More Achievements
                firstHabit: "Ø£ÙˆÙ„ Ø¹Ø§Ø¯Ø©",
                firstHabitDesc: "Ø£ÙƒÙ…Ù„ Ø¹Ø§Ø¯ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰",
                earlyBird: "Ø§Ù„Ø·Ø§Ø¦Ø± Ø§Ù„Ù…Ø¨ÙƒØ±",
                earlyBirdDesc: "Ø£ÙƒÙ…Ù„ Ø¹Ø§Ø¯Ø© Ù‚Ø¨Ù„ 8 ØµØ¨Ø§Ø­Ø§Ù‹",
                nightOwl: "Ø¨ÙˆÙ…Ø© Ø§Ù„Ù„ÙŠÙ„",
                nightOwlDesc: "Ø£ÙƒÙ…Ù„ Ø¹Ø§Ø¯Ø© Ø¨Ø¹Ø¯ 10 Ù…Ø³Ø§Ø¡Ù‹",
                weekendWarrior: "Ù…Ø­Ø§Ø±Ø¨ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",
                weekendWarriorDesc: "Ø£ÙƒÙ…Ù„ ÙƒÙ„ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª ÙÙŠ Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",
                streakMaster: "Ø³ÙŠØ¯ Ø§Ù„Ø³Ù„Ø³Ù„Ø©",
                streakMasterDesc: "Ø­Ù‚Ù‚ Ø³Ù„Ø³Ù„Ø© 30 ÙŠÙˆÙ…Ø§Ù‹",
                socialButterfly: "Ø§Ù„ÙØ±Ø§Ø´Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©",
                socialButterflyDesc: "Ø£Ø¶Ù 5 Ø£ØµØ¯Ù‚Ø§Ø¡",
                perfectionist: "Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ",
                perfectionistDesc: "10 Ø£ÙŠØ§Ù… Ù…Ø«Ø§Ù„ÙŠØ©",
                habitHero: "Ø¨Ø·Ù„ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª",
                habitHeroDesc: "Ø£ÙƒÙ…Ù„ 100 Ø¹Ø§Ø¯Ø© Ø¥Ø¬Ù…Ø§Ù„Ø§Ù‹",
                centurion: "Ø§Ù„Ù…Ø¦ÙˆÙŠ",
                centurionDesc: "ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ 100",
                dedication: "Ø§Ù„ØªÙØ§Ù†ÙŠ",
                dedicationDesc: "Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ…Ø§Ù‹",
                speedRunner: "Ø§Ù„Ø³Ø±ÙŠØ¹",
                speedRunnerDesc: "Ø£ÙƒÙ…Ù„ ÙƒÙ„ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø¸Ù‡Ø±",
                collector: "Ø§Ù„Ø¬Ø§Ù…Ø¹",
                collectorDesc: "Ø£Ù†Ø´Ø¦ 10 Ø¹Ø§Ø¯Ø§Øª Ù…Ø®ØªÙ„ÙØ©",
                
                // Reminders & Notifications
                reminders: "Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª",
                setReminder: "Ø¶Ø¨Ø· ØªØ°ÙƒÙŠØ±",
                reminderTime: "ÙˆÙ‚Øª Ø§Ù„ØªØ°ÙƒÙŠØ±",
                reminderDays: "Ø£ÙŠØ§Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±",
                enableNotifications: "ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",
                notificationsEnabled: "Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…ÙØ¹Ù„Ø©",
                notificationsDisabled: "Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ø¹Ø·Ù„Ø©",
                tapToEnable: "Ø§Ø¶ØºØ· Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",
                reminderSet: "ØªÙ… Ø¶Ø¨Ø· Ø§Ù„ØªØ°ÙƒÙŠØ±!",
                noReminder: "Ø¨Ø¯ÙˆÙ† ØªØ°ÙƒÙŠØ±",
                everyday: "ÙƒÙ„ ÙŠÙˆÙ…",
                weekdays: "Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",
                weekends: "Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",
                custom: "Ù…Ø®ØµØµ",
                sun: "Ø£Ø­Ø¯",
                mon: "Ø¥Ø«Ù†ÙŠÙ†",
                tue: "Ø«Ù„Ø§Ø«Ø§Ø¡",
                wed: "Ø£Ø±Ø¨Ø¹Ø§Ø¡",
                thu: "Ø®Ù…ÙŠØ³",
                fri: "Ø¬Ù…Ø¹Ø©",
                sat: "Ø³Ø¨Øª",
                timeToComplete: "Ø­Ø§Ù† ÙˆÙ‚Øª Ø¥ÙƒÙ…Ø§Ù„",
                dontForget: "Ù„Ø§ ØªÙ†Ø³Ù",
                
                // Friends Feature
                friends: "Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡",
                addFriend: "Ø¥Ø¶Ø§ÙØ© ØµØ¯ÙŠÙ‚",
                friendId: "Ù…Ø¹Ø±Ù Ø§Ù„ØµØ¯ÙŠÙ‚",
                enterFriendId: "Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù ØµØ¯ÙŠÙ‚Ùƒ",
                yourId: "Ù…Ø¹Ø±ÙÙƒ",
                copyId: "Ù†Ø³Ø® Ø§Ù„Ù…Ø¹Ø±Ù",
                idCopied: "ØªÙ… Ø§Ù„Ù†Ø³Ø®!",
                friendsList: "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡",
                noFriendsYet: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¨Ø¹Ø¯",
                addFriendsToCompete: "Ø£Ø¶Ù Ø£ØµØ¯Ù‚Ø§Ø¡ Ù„Ù„ØªÙ†Ø§ÙØ³ ÙˆØ§Ù„ØªØ­ÙÙŠØ² Ø§Ù„Ù…ØªØ¨Ø§Ø¯Ù„!",
                viewProfile: "Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù",
                removeFriend: "Ø¥Ø²Ø§Ù„Ø©",
                friendProfile: "Ù…Ù„Ù Ø§Ù„ØµØ¯ÙŠÙ‚",
                friendStreak: "Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©",
                friendLevel: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰",
                friendHabits: "Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©",
                friendCompletedToday: "Ù…ÙƒØªÙ…Ù„ Ø§Ù„ÙŠÙˆÙ…",
                friendJoined: "Ø§Ù†Ø¶Ù…",
                sendEncouragement: "Ø¥Ø±Ø³Ø§Ù„ ØªØ´Ø¬ÙŠØ¹",
                encouragementSent: "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ´Ø¬ÙŠØ¹! ğŸ‰",
                friendActivity: "Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø®ÙŠØ±",
                comparing: "Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ùƒ",
                ahead: "Ù…ØªÙ‚Ø¯Ù…",
                behind: "Ù…ØªØ£Ø®Ø±",
                tied: "Ù…ØªØ¹Ø§Ø¯Ù„",
                
                // Missions & Rewards
                missions: "Ø§Ù„Ù…Ù‡Ø§Ù…",
                dailyMissions: "Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©",
                weeklyMissions: "Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©",
                rewards: "Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª",
                claimReward: "Ø§Ø³ØªÙ„Ù…",
                claimed: "ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…!",
                locked: "Ù…Ù‚ÙÙ„",
                xpReward: "Ù…ÙƒØ§ÙØ£Ø© XP",
                levelRewards: "Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰",
                currentRewards: "Ù…ÙƒØ§ÙØ¢ØªÙƒ",
                
                // Daily Missions
                missionComplete1: "Ø£ÙƒÙ…Ù„ Ø¹Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø©",
                missionComplete3: "Ø£ÙƒÙ…Ù„ 3 Ø¹Ø§Ø¯Ø§Øª",
                missionCompleteAll: "Ø£ÙƒÙ…Ù„ ÙƒÙ„ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª",
                missionStreak3: "Ø­Ù‚Ù‚ Ø³Ù„Ø³Ù„Ø© 3 Ø£ÙŠØ§Ù…",
                missionStreak7: "Ø­Ù‚Ù‚ Ø³Ù„Ø³Ù„Ø© 7 Ø£ÙŠØ§Ù…",
                missionLogin: "Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ",
                missionPerfectDay: "ÙŠÙˆÙ… Ù…Ø«Ø§Ù„ÙŠ (100%)",
                missionEarlyBird: "Ø£ÙƒÙ…Ù„ Ø¹Ø§Ø¯Ø© Ù‚Ø¨Ù„ 9 ØµØ¨Ø§Ø­Ø§Ù‹",
                missionNightOwl: "Ø£ÙƒÙ…Ù„ ÙƒÙ„ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª",
                
                // Weekly Missions
                missionWeek5Days: "Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª 5 Ø£ÙŠØ§Ù…",
                missionWeek7Days: "Ø£Ø³Ø¨ÙˆØ¹ Ù…Ø«Ø§Ù„ÙŠ 7 Ø£ÙŠØ§Ù…",
                missionAdd3Habits: "Ø£Ø¶Ù 3 Ø¹Ø§Ø¯Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©",
                missionFriend: "Ø£Ø¶Ù ØµØ¯ÙŠÙ‚",
                missionLevel5: "ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ 5",
                missionLevel10: "ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ 10",
                
                // Rewards
                rewardBadge: "Ø´Ø§Ø±Ø© Ø®Ø§ØµØ©",
                rewardTheme: "ÙØªØ­ Ø«ÙŠÙ…",
                rewardAvatar: "ØµÙˆØ±Ø© Ø±Ù…Ø²ÙŠØ© Ø®Ø§ØµØ©",
                rewardTitle: "Ù„Ù‚Ø¨ Ù…Ø®ØµØµ",
                rewardXpBoost: "Ù…Ø¶Ø§Ø¹ÙØ© XP",
                rewardStreakFreeze: "ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø³Ù„Ø³Ù„Ø©",
                
                // Level milestones
                level5Reward: "ğŸ–ï¸ Ø´Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ØªØ¯Ø¦",
                level10Reward: "ğŸŒŸ Ù„Ù‚Ø¨ Ø§Ù„Ù†Ø¬Ù… Ø§Ù„ØµØ§Ø¹Ø¯",
                level15Reward: "ğŸ¨ Ø«ÙŠÙ… Ø§Ù„Ù…Ø­ÙŠØ·",
                level20Reward: "ğŸ‘‘ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©",
                level25Reward: "âš¡ ÙŠÙˆÙ… XP Ù…Ø¶Ø§Ø¹Ù",
                level30Reward: "ğŸ›¡ï¸ ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø³Ù„Ø³Ù„Ø©",
                
                // Progress
                progress: "Ø§Ù„ØªÙ‚Ø¯Ù…",
                completed: "Ù…ÙƒØªÙ…Ù„",
                inProgress: "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",
                notStarted: "Ù„Ù… ÙŠØ¨Ø¯Ø£",
                
                // Templates Modal
                quickStartHabits: "Ø¹Ø§Ø¯Ø§Øª Ù„Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±ÙŠØ¹",
                startTrialForMore: "Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© Ù„Ø¹Ø§Ø¯Ø§Øª ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©",
                goal: "Ø§Ù„Ù‡Ø¯Ù",
                
                // Add Habit Modal
                newHabit: "Ø¹Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©",
                habitName: "Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¯Ø©",
                habitNamePlaceholder: "Ù…Ø«Ø§Ù„: ØªØ£Ù…Ù„ ØµØ¨Ø§Ø­ÙŠ",
                dailyGoal: "Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ",
                unit: "Ø§Ù„ÙˆØ­Ø¯Ø©",
                category: "Ø§Ù„ÙØ¦Ø©",
                createHabit: "Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø§Ø¯Ø©",
                
                // Habit Detail Modal
                currentStreak: "Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©",
                daysCompleted: "Ø£ÙŠØ§Ù… Ù…ÙƒØªÙ…Ù„Ø©",
                deleteHabit: "Ø­Ø°Ù Ø§Ù„Ø¹Ø§Ø¯Ø©",
                
                // Categories
                all: "Ø§Ù„ÙƒÙ„",
                health: "Ø§Ù„ØµØ­Ø©",
                fitness: "Ø§Ù„Ù„ÙŠØ§Ù‚Ø©",
                wellness: "Ø§Ù„Ø¹Ø§ÙÙŠØ©",
                learning: "Ø§Ù„ØªØ¹Ù„Ù…",
                productivity: "Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©",
                
                // Level Up
                levelUp: "Ø§Ø±ØªÙ‚ÙŠØª Ù…Ø³ØªÙˆÙ‰!",
                
                // Pro Features
                feat_unlimitedHabits: "Ø¹Ø§Ø¯Ø§Øª ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©",
                feat_advancedAnalytics: "ØªØ­Ù„ÙŠÙ„Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©",
                feat_allThemes: "Ø«ÙŠÙ…Ø§Øª Ù…ØªÙ…ÙŠØ²Ø©",
                feat_cloudBackup: "Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø³Ø­Ø§Ø¨ÙŠ",
                feat_focusMode: "ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²",
                feat_streakProtection: "Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø³Ù„Ø³Ù„Ø©",
                
                // Quotes
                quote1: "Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„ØµØºÙŠØ±Ø© Ù‡ÙŠ Ù…ÙØªØ§Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø°Ù‡Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ø·ÙˆÙŠÙ„.",
                quote1Author: "Ø¬ÙŠÙ…Ø³ ÙƒÙ„ÙŠØ±",
                quote2: "Ù†Ø­Ù† Ù…Ø§ Ù†ÙØ¹Ù„Ù‡ Ø¨Ø´ÙƒÙ„ Ù…ØªÙƒØ±Ø±. Ø§Ù„ØªÙ…ÙŠØ² Ù„ÙŠØ³ ÙØ¹Ù„Ø§Ù‹ØŒ Ø¨Ù„ Ø¹Ø§Ø¯Ø©.",
                quote2Author: "Ø£Ø±Ø³Ø·Ùˆ",
                
                // Habit Templates
                drinkWater: "Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡",
                exercise: "Ø§Ù„ØªÙ…Ø±ÙŠÙ†",
                meditate: "Ø§Ù„ØªØ£Ù…Ù„",
                read: "Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©",
                journal: "ÙƒØªØ§Ø¨Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ§Øª",
                walk: "Ø§Ù„Ù…Ø´ÙŠ",
                glasses: "Ø£ÙƒÙˆØ§Ø¨",
                min: "Ø¯Ù‚ÙŠÙ‚Ø©",
                pages: "ØµÙØ­Ø§Øª",
                steps: "Ø®Ø·ÙˆØ§Øª",
                
                // Language
                language: "Ø§Ù„Ù„ØºØ©",
                english: "English",
                arabic: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                
                // Name Input Screen
                whatsYourName: "Ù…Ø§ Ù‡Ùˆ Ø§Ø³Ù…ÙƒØŸ",
                enterYourName: "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ",
                namePlaceholder: "Ø§Ø³Ù…Ùƒ",
                continue: "Ù…ØªØ§Ø¨Ø¹Ø©",
                
                // Onboarding
                selectLanguage: "Ø§Ø®ØªØ± Ù„ØºØªÙƒ",
                letsGetStarted: "!Ù‡ÙŠØ§ Ù†Ø¨Ø¯Ø£",
                whatBringsYou: "Ù…Ø§ Ø§Ù„Ø°ÙŠ ÙŠØ¬Ø°Ø¨Ùƒ Ø¥Ù„Ù‰ Ù…ÙˆÙ…Ù†ØªÙ…ØŸ",
                buildHealthyHabits: "Ø¨Ù†Ø§Ø¡ Ø¹Ø§Ø¯Ø§Øª ØµØ­ÙŠØ©",
                boostProductivity: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©",
                improveWellbeing: "ØªØ­Ø³ÙŠÙ† Ø§Ù„ØµØ­Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©",
                trackFitness: "ØªØªØ¨Ø¹ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù„ÙŠØ§Ù‚Ø©",
                learnNewSkills: "ØªØ¹Ù„Ù… Ù…Ù‡Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©",
                other: "Ø£Ø®Ø±Ù‰",
                howManyHabits: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‡Ø§ØŸ",
                justOne: "1-2 ÙÙ‚Ø·",
                aFew: "3-5 Ø¹Ø§Ø¯Ø§Øª",
                many: "+6 Ø¹Ø§Ø¯Ø§Øª",
                greatChoice: "!Ø§Ø®ØªÙŠØ§Ø± Ø±Ø§Ø¦Ø¹",
                personalizing: "...Ø¬Ø§Ø±ÙŠ ØªØ®ØµÙŠØµ ØªØ¬Ø±Ø¨ØªÙƒ",
                next: "Ø§Ù„ØªØ§Ù„ÙŠ",
                back: "Ø±Ø¬ÙˆØ¹",
                
                // More habit templates
                takeVitamins: "ØªÙ†Ø§ÙˆÙ„ Ø§Ù„ÙÙŠØªØ§Ù…ÙŠÙ†Ø§Øª",
                sleepEarly: "Ø§Ù„Ù†ÙˆÙ… Ù…Ø¨ÙƒØ±Ø§Ù‹",
                noSugar: "Ø¨Ø¯ÙˆÙ† Ø³ÙƒØ±",
                stretching: "ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø¥Ø·Ø§Ù„Ø©",
                coldShower: "Ø¯Ø´ Ø¨Ø§Ø±Ø¯",
                skincare: "Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¨Ø´Ø±Ø©",
                yoga: "ÙŠÙˆØºØ§",
                runMorning: "Ø§Ù„Ø¬Ø±ÙŠ ØµØ¨Ø§Ø­Ø§Ù‹",
                gym: "Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„Ø¬ÙŠÙ…",
                cycling: "Ø±ÙƒÙˆØ¨ Ø§Ù„Ø¯Ø±Ø§Ø¬Ø©",
                swimming: "Ø§Ù„Ø³Ø¨Ø§Ø­Ø©",
                plank: "ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø¨Ù„Ø§Ù†Ùƒ",
                breathingExercise: "ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„ØªÙ†ÙØ³",
                gratitude: "Ø§Ù„Ø§Ù…ØªÙ†Ø§Ù†",
                noPhone: "Ø¨Ø¯ÙˆÙ† Ù‡Ø§ØªÙ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…",
                learnLanguage: "ØªØ¹Ù„Ù… Ù„ØºØ©",
                podcast: "Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¨ÙˆØ¯ÙƒØ§Ø³Øª",
                onlineCourse: "Ø¯ÙˆØ±Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª",
                practiceSkill: "Ù…Ù…Ø§Ø±Ø³Ø© Ù…Ù‡Ø§Ø±Ø©",
                writingPractice: "Ù…Ù…Ø§Ø±Ø³Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø©",
                deepWork: "Ø¹Ù…Ù„ Ø¹Ù…ÙŠÙ‚",
                planDay: "ØªØ®Ø·ÙŠØ· ÙŠÙˆÙ…ÙŠ",
                inbox0: "ØµÙØ± Ø±Ø³Ø§Ø¦Ù„",
                reviewGoals: "Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ù‡Ø¯Ø§Ù",
                networking: "Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ù‡Ù†ÙŠ",
                times: "Ù…Ø±Ø§Øª",
                hours: "Ø³Ø§Ø¹Ø§Øª",
                sessions: "Ø¬Ù„Ø³Ø§Øª",
                lessons: "Ø¯Ø±ÙˆØ³",
                
                // Quick Add Increments
                quickAdd: "Ø¥Ø¶Ø§ÙØ© Ø³Ø±ÙŠØ¹Ø©",
                addCustom: "Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø¯Ø§Ø± Ù…Ø®ØµØµ",
                enterAmount: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù‚Ø¯Ø§Ø±",
                add: "Ø¥Ø¶Ø§ÙØ©",
                cancel: "Ø¥Ù„ØºØ§Ø¡",
                
                // Interval Reminders
                intervalReminder: "ØªØ°ÙƒÙŠØ± Ù…ØªÙƒØ±Ø±",
                remindEvery: "ØªØ°ÙƒÙŠØ± ÙƒÙ„",
                hoursInterval: "Ø³Ø§Ø¹Ø§Øª",
                startTime: "ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡",
                endTime: "ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡",
                activeHours: "Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø· ÙÙ‚Ø·",
                saveReminder: "Ø­ÙØ¸ Ø§Ù„ØªØ°ÙƒÙŠØ±",
                intervalEnabled: "ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ± Ø§Ù„Ù…ØªÙƒØ±Ø±",
                
                // AI Coach
                aiCoach: "Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø°ÙƒÙŠ",
                askCoach: "Ø§Ø³Ø£Ù„ Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø°ÙƒÙŠ...",
                coachTip: "Ù†ØµÙŠØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø¨",
                personalizedAdvice: "Ù†ØµØ§Ø¦Ø­ Ù…Ø®ØµØµØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø§Ø¯Ø§ØªÙƒ",
                analyzing: "Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø¹Ø§Ø¯Ø§ØªÙƒ...",
                getAdvice: "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù†ØµÙŠØ­Ø©",
                coachSuggestions: "Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø¨",
                basedOnHabits: "Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø§Ø¯Ø§ØªÙƒ ÙˆØªÙ‚Ø¯Ù…Ùƒ",
                
                // Close button
                close: "Ø¥ØºÙ„Ø§Ù‚",
                
                // Review Popup
                enjoyingApp: "Ù‡Ù„ ØªØ³ØªÙ…ØªØ¹ Ø¨Ù…ÙˆÙ…Ù†ØªÙ…ØŸ",
                rateUs: "Ù‚ÙŠÙ‘Ù…Ù†Ø§",
                rateUsDesc: "ØªÙ‚ÙŠÙŠÙ…Ùƒ ÙŠØ³Ø§Ø¹Ø¯Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø³ÙŠÙ†!",
                rateNow: "â­ Ù‚ÙŠÙ‘Ù… Ø§Ù„Ø¢Ù†",
                maybeLater: "Ø±Ø¨Ù…Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹",
                noThanks: "Ù„Ø§ Ø´ÙƒØ±Ø§Ù‹",
                
                // Invite Friend
                inviteFriend: "Ø¯Ø¹ÙˆØ© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡",
                inviteDesc: "Ø´Ø§Ø±Ùƒ Ù…Ø¹ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ 7 Ø£ÙŠØ§Ù… MAX Ù…Ø¬Ø§Ù†Ø§Ù‹!",
                inviteReward: "Ø£Ù†Øª ÙˆØµØ¯ÙŠÙ‚Ùƒ ØªØ­ØµÙ„ÙˆÙ† Ø¹Ù„Ù‰ 7 Ø£ÙŠØ§Ù… MAX!",
                yourInviteCode: "Ø±Ù…Ø² Ø¯Ø¹ÙˆØªÙƒ",
                shareLink: "Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ø§Ø¨Ø·",
                copyLink: "Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·",
                linkCopied: "ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·! ğŸ‰",
                enterInviteCode: "Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² ØµØ¯ÙŠÙ‚Ùƒ",
                applyCode: "ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ù…Ø²",
                codeApplied: "ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ù…Ø²! +7 Ø£ÙŠØ§Ù… MAX! ğŸ‰",
                invalidCode: "Ø±Ù…Ø² ØºÙŠØ± ØµØ§Ù„Ø­",
                alreadyUsed: "Ø§Ù„Ø±Ù…Ø² Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„",
            }
        };

        // Language Context
        const LanguageContext = createContext();

        const useLanguage = () => useContext(LanguageContext);

        const storage = {
            get: (key, defaultValue) => { 
                try { 
                    const item = localStorage.getItem(key); 
                    if (item === null || item === undefined || item === 'undefined') {
                        return defaultValue;
                    }
                    const parsed = JSON.parse(item);
                    // If parsed is null or empty object for user, return default
                    if (parsed === null) return defaultValue;
                    return parsed;
                } catch (e) { 
                    console.error('Storage get error:', key, e);
                    return defaultValue; 
                } 
            },
            set: (key, value) => { 
                try { 
                    if (value !== undefined && value !== null) {
                        localStorage.setItem(key, JSON.stringify(value)); 
                    }
                } catch (e) {
                    console.error('Storage set error:', key, e);
                } 
            }
        };

        const FREE_LIMITS = { maxHabits: 3, analyticsHistory: 7, themes: ['purple'] };
        
        const PREMIUM_FEATURES = [
            { id: 'unlimitedHabits', emoji: 'â™¾ï¸' },
            { id: 'advancedAnalytics', emoji: 'ğŸ“Š' },
            { id: 'allThemes', emoji: 'ğŸ¨' },
            { id: 'cloudBackup', emoji: 'â˜ï¸' },
            { id: 'focusMode', emoji: 'ğŸ¯' },
            { id: 'streakProtection', emoji: 'ğŸ›¡ï¸' },
        ];
        
        const MAX_FEATURES = [
            { id: 'aiHabitCoach', emoji: 'ğŸ¤–', descKey: 'aiCoachDesc' },
            { id: 'smartReminders', emoji: 'ğŸ””', descKey: 'smartRemindersDesc' },
            { id: 'habitAnalytics', emoji: 'ğŸ“ˆ', descKey: 'advancedAnalyticsDesc' },
            { id: 'customChallenges', emoji: 'ğŸ†', descKey: 'customChallengesDesc' },
            { id: 'prioritySupport', emoji: 'ğŸ’', descKey: 'prioritySupportDesc' },
            { id: 'earlyAccess', emoji: 'ğŸš€', descKey: 'earlyAccessDesc' },
        ];
        
        // Missions System
        const DAILY_MISSIONS = [
            { id: 'complete1', key: 'missionComplete1', xp: 10, emoji: 'âœ…', check: (stats) => stats.todayCompletions >= 1 },
            { id: 'complete3', key: 'missionComplete3', xp: 25, emoji: 'ğŸ¯', check: (stats) => stats.todayCompletions >= 3 },
            { id: 'completeAll', key: 'missionCompleteAll', xp: 50, emoji: 'ğŸ†', check: (stats) => stats.completionRate === 100 },
            { id: 'login', key: 'missionLogin', xp: 5, emoji: 'ğŸ‘‹', check: () => true },
            { id: 'perfectDay', key: 'missionPerfectDay', xp: 75, emoji: 'â­', check: (stats) => stats.completionRate === 100 && stats.habitsCount >= 3 },
        ];
        
        const WEEKLY_MISSIONS = [
            { id: 'week5days', key: 'missionWeek5Days', xp: 100, emoji: 'ğŸ“…', check: (stats) => stats.daysActiveThisWeek >= 5 },
            { id: 'week7days', key: 'missionWeek7Days', xp: 200, emoji: 'ğŸ”¥', check: (stats) => stats.daysActiveThisWeek >= 7 },
            { id: 'streak7', key: 'missionStreak7', xp: 150, emoji: 'ğŸ–ï¸', check: (stats) => stats.longestStreak >= 7 },
            { id: 'addFriend', key: 'missionFriend', xp: 50, emoji: 'ğŸ‘¥', check: (stats) => stats.friendsCount >= 1 },
        ];
        
        const LEVEL_REWARDS = [
            { level: 5, emoji: 'ğŸ–ï¸', key: 'level5Reward', type: 'badge', reward: 'novice_badge' },
            { level: 10, emoji: 'ğŸŒŸ', key: 'level10Reward', type: 'title', reward: 'rising_star' },
            { level: 15, emoji: 'ğŸ¨', key: 'level15Reward', type: 'theme', reward: 'ocean' },
            { level: 20, emoji: 'ğŸ‘‘', key: 'level20Reward', type: 'avatar', reward: 'ğŸ‘‘' },
            { level: 25, emoji: 'âš¡', key: 'level25Reward', type: 'boost', reward: 'double_xp' },
            { level: 30, emoji: 'ğŸ›¡ï¸', key: 'level30Reward', type: 'item', reward: 'streak_freeze' },
        ];
        
        // Achievements System
        const ACHIEVEMENTS = [
            { id: 'firstHabit', emoji: 'ğŸŒ±', key: 'firstHabit', descKey: 'firstHabitDesc', check: (stats) => stats.totalCompletions >= 1 },
            { id: 'earlyBird', emoji: 'ğŸ¦', key: 'earlyBird', descKey: 'earlyBirdDesc', check: (stats) => stats.earlyCompletions >= 1 },
            { id: 'nightOwl', emoji: 'ğŸ¦‰', key: 'nightOwl', descKey: 'nightOwlDesc', check: (stats) => stats.lateCompletions >= 1 },
            { id: 'weekendWarrior', emoji: 'âš”ï¸', key: 'weekendWarrior', descKey: 'weekendWarriorDesc', check: (stats) => stats.weekendPerfect >= 1 },
            { id: 'streakMaster', emoji: 'ğŸ”¥', key: 'streakMaster', descKey: 'streakMasterDesc', check: (stats) => stats.longestStreak >= 30 },
            { id: 'socialButterfly', emoji: 'ğŸ¦‹', key: 'socialButterfly', descKey: 'socialButterflyDesc', check: (stats) => stats.friendsCount >= 5 },
            { id: 'perfectionist', emoji: 'ğŸ’', key: 'perfectionist', descKey: 'perfectionistDesc', check: (stats) => stats.perfectDays >= 10 },
            { id: 'habitHero', emoji: 'ğŸ¦¸', key: 'habitHero', descKey: 'habitHeroDesc', check: (stats) => stats.totalCompletions >= 100 },
            { id: 'centurion', emoji: 'ğŸ›ï¸', key: 'centurion', descKey: 'centurionDesc', check: (stats) => stats.level >= 100 },
            { id: 'dedication', emoji: 'ğŸ“…', key: 'dedication', descKey: 'dedicationDesc', check: (stats) => stats.daysUsed >= 30 },
            { id: 'speedRunner', emoji: 'âš¡', key: 'speedRunner', descKey: 'speedRunnerDesc', check: (stats) => stats.speedRuns >= 1 },
            { id: 'collector', emoji: 'ğŸ“š', key: 'collector', descKey: 'collectorDesc', check: (stats) => stats.habitsCreated >= 10 },
        ];
        
        // Notification helper
        const NotificationHelper = {
            async requestPermission() {
                if (typeof Notification === 'undefined' || !('Notification' in window)) return false;
                if (Notification.permission === 'granted') return true;
                try {
                    const permission = await Notification.requestPermission();
                    return permission === 'granted';
                } catch (e) {
                    return false;
                }
            },
            
            async scheduleReminder(habit, time, days) {
                const hasPermission = await this.requestPermission();
                if (!hasPermission) return false;
                
                // Store reminder in localStorage
                try {
                    const reminders = JSON.parse(localStorage.getItem('momentum_reminders') || '{}');
                    reminders[habit.id] = { time, days, habitName: habit.name, emoji: habit.emoji };
                    localStorage.setItem('momentum_reminders', JSON.stringify(reminders));
                } catch (e) {
                    return false;
                }
                
                return true;
            },
            
            getReminder(habitId) {
                try {
                    const reminders = JSON.parse(localStorage.getItem('momentum_reminders') || '{}');
                    return reminders[habitId] || null;
                } catch (e) {
                    return null;
                }
            },
            
            removeReminder(habitId) {
                try {
                    const reminders = JSON.parse(localStorage.getItem('momentum_reminders') || '{}');
                    delete reminders[habitId];
                    localStorage.setItem('momentum_reminders', JSON.stringify(reminders));
                } catch (e) {}
            },
            
            async showNotification(title, body, icon = 'ğŸ¯') {
                if (typeof Notification === 'undefined' || Notification.permission !== 'granted') return;
                try {
                    new Notification(title, { body, icon: '/icon.png', badge: '/badge.png', tag: 'momentum-reminder' });
                } catch (e) {}
            }
        };
        
        // Sound Helper - Web Audio API based sounds
        const SoundHelper = {
            audioContext: null,
            enabled: true,
            
            init() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    this.enabled = false;
                }
            },
            
            playTap() {
                if (!this.enabled || !this.audioContext) return;
                try {
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    osc.connect(gain);
                    gain.connect(this.audioContext.destination);
                    osc.frequency.value = 800;
                    osc.type = 'sine';
                    gain.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.1);
                    osc.start(this.audioContext.currentTime);
                    osc.stop(this.audioContext.currentTime + 0.1);
                } catch (e) {}
            },
            
            playSuccess() {
                if (!this.enabled || !this.audioContext) return;
                try {
                    const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
                    notes.forEach((freq, i) => {
                        const osc = this.audioContext.createOscillator();
                        const gain = this.audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(this.audioContext.destination);
                        osc.frequency.value = freq;
                        osc.type = 'sine';
                        const startTime = this.audioContext.currentTime + i * 0.1;
                        gain.gain.setValueAtTime(0.15, startTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
                        osc.start(startTime);
                        osc.stop(startTime + 0.3);
                    });
                } catch (e) {}
            },
            
            playLevelUp() {
                if (!this.enabled || !this.audioContext) return;
                try {
                    const notes = [392, 523.25, 659.25, 783.99, 1046.50]; // G4, C5, E5, G5, C6
                    notes.forEach((freq, i) => {
                        const osc = this.audioContext.createOscillator();
                        const gain = this.audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(this.audioContext.destination);
                        osc.frequency.value = freq;
                        osc.type = 'triangle';
                        const startTime = this.audioContext.currentTime + i * 0.12;
                        gain.gain.setValueAtTime(0.2, startTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.4);
                        osc.start(startTime);
                        osc.stop(startTime + 0.4);
                    });
                } catch (e) {}
            },
            
            playClick() {
                if (!this.enabled || !this.audioContext) return;
                try {
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    osc.connect(gain);
                    gain.connect(this.audioContext.destination);
                    osc.frequency.value = 1200;
                    osc.type = 'square';
                    gain.gain.setValueAtTime(0.05, this.audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + 0.05);
                    osc.start(this.audioContext.currentTime);
                    osc.stop(this.audioContext.currentTime + 0.05);
                } catch (e) {}
            },
            
            // New sound for theme change - magical whoosh
            playThemeChange() {
                if (!this.enabled || !this.audioContext) return;
                try {
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    osc.connect(gain);
                    gain.connect(this.audioContext.destination);
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(300, this.audioContext.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(800, this.audioContext.currentTime + 0.2);
                    osc.frequency.exponentialRampToValueAtTime(400, this.audioContext.currentTime + 0.4);
                    gain.gain.setValueAtTime(0.15, this.audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.4);
                    osc.start(this.audioContext.currentTime);
                    osc.stop(this.audioContext.currentTime + 0.4);
                } catch (e) {}
            },
            
            // New sound for language change - two-tone switch
            playLanguageChange() {
                if (!this.enabled || !this.audioContext) return;
                try {
                    const notes = [440, 554.37]; // A4, C#5
                    notes.forEach((freq, i) => {
                        const osc = this.audioContext.createOscillator();
                        const gain = this.audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(this.audioContext.destination);
                        osc.frequency.value = freq;
                        osc.type = 'sine';
                        const startTime = this.audioContext.currentTime + i * 0.15;
                        gain.gain.setValueAtTime(0.12, startTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.2);
                        osc.start(startTime);
                        osc.stop(startTime + 0.2);
                    });
                } catch (e) {}
            },
            
            // Notification/reminder sound
            playNotification() {
                if (!this.enabled || !this.audioContext) return;
                try {
                    const notes = [880, 1108.73, 880]; // A5, C#6, A5
                    notes.forEach((freq, i) => {
                        const osc = this.audioContext.createOscillator();
                        const gain = this.audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(this.audioContext.destination);
                        osc.frequency.value = freq;
                        osc.type = 'sine';
                        const startTime = this.audioContext.currentTime + i * 0.12;
                        gain.gain.setValueAtTime(0.1, startTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.15);
                        osc.start(startTime);
                        osc.stop(startTime + 0.15);
                    });
                } catch (e) {}
            }
        };
        
        // Initialize sound on first user interaction
        document.addEventListener('click', () => {
            if (!SoundHelper.audioContext) SoundHelper.init();
        }, { once: true });
        
        // Check and trigger reminders
        const checkReminders = () => {
            const reminders = JSON.parse(localStorage.getItem('momentum_reminders') || '{}');
            const now = new Date();
            const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            const currentDay = now.getDay();
            
            Object.entries(reminders).forEach(([habitId, reminder]) => {
                if (reminder.time === currentTime && reminder.days.includes(currentDay)) {
                    NotificationHelper.showNotification(
                        `â° Time for: ${reminder.habitName}`,
                        `Don't forget to complete your habit! ${reminder.emoji}`,
                    );
                }
            });
        };
        
        // Check reminders every minute
        setInterval(checkReminders, 60000);

        const Confetti = ({ active }) => {
            if (!active) return null;
            const colors = ['#667eea', '#764ba2', '#f093fb', '#ff6b6b', '#feca57', '#48dbfb', '#FFD700'];
            return (<div className="fixed inset-0 pointer-events-none z-50">{Array.from({ length: 50 }).map((_, i) => (<div key={i} className="confetti" style={{ left: `${Math.random() * 100}%`, backgroundColor: colors[Math.floor(Math.random() * colors.length)], animationDelay: `${Math.random() * 0.5}s`, borderRadius: Math.random() > 0.5 ? '50%' : '2px', width: `${8 + Math.random() * 8}px`, height: `${8 + Math.random() * 8}px` }} />))}</div>);
        };

        const CircularProgress = ({ progress, size = 120, strokeWidth = 8, children }) => {
            const radius = (size - strokeWidth) / 2;
            const circumference = radius * 2 * Math.PI;
            const offset = circumference - (progress / 100) * circumference;
            return (
                <div className="relative" style={{ width: size, height: size }}>
                    <svg width={size} height={size} className="transform -rotate-90">
                        <circle cx={size / 2} cy={size / 2} r={radius} fill="none" stroke="rgba(0,0,0,0.05)" strokeWidth={strokeWidth} />
                        <circle cx={size / 2} cy={size / 2} r={radius} fill="none" stroke="url(#progressGradient)" strokeWidth={strokeWidth} strokeLinecap="round" strokeDasharray={circumference} strokeDashoffset={offset} className="progress-ring" />
                        <defs><linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stopColor="#667eea" /><stop offset="100%" stopColor="#764ba2" /></linearGradient></defs>
                    </svg>
                    <div className="absolute inset-0 flex items-center justify-center">{children}</div>
                </div>
            );
        };

        const ProBadge = ({ small = false }) => (<span className={`inline-flex items-center gap-1 pro-badge-gradient text-white font-bold rounded-full premium-badge ${small ? 'text-xs px-2 py-0.5' : 'text-sm px-3 py-1'}`}><span>ğŸ‘‘</span><span>PRO</span></span>);

        const LockedOverlay = ({ onUpgrade }) => {
            const { t } = useLanguage();
            return (
                <div className="absolute inset-0 locked-overlay rounded-2xl flex flex-col items-center justify-center z-10 cursor-pointer" onClick={onUpgrade}>
                    <div className="text-4xl mb-2 animate-pulse-glow">ğŸ”’</div>
                    <p className="text-white font-bold">{t.pro} Feature</p>
                </div>
            );
        };

        // Language Selector Component
        const LanguageSelector = ({ currentLang, onChangeLang }) => {
            const { t } = useLanguage();
            return (
                <div className="premium-card rounded-3xl p-6">
                    <h3 className="font-bold text-gray-800 mb-4">{t.language}</h3>
                    <div className="flex gap-3">
                        <button
                            onClick={() => onChangeLang('en')}
                            className={`flex-1 py-3 rounded-xl font-bold transition-all lang-btn ${currentLang === 'en' ? 'bg-gradient-to-r from-violet-500 to-purple-600 text-white shadow-lg' : 'bg-gray-100 text-gray-700'}`}
                        >
                            ğŸ‡ºğŸ‡¸ {t.english}
                        </button>
                        <button
                            onClick={() => onChangeLang('ar')}
                            className={`flex-1 py-3 rounded-xl font-bold transition-all lang-btn ${currentLang === 'ar' ? 'bg-gradient-to-r from-violet-500 to-purple-600 text-white shadow-lg' : 'bg-gray-100 text-gray-700'}`}
                        >
                            ğŸ‡¸ğŸ‡¦ {t.arabic}
                        </button>
                    </div>
                </div>
            );
        };

        // Full Onboarding Flow - Language first, then questions, then name, then gender
        const OnboardingScreen = ({ onComplete, lang, setLang }) => {
            const t = translations[lang];
            const isRTL = lang === 'ar';
            const [step, setStep] = useState(1); // 1=language, 2=goal, 3=habits count, 4=name, 5=gender
            const [selectedGoal, setSelectedGoal] = useState(null);
            const [selectedHabitCount, setSelectedHabitCount] = useState(null);
            const [name, setName] = useState('');
            const [gender, setGender] = useState(null);
            
            // Initialize sound on mount
            useEffect(() => {
                if (!SoundHelper.audioContext) SoundHelper.init();
            }, []);
            
            const goals = [
                { id: 'health', emoji: 'ğŸ’ª', label: t.buildHealthyHabits },
                { id: 'productivity', emoji: 'ğŸš€', label: t.boostProductivity },
                { id: 'wellness', emoji: 'ğŸ§˜', label: t.improveWellbeing },
                { id: 'fitness', emoji: 'ğŸƒ', label: t.trackFitness },
                { id: 'learning', emoji: 'ğŸ“š', label: t.learnNewSkills },
                { id: 'other', emoji: 'âœ¨', label: t.other },
            ];
            
            const habitCounts = [
                { id: 'few', emoji: 'ğŸ¯', label: t.justOne },
                { id: 'some', emoji: 'ğŸ“Š', label: t.aFew },
                { id: 'many', emoji: 'ğŸ”¥', label: t.many },
            ];
            
            const genderOptions = [
                { id: 'male', emoji: 'ğŸ‘¨', label: t.male },
                { id: 'female', emoji: 'ğŸ‘©', label: t.female },
                { id: 'other', emoji: 'ğŸ§‘', label: t.preferNotToSay },
            ];
            
            const handleComplete = () => {
                if (name.trim()) {
                    SoundHelper.playLevelUp();
                    storage.set('momentum_user_name', name.trim());
                    storage.set('momentum_user_goal', selectedGoal);
                    storage.set('momentum_user_habit_count', selectedHabitCount);
                    storage.set('momentum_user_gender', gender);
                    onComplete(name.trim(), gender);
                }
            };
            
            const nextStep = (nextStepNum) => {
                SoundHelper.playSuccess();
                setStep(nextStepNum);
            };
            
            const prevStep = (prevStepNum) => {
                SoundHelper.playClick();
                setStep(prevStepNum);
            };
            
            return (
                <div dir={isRTL ? 'rtl' : 'ltr'} className="fixed inset-0 z-50 bg-gradient-to-br from-violet-600 via-purple-600 to-fuchsia-600 flex flex-col items-center justify-center p-6 overflow-y-auto">
                    <div className="max-w-md w-full">
                        {/* Progress dots */}
                        <div className="flex justify-center gap-2 mb-8">
                            {[1, 2, 3, 4, 5].map(i => (
                                <div key={i} className={`w-3 h-3 rounded-full transition-all duration-300 ${step >= i ? 'bg-white scale-110' : 'bg-white/30'}`} />
                            ))}
                        </div>
                        
                        {/* Step 1: Language Selection */}
                        {step === 1 && (
                            <div className="text-center animate-bounce-in">
                                <div className="text-7xl mb-6 float-gentle">ğŸŒ</div>
                                <h1 className="text-3xl font-black text-white mb-8">{t.selectLanguage}</h1>
                                
                                <div className="space-y-3 mb-8">
                                    <button
                                        onClick={() => { SoundHelper.playTap(); setLang('en'); }}
                                        className={`option-card w-full py-4 rounded-2xl font-bold text-lg flex items-center justify-center gap-3 ${lang === 'en' ? 'bg-white text-purple-600 shadow-xl selected' : 'bg-white/20 text-white btn-glass'}`}
                                    >
                                        <span className="text-2xl">ğŸ‡ºğŸ‡¸</span> English
                                    </button>
                                    <button
                                        onClick={() => { SoundHelper.playTap(); setLang('ar'); }}
                                        className={`option-card w-full py-4 rounded-2xl font-bold text-lg flex items-center justify-center gap-3 ${lang === 'ar' ? 'bg-white text-purple-600 shadow-xl selected' : 'bg-white/20 text-white btn-glass'}`}
                                    >
                                        <span className="text-2xl">ğŸ‡¸ğŸ‡¦</span> Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
                                    </button>
                                </div>
                                
                                <button
                                    onClick={() => nextStep(2)}
                                    className="btn-3d shine w-full py-4 bg-white text-purple-600 rounded-2xl font-black text-xl shadow-xl"
                                >
                                    {t.next} â†’
                                </button>
                            </div>
                        )}
                        
                        {/* Step 2: What brings you */}
                        {step === 2 && (
                            <div className="text-center animate-bounce-in">
                                <div className="text-6xl mb-4 float-gentle">ğŸ¯</div>
                                <h1 className="text-2xl font-black text-white mb-2">{t.whatBringsYou}</h1>
                                <p className="text-white/70 mb-6">{t.letsGetStarted}</p>
                                
                                <div className="grid grid-cols-2 gap-3 mb-6">
                                    {goals.map(goal => (
                                        <button
                                            key={goal.id}
                                            onClick={() => { SoundHelper.playTap(); setSelectedGoal(goal.id); }}
                                            className={`option-card p-4 rounded-2xl font-semibold flex flex-col items-center gap-2 ${selectedGoal === goal.id ? 'bg-white text-purple-600 shadow-xl selected' : 'bg-white/20 text-white btn-glass'}`}
                                        >
                                            <span className="text-3xl">{goal.emoji}</span>
                                            <span className="text-sm">{goal.label}</span>
                                        </button>
                                    ))}
                                </div>
                                
                                <div className="flex gap-3">
                                    <button onClick={() => prevStep(1)} className="btn-3d flex-1 py-3 bg-white/20 text-white rounded-2xl font-bold btn-glass">{t.back}</button>
                                    <button
                                        onClick={() => selectedGoal && nextStep(3)}
                                        disabled={!selectedGoal}
                                        className="btn-3d shine flex-1 py-3 bg-white text-purple-600 rounded-2xl font-black disabled:opacity-50"
                                    >
                                        {t.next} â†’
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        {/* Step 3: How many habits */}
                        {step === 3 && (
                            <div className="text-center animate-bounce-in">
                                <div className="text-6xl mb-4 float-gentle">ğŸ“Š</div>
                                <h1 className="text-2xl font-black text-white mb-6">{t.howManyHabits}</h1>
                                
                                <div className="space-y-3 mb-6">
                                    {habitCounts.map(count => (
                                        <button
                                            key={count.id}
                                            onClick={() => { SoundHelper.playTap(); setSelectedHabitCount(count.id); }}
                                            className={`option-card w-full p-4 rounded-2xl font-semibold flex items-center justify-center gap-3 ${selectedHabitCount === count.id ? 'bg-white text-purple-600 shadow-xl selected' : 'bg-white/20 text-white btn-glass'}`}
                                        >
                                            <span className="text-2xl">{count.emoji}</span>
                                            <span>{count.label}</span>
                                        </button>
                                    ))}
                                </div>
                                
                                <div className="flex gap-3">
                                    <button onClick={() => prevStep(2)} className="btn-3d flex-1 py-3 bg-white/20 text-white rounded-2xl font-bold btn-glass">{t.back}</button>
                                    <button
                                        onClick={() => selectedHabitCount && nextStep(4)}
                                        disabled={!selectedHabitCount}
                                        className="btn-3d shine flex-1 py-3 bg-white text-purple-600 rounded-2xl font-black disabled:opacity-50"
                                    >
                                        {t.next} â†’
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        {/* Step 4: Name */}
                        {step === 4 && (
                            <div className="text-center animate-bounce-in">
                                <div className="text-7xl mb-4 float-gentle">ğŸ‘‹</div>
                                <h1 className="text-3xl font-black text-white mb-2">{t.greatChoice}</h1>
                                <p className="text-white/80 text-lg mb-6">{t.whatsYourName}</p>
                                
                                <input
                                    type="text"
                                    value={name}
                                    onChange={(e) => setName(e.target.value)}
                                    placeholder={t.namePlaceholder}
                                    className="w-full px-6 py-4 bg-white/20 border-2 border-white/30 rounded-2xl text-white text-xl font-semibold text-center placeholder-white/50 outline-none focus:border-white/60 mb-6 transition-all"
                                    dir={isRTL ? 'rtl' : 'ltr'}
                                    onKeyPress={(e) => e.key === 'Enter' && name.trim() && nextStep(5)}
                                />
                                
                                <div className="flex gap-3">
                                    <button onClick={() => prevStep(3)} className="btn-3d flex-1 py-3 bg-white/20 text-white rounded-2xl font-bold btn-glass">{t.back}</button>
                                    <button
                                        onClick={() => nextStep(5)}
                                        disabled={!name.trim()}
                                        className="btn-3d shine flex-1 py-4 bg-white text-purple-600 rounded-2xl font-black text-lg disabled:opacity-50"
                                    >
                                        {t.next} â†’
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        {/* Step 5: Gender */}
                        {step === 5 && (
                            <div className="text-center animate-bounce-in">
                                <div className="text-7xl mb-4 float-gentle">âœ¨</div>
                                <h1 className="text-2xl font-black text-white mb-6">{t.selectGender}</h1>
                                
                                <div className="space-y-3 mb-6">
                                    {genderOptions.map(option => (
                                        <button
                                            key={option.id}
                                            onClick={() => { SoundHelper.playTap(); setGender(option.id); }}
                                            className={`option-card w-full p-4 rounded-2xl font-semibold flex items-center justify-center gap-3 ${gender === option.id ? 'bg-white text-purple-600 shadow-xl selected' : 'bg-white/20 text-white btn-glass'}`}
                                        >
                                            <span className="text-2xl">{option.emoji}</span>
                                            <span>{option.label}</span>
                                        </button>
                                    ))}
                                </div>
                                
                                <div className="flex gap-3">
                                    <button onClick={() => prevStep(4)} className="btn-3d flex-1 py-3 bg-white/20 text-white rounded-2xl font-bold btn-glass">{t.back}</button>
                                    <button
                                        onClick={handleComplete}
                                        disabled={!gender}
                                        className="btn-3d btn-neon shine flex-1 py-4 bg-white text-purple-600 rounded-2xl font-black text-lg disabled:opacity-50"
                                    >
                                        {t.continue} â†’
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const WelcomeScreen = ({ onStartTrial, onSkip }) => {
            const { t } = useLanguage();
            
            useEffect(() => {
                if (!SoundHelper.audioContext) SoundHelper.init();
            }, []);
            
            return (
                <div className="fixed inset-0 z-50 bg-gradient-to-br from-violet-600 via-purple-600 to-fuchsia-600 flex flex-col items-center justify-center p-6">
                    <div className="max-w-md w-full text-center animate-bounce-in">
                        <div className="text-8xl mb-6 animate-crown float-gentle">ğŸ‘‘</div>
                        <h1 className="text-4xl font-black text-white mb-3">{t.welcomeTitle}</h1>
                        <p className="text-white/80 text-lg mb-8">{t.welcomeSubtitle}</p>
                        
                        <div className="card-3d bg-white/10 rounded-2xl p-4 mb-6 backdrop-blur-sm">
                            <p className="text-white font-semibold mb-3">âœ¨ {t.tryProFree}</p>
                            <div className="grid grid-cols-2 gap-2 text-sm text-white/80">
                                <div className="flex items-center gap-2"><span>âœ“</span> {t.unlimitedHabits}</div>
                                <div className="flex items-center gap-2"><span>âœ“</span> {t.ninetyDayAnalytics}</div>
                                <div className="flex items-center gap-2"><span>âœ“</span> {t.tenPlusThemes}</div>
                                <div className="flex items-center gap-2"><span>âœ“</span> {t.challenges}</div>
                            </div>
                        </div>
                        
                        <button onClick={() => { SoundHelper.playSuccess(); onStartTrial(); }} className="btn-3d btn-neon shine w-full py-4 bg-gradient-to-r from-green-400 to-emerald-500 text-white rounded-2xl font-black text-xl shadow-xl mb-4">{t.startFreeTrial}</button>
                        <button onClick={() => { SoundHelper.playClick(); onSkip(); }} className="btn-3d btn-glass w-full py-3 bg-white/20 text-white rounded-2xl font-semibold">{t.continueFreePlan}</button>
                        <p className="text-white/50 text-xs mt-4">{t.noCreditCard}</p>
                    </div>
                </div>
            );
        };

        const Paywall = ({ onClose, onPurchase, trialDaysLeft, canStartTrial }) => {
            const { t } = useLanguage();
            const [selectedPlan, setSelectedPlan] = useState('yearly');
            const [processing, setProcessing] = useState(false);
            const plans = { monthly: { price: 2.99, period: t.monthly }, yearly: { price: 17.99, period: t.yearly, savings: '50%', popular: true }, lifetime: { price: 49.99, period: t.lifetime, savings: t.bestValue } };

            const handlePurchase = async () => { setProcessing(true); await new Promise(r => setTimeout(r, 1500)); onPurchase(selectedPlan); };
            const handleStartTrial = () => { onPurchase('trial'); };

            return (
                <div className="fixed inset-0 z-50 paywall-bg overflow-y-auto">
                    <div className="min-h-screen flex flex-col p-6">
                        <button onClick={onClose} className="self-end text-white/60 text-3xl mb-4 hover:text-white">Ã—</button>
                        <div className="text-center mb-6 animate-bounce-in">
                            <div className="text-6xl animate-crown mb-4">ğŸ‘‘</div>
                            <h1 className="text-4xl font-black text-white mb-2">{t.upgradeToPro}</h1>
                            <p className="text-white/80 text-lg">{t.unlockPotential}</p>
                        </div>

                        {canStartTrial && (
                            <button onClick={handleStartTrial} className="w-full py-5 bg-gradient-to-r from-green-400 to-emerald-500 text-white rounded-2xl font-black text-xl shadow-xl mb-6 animate-pulse-glow">{t.startFreeTrial}</button>
                        )}

                        {trialDaysLeft > 0 && (
                            <div className="bg-green-500/20 border border-green-400/30 rounded-2xl p-4 mb-6 text-center">
                                <p className="text-white font-bold text-lg">âœ¨ {t.trialActive}: {trialDaysLeft} {t.daysLeft}</p>
                                <p className="text-white/70 text-sm">{t.enjoyingPro}</p>
                            </div>
                        )}

                        <div className="grid grid-cols-2 gap-3 mb-6">
                            {PREMIUM_FEATURES.slice(0, 6).map((f) => (<div key={f.id} className="bg-white/10 rounded-2xl p-4 text-center"><div className="text-3xl mb-2">{f.emoji}</div><p className="text-white font-semibold text-sm">{t[`feat_${f.id}`]}</p></div>))}
                        </div>

                        <p className="text-white/60 text-center text-sm mb-4">{t.orChoosePlan}</p>

                        <div className="space-y-3 mb-6">
                            {Object.entries(plans).map(([key, plan]) => (
                                <button key={key} onClick={() => setSelectedPlan(key)} className={`w-full p-4 rounded-2xl flex items-center justify-between transition-all ${selectedPlan === key ? 'bg-white shadow-xl scale-[1.02]' : 'bg-white/20 hover:bg-white/30'}`}>
                                    <div className="flex items-center gap-3">
                                        <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${selectedPlan === key ? 'border-purple-600 bg-purple-600' : 'border-white/50'}`}>{selectedPlan === key && <span className="text-white text-sm">âœ“</span>}</div>
                                        <div className="text-left">
                                            <p className={`font-bold capitalize ${selectedPlan === key ? 'text-gray-800' : 'text-white'}`}>{plan.period}{plan.popular && <span className="mx-2 text-xs bg-gradient-to-r from-orange-400 to-pink-500 text-white px-2 py-0.5 rounded-full">{t.popular}</span>}</p>
                                            <p className={`text-sm ${selectedPlan === key ? 'text-gray-500' : 'text-white/70'}`}>{key === 'lifetime' ? t.oneTime : `${t.billed} ${plan.period}`}</p>
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <p className={`text-2xl font-black ${selectedPlan === key ? 'text-gray-800' : 'text-white'}`}>${plan.price}</p>
                                        {plan.savings && <p className="text-xs text-green-500 font-bold">{t.save} {plan.savings}</p>}
                                    </div>
                                </button>
                            ))}
                        </div>
                        <button onClick={handlePurchase} disabled={processing} className="w-full py-4 bg-white text-purple-600 rounded-2xl font-black text-lg shadow-xl disabled:opacity-50 mb-4">{processing ? t.processing : `${t.purchase} - $${plans[selectedPlan].price}`}</button>
                        <p className="text-center text-white/50 text-xs">{t.cancelAnytime}</p>
                    </div>
                </div>
            );
        };

        // MAX Paywall Component
        const MaxPaywall = ({ onClose, onPurchase, isPro }) => {
            const { t } = useLanguage();
            const [selectedPlan, setSelectedPlan] = useState('maxYearly');
            const [processing, setProcessing] = useState(false);
            
            const maxPlans = { 
                maxMonthly: { price: 4.99, period: t.monthly }, 
                maxYearly: { price: 29.99, period: t.yearly, savings: '50%', popular: true }, 
                maxLifetime: { price: 79.99, period: t.lifetime, savings: t.bestValue } 
            };

            const handlePurchase = async () => { 
                setProcessing(true); 
                await new Promise(r => setTimeout(r, 1500)); 
                onPurchase(selectedPlan); 
            };

            return (
                <div className="fixed inset-0 z-50 overflow-y-auto" style={{background: 'linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)'}}>
                    <div className="min-h-screen flex flex-col p-6">
                        <button onClick={onClose} className="self-end text-white/60 text-3xl mb-4 hover:text-white">Ã—</button>
                        <div className="text-center mb-6 animate-bounce-in">
                            <div className="text-6xl mb-4">ğŸ’</div>
                            <h1 className="text-4xl font-black text-white mb-2">{t.maxSubscription}</h1>
                            <p className="text-white/80 text-lg">{t.everythingInPro}</p>
                        </div>

                        <div className="grid grid-cols-2 gap-3 mb-6">
                            {MAX_FEATURES.map((f) => (
                                <div key={f.id} className="bg-white/10 rounded-2xl p-4">
                                    <div className="text-3xl mb-2">{f.emoji}</div>
                                    <p className="text-white font-semibold text-sm">{t[f.id]}</p>
                                    <p className="text-white/60 text-xs mt-1">{t[f.descKey]}</p>
                                </div>
                            ))}
                        </div>

                        <p className="text-white/60 text-center text-sm mb-4">{t.orChoosePlan}</p>

                        <div className="space-y-3 mb-6">
                            {Object.entries(maxPlans).map(([key, plan]) => (
                                <button key={key} onClick={() => setSelectedPlan(key)} className={`w-full p-4 rounded-2xl flex items-center justify-between transition-all ${selectedPlan === key ? 'bg-gradient-to-r from-cyan-400 to-blue-500 shadow-xl scale-[1.02]' : 'bg-white/10 hover:bg-white/20'}`}>
                                    <div className="flex items-center gap-3">
                                        <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${selectedPlan === key ? 'border-white bg-white' : 'border-white/50'}`}>{selectedPlan === key && <span className="text-blue-500 text-sm">âœ“</span>}</div>
                                        <div className="text-left">
                                            <p className="font-bold capitalize text-white">{plan.period}{plan.popular && <span className="mx-2 text-xs bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-2 py-0.5 rounded-full">{t.popular}</span>}</p>
                                            <p className="text-sm text-white/70">{key === 'maxLifetime' ? t.oneTime : `${t.billed} ${plan.period}`}</p>
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-2xl font-black text-white">${plan.price}</p>
                                        {plan.savings && <p className="text-xs text-green-400 font-bold">{t.save} {plan.savings}</p>}
                                    </div>
                                </button>
                            ))}
                        </div>
                        <button onClick={handlePurchase} disabled={processing} className="w-full py-4 bg-gradient-to-r from-cyan-400 to-blue-500 text-white rounded-2xl font-black text-lg shadow-xl disabled:opacity-50 mb-4">{processing ? t.processing : `${t.purchase} - $${maxPlans[selectedPlan].price}`}</button>
                        <p className="text-center text-white/50 text-xs">{t.cancelAnytime}</p>
                    </div>
                </div>
            );
        };

        // Reminder Modal Component
        const ReminderModal = ({ habit, onClose, onSave, hasMaxAccess }) => {
            const { t, isRTL } = useLanguage();
            const existingReminder = NotificationHelper.getReminder(habit.id);
            const [time, setTime] = useState(existingReminder?.time || '09:00');
            const [selectedDays, setSelectedDays] = useState(existingReminder?.days || [0, 1, 2, 3, 4, 5, 6]);
            const [saving, setSaving] = useState(false);
            const [reminderType, setReminderType] = useState(existingReminder?.interval ? 'interval' : 'daily');
            const [intervalHours, setIntervalHours] = useState(existingReminder?.intervalHours || 3);
            const [startHour, setStartHour] = useState(existingReminder?.startHour || '08:00');
            const [endHour, setEndHour] = useState(existingReminder?.endHour || '22:00');
            
            const dayLabels = [t.sun, t.mon, t.tue, t.wed, t.thu, t.fri, t.sat];
            
            const toggleDay = (day) => {
                SoundHelper.playTap();
                if (selectedDays.includes(day)) {
                    setSelectedDays(selectedDays.filter(d => d !== day));
                } else {
                    setSelectedDays([...selectedDays, day].sort());
                }
            };
            
            const handleSave = async () => {
                setSaving(true);
                SoundHelper.playSuccess();
                
                if (reminderType === 'interval') {
                    // Save interval reminder
                    const intervalReminder = {
                        time: startHour,
                        days: selectedDays,
                        habitName: habit.name,
                        emoji: habit.emoji,
                        interval: true,
                        intervalHours,
                        startHour,
                        endHour
                    };
                    const reminders = JSON.parse(localStorage.getItem('momentum_reminders') || '{}');
                    reminders[habit.id] = intervalReminder;
                    localStorage.setItem('momentum_reminders', JSON.stringify(reminders));
                    
                    // Setup interval check
                    localStorage.setItem(`momentum_interval_${habit.id}`, JSON.stringify({
                        nextReminder: new Date().getTime() + (intervalHours * 60 * 60 * 1000),
                        intervalHours,
                        startHour,
                        endHour,
                        habitName: habit.name,
                        emoji: habit.emoji
                    }));
                    
                    setSaving(false);
                    onSave();
                    onClose();
                } else {
                    const success = await NotificationHelper.scheduleReminder(habit, time, selectedDays);
                    setSaving(false);
                    if (success) {
                        onSave();
                        onClose();
                    }
                }
            };
            
            const handleRemove = () => {
                SoundHelper.playClick();
                NotificationHelper.removeReminder(habit.id);
                localStorage.removeItem(`momentum_interval_${habit.id}`);
                onClose();
            };
            
            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end justify-center" onClick={onClose}>
                    <div className="bg-white rounded-t-3xl w-full max-w-lg p-6 animate-slide-up max-h-[85vh] overflow-y-auto" onClick={e => e.stopPropagation()} dir={isRTL ? 'rtl' : 'ltr'}>
                        <div className="flex items-center justify-between mb-6">
                            <div className="flex items-center gap-3">
                                <span className="text-3xl">{habit.emoji}</span>
                                <div>
                                    <h2 className="text-xl font-black text-gray-800">{t.setReminder}</h2>
                                    <p className="text-sm text-gray-500">{habit.name}</p>
                                </div>
                            </div>
                            <button onClick={() => { SoundHelper.playClick(); onClose(); }} className="text-gray-400 text-2xl">Ã—</button>
                        </div>
                        
                        {!hasMaxAccess ? (
                            <div className="text-center py-8">
                                <div className="text-6xl mb-4">ğŸ’</div>
                                <h3 className="text-xl font-bold text-gray-800 mb-2">{t.smartReminders}</h3>
                                <p className="text-gray-500 mb-4">{t.smartRemindersDesc}</p>
                                <p className="text-sm text-gray-400 mb-4">MAX feature</p>
                            </div>
                        ) : (
                            <>
                                {/* Reminder Type Toggle */}
                                <div className="flex gap-2 mb-6">
                                    <button 
                                        onClick={() => { SoundHelper.playTap(); setReminderType('daily'); }}
                                        className={`flex-1 py-3 rounded-2xl font-semibold transition-all ${reminderType === 'daily' ? 'bg-gradient-to-r from-violet-500 to-purple-600 text-white' : 'bg-gray-100 text-gray-600'}`}
                                    >
                                        ğŸ• {t.reminderTime}
                                    </button>
                                    <button 
                                        onClick={() => { SoundHelper.playTap(); setReminderType('interval'); }}
                                        className={`flex-1 py-3 rounded-2xl font-semibold transition-all ${reminderType === 'interval' ? 'bg-gradient-to-r from-cyan-400 to-blue-500 text-white' : 'bg-gray-100 text-gray-600'}`}
                                    >
                                        ğŸ”„ {t.intervalReminder}
                                    </button>
                                </div>
                                
                                {reminderType === 'daily' ? (
                                    <div className="mb-6">
                                        <label className="text-sm font-medium text-gray-600 mb-2 block">{t.reminderTime}</label>
                                        <input 
                                            type="time" 
                                            value={time} 
                                            onChange={(e) => setTime(e.target.value)}
                                            className="w-full px-4 py-3 bg-gray-50 rounded-2xl outline-none text-gray-800 text-lg font-semibold"
                                        />
                                    </div>
                                ) : (
                                    <div className="space-y-4 mb-6">
                                        <div>
                                            <label className="text-sm font-medium text-gray-600 mb-2 block">{t.remindEvery}</label>
                                            <div className="flex gap-2 items-center">
                                                <select 
                                                    value={intervalHours}
                                                    onChange={(e) => setIntervalHours(parseInt(e.target.value))}
                                                    className="flex-1 px-4 py-3 bg-gray-50 rounded-2xl outline-none text-gray-800 text-lg font-semibold"
                                                >
                                                    <option value={1}>1</option>
                                                    <option value={2}>2</option>
                                                    <option value={3}>3</option>
                                                    <option value={4}>4</option>
                                                    <option value={6}>6</option>
                                                    <option value={8}>8</option>
                                                </select>
                                                <span className="text-gray-600 font-medium">{t.hoursInterval}</span>
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div>
                                                <label className="text-sm font-medium text-gray-600 mb-2 block">{t.startTime}</label>
                                                <input 
                                                    type="time" 
                                                    value={startHour} 
                                                    onChange={(e) => setStartHour(e.target.value)}
                                                    className="w-full px-4 py-3 bg-gray-50 rounded-2xl outline-none text-gray-800 font-semibold"
                                                />
                                            </div>
                                            <div>
                                                <label className="text-sm font-medium text-gray-600 mb-2 block">{t.endTime}</label>
                                                <input 
                                                    type="time" 
                                                    value={endHour} 
                                                    onChange={(e) => setEndHour(e.target.value)}
                                                    className="w-full px-4 py-3 bg-gray-50 rounded-2xl outline-none text-gray-800 font-semibold"
                                                />
                                            </div>
                                        </div>
                                        <p className="text-xs text-gray-400 text-center">ğŸ’¡ {t.activeHours}</p>
                                    </div>
                                )}
                                
                                <div className="mb-6">
                                    <label className="text-sm font-medium text-gray-600 mb-3 block">{t.reminderDays}</label>
                                    <div className="flex gap-2 justify-between">
                                        {dayLabels.map((label, i) => (
                                            <button
                                                key={i}
                                                onClick={() => toggleDay(i)}
                                                className={`btn-3d w-10 h-10 rounded-full font-semibold text-sm transition-all ${selectedDays.includes(i) ? 'bg-gradient-to-r from-violet-500 to-purple-600 text-white' : 'bg-gray-100 text-gray-600'}`}
                                            >
                                                {label.charAt(0)}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                
                                <button 
                                    onClick={handleSave} 
                                    disabled={saving || selectedDays.length === 0}
                                    className="btn-3d w-full py-4 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-2xl font-bold text-lg shadow-lg disabled:opacity-50 mb-3"
                                >
                                    {saving ? '...' : t.saveReminder}
                                </button>
                                
                                {existingReminder && (
                                    <button onClick={handleRemove} className="btn-3d w-full py-3 bg-red-50 text-red-600 rounded-2xl font-semibold">
                                        {t.noReminder}
                                    </button>
                                )}
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // Friends Modal Component
        const FriendsModal = ({ onClose, friends, userId, onAddFriend, onViewProfile, onRemoveFriend, hasProAccess, onUpgrade }) => {
            const { t, isRTL } = useLanguage();
            const [copied, setCopied] = useState(false);
            
            const copyId = () => {
                navigator.clipboard.writeText(userId);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };
            
            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end justify-center" onClick={onClose}>
                    <div className="bg-white rounded-t-3xl w-full max-w-lg p-6 animate-slide-up max-h-[85vh] overflow-y-auto" onClick={e => e.stopPropagation()} dir={isRTL ? 'rtl' : 'ltr'}>
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-2xl font-black text-gray-800">ğŸ‘¥ {t.friends}</h2>
                            <button onClick={onClose} className="text-gray-400 text-2xl">Ã—</button>
                        </div>
                        
                        {!hasProAccess ? (
                            <div className="text-center py-8">
                                <div className="text-6xl mb-4">ğŸ‘¥</div>
                                <h3 className="text-xl font-bold text-gray-800 mb-2">{t.friends}</h3>
                                <p className="text-gray-500 mb-4">{t.addFriendsToCompete}</p>
                                <button onClick={onUpgrade} className="px-6 py-3 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-xl font-bold">
                                    ğŸ‘‘ {t.upgradeToPro}
                                </button>
                            </div>
                        ) : (
                            <>
                                {/* Your ID Section */}
                                <div className="bg-gradient-to-r from-violet-50 to-purple-50 rounded-2xl p-4 mb-6">
                                    <p className="text-sm text-gray-500 mb-2">{t.yourId}</p>
                                    <div className="flex items-center gap-3">
                                        <code className="flex-1 bg-white px-4 py-2 rounded-xl font-mono font-bold text-purple-600 text-center">{userId}</code>
                                        <button onClick={copyId} className="px-4 py-2 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-xl font-bold text-sm">
                                            {copied ? 'âœ“' : t.copyId}
                                        </button>
                                    </div>
                                </div>
                                
                                {/* Add Friend Button */}
                                <button onClick={onAddFriend} className="w-full py-3 bg-gradient-to-r from-green-400 to-emerald-500 text-white rounded-2xl font-bold mb-6 flex items-center justify-center gap-2">
                                    <span>â•</span> {t.addFriend}
                                </button>
                                
                                {/* Friends List */}
                                <div className="space-y-3">
                                    <h3 className="font-bold text-gray-800">{t.friendsList}</h3>
                                    {friends.length === 0 ? (
                                        <div className="text-center py-8 bg-gray-50 rounded-2xl">
                                            <div className="text-4xl mb-2">ğŸ˜¢</div>
                                            <p className="text-gray-500">{t.noFriendsYet}</p>
                                            <p className="text-sm text-gray-400">{t.addFriendsToCompete}</p>
                                        </div>
                                    ) : (
                                        friends.map(friend => (
                                            <div key={friend.id} className="bg-gray-50 rounded-2xl p-4 flex items-center justify-between">
                                                <div className="flex items-center gap-3">
                                                    <div className="w-12 h-12 rounded-full bg-gradient-to-r from-violet-400 to-purple-500 flex items-center justify-center text-2xl text-white">
                                                        {friend.avatar || 'ğŸ‘¤'}
                                                    </div>
                                                    <div>
                                                        <p className="font-bold text-gray-800">{friend.name}</p>
                                                        <p className="text-sm text-gray-500">ğŸ”¥ {friend.streak} streak â€¢ Lv.{friend.level}</p>
                                                    </div>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button onClick={() => onViewProfile(friend)} className="px-3 py-1.5 bg-purple-100 text-purple-600 rounded-lg text-sm font-semibold">
                                                        {t.viewProfile}
                                                    </button>
                                                    <button onClick={() => onRemoveFriend(friend.id)} className="px-3 py-1.5 bg-red-50 text-red-500 rounded-lg text-sm font-semibold">
                                                        Ã—
                                                    </button>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // Add Friend Modal
        const AddFriendModal = ({ onClose, onAdd }) => {
            const { t, isRTL } = useLanguage();
            const [friendId, setFriendId] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            
            const handleAdd = async () => {
                if (!friendId.trim()) return;
                setLoading(true);
                setError('');
                
                // Simulate API call - in real app, this would fetch friend data from server
                await new Promise(r => setTimeout(r, 1000));
                
                // Generate mock friend data based on ID
                const mockFriend = {
                    id: friendId.toUpperCase(),
                    name: `User_${friendId.slice(-4)}`,
                    avatar: ['ğŸ¦¸', 'ğŸ§‘', 'ğŸ‘¨', 'ğŸ‘©', 'ğŸ§”', 'ğŸ‘±'][Math.floor(Math.random() * 6)],
                    level: Math.floor(Math.random() * 20) + 1,
                    streak: Math.floor(Math.random() * 30),
                    xp: Math.floor(Math.random() * 2000),
                    habitsCount: Math.floor(Math.random() * 8) + 1,
                    completedToday: Math.floor(Math.random() * 5),
                    joinedDate: new Date(Date.now() - Math.random() * 90 * 24 * 60 * 60 * 1000).toISOString(),
                };
                
                setLoading(false);
                onAdd(mockFriend);
                onClose();
            };
            
            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={onClose}>
                    <div className="bg-white rounded-3xl w-full max-w-sm p-6 animate-bounce-in" onClick={e => e.stopPropagation()} dir={isRTL ? 'rtl' : 'ltr'}>
                        <h2 className="text-xl font-black text-gray-800 mb-4">â• {t.addFriend}</h2>
                        
                        <div className="mb-4">
                            <label className="text-sm font-medium text-gray-600 mb-2 block">{t.friendId}</label>
                            <input 
                                type="text" 
                                value={friendId}
                                onChange={(e) => setFriendId(e.target.value.toUpperCase())}
                                placeholder={t.enterFriendId}
                                className="w-full px-4 py-3 bg-gray-50 rounded-2xl outline-none text-gray-800 font-mono uppercase"
                                maxLength={11}
                            />
                            {error && <p className="text-red-500 text-sm mt-2">{error}</p>}
                        </div>
                        
                        <div className="flex gap-3">
                            <button onClick={onClose} className="flex-1 py-3 bg-gray-100 text-gray-600 rounded-2xl font-bold">
                                {t.back}
                            </button>
                            <button 
                                onClick={handleAdd} 
                                disabled={!friendId.trim() || loading}
                                className="flex-1 py-3 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-2xl font-bold disabled:opacity-50"
                            >
                                {loading ? '...' : t.addFriend}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Friend Profile Modal
        const FriendProfileModal = ({ friend, onClose, user }) => {
            const { t, isRTL } = useLanguage();
            const [encouragementSent, setEncouragementSent] = useState(false);
            
            const sendEncouragement = () => {
                setEncouragementSent(true);
                setTimeout(() => setEncouragementSent(false), 3000);
            };
            
            const comparison = user.level - friend.level;
            
            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end justify-center" onClick={onClose}>
                    <div className="bg-white rounded-t-3xl w-full max-w-lg p-6 animate-slide-up max-h-[85vh] overflow-y-auto" onClick={e => e.stopPropagation()} dir={isRTL ? 'rtl' : 'ltr'}>
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-xl font-black text-gray-800">{t.friendProfile}</h2>
                            <button onClick={onClose} className="text-gray-400 text-2xl">Ã—</button>
                        </div>
                        
                        {/* Profile Header */}
                        <div className="text-center mb-6">
                            <div className="w-24 h-24 mx-auto rounded-full bg-gradient-to-r from-violet-400 to-purple-500 flex items-center justify-center text-5xl text-white mb-3">
                                {friend.avatar || 'ğŸ‘¤'}
                            </div>
                            <h3 className="text-2xl font-black text-gray-800">{friend.name}</h3>
                            <p className="text-gray-500">ID: {friend.id}</p>
                        </div>
                        
                        {/* Stats Grid */}
                        <div className="grid grid-cols-2 gap-3 mb-6">
                            <div className="bg-gradient-to-br from-orange-50 to-red-50 rounded-2xl p-4 text-center">
                                <p className="text-3xl font-black text-orange-600">ğŸ”¥ {friend.streak}</p>
                                <p className="text-sm text-gray-600">{t.friendStreak}</p>
                            </div>
                            <div className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-4 text-center">
                                <p className="text-3xl font-black text-purple-600">Lv.{friend.level}</p>
                                <p className="text-sm text-gray-600">{t.friendLevel}</p>
                            </div>
                            <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-4 text-center">
                                <p className="text-3xl font-black text-blue-600">{friend.habitsCount}</p>
                                <p className="text-sm text-gray-600">{t.friendHabits}</p>
                            </div>
                            <div className="bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-4 text-center">
                                <p className="text-3xl font-black text-green-600">{friend.completedToday}</p>
                                <p className="text-sm text-gray-600">{t.friendCompletedToday}</p>
                            </div>
                        </div>
                        
                        {/* Comparison */}
                        <div className="bg-gradient-to-r from-violet-100 to-purple-100 rounded-2xl p-4 mb-6">
                            <p className="text-center font-bold text-gray-800">
                                {t.comparing}: 
                                <span className={`mx-2 ${comparison > 0 ? 'text-green-600' : comparison < 0 ? 'text-red-500' : 'text-gray-600'}`}>
                                    {comparison > 0 ? `${comparison} ${t.ahead}` : comparison < 0 ? `${Math.abs(comparison)} ${t.behind}` : t.tied}
                                </span>
                                {comparison > 0 ? 'ğŸ†' : comparison < 0 ? 'ğŸ’ª' : 'ğŸ¤'}
                            </p>
                        </div>
                        
                        {/* Joined Date */}
                        <p className="text-center text-gray-500 text-sm mb-6">
                            {t.friendJoined}: {new Date(friend.joinedDate).toLocaleDateString()}
                        </p>
                        
                        {/* Encouragement Button */}
                        <button 
                            onClick={sendEncouragement}
                            disabled={encouragementSent}
                            className={`w-full py-4 rounded-2xl font-bold text-lg ${encouragementSent ? 'bg-green-100 text-green-600' : 'bg-gradient-to-r from-violet-500 to-purple-600 text-white'}`}
                        >
                            {encouragementSent ? t.encouragementSent : `ğŸ‰ ${t.sendEncouragement}`}
                        </button>
                    </div>
                </div>
            );
        };

        function MomentumApp() {
            // Language state
            const [lang, setLang] = useState(() => storage.get('momentum_lang', 'en'));
            const t = translations[lang];
            const isRTL = lang === 'ar';

            useEffect(() => { storage.set('momentum_lang', lang); }, [lang]);

            const [showNameInput, setShowNameInput] = useState(() => !storage.get('momentum_user_name', null));
            const [showWelcome, setShowWelcome] = useState(() => !storage.get('momentum_welcomed', false));
            const [isPro, setIsPro] = useState(() => storage.get('momentum_pro', false));
            const [isMax, setIsMax] = useState(() => storage.get('momentum_max', false));
            const [trialStart, setTrialStart] = useState(() => storage.get('momentum_trial_start', null));
            const [showPaywall, setShowPaywall] = useState(false);
            const [showMaxPaywall, setShowMaxPaywall] = useState(false);
            const [proSince, setProSince] = useState(() => storage.get('momentum_pro_since', null));
            const [notificationsEnabled, setNotificationsEnabled] = useState(() => typeof Notification !== 'undefined' && Notification.permission === 'granted');

            const trialDaysLeft = useMemo(() => { if (isPro || isMax) return 0; if (!trialStart) return 0; const daysPassed = Math.floor((new Date() - new Date(trialStart)) / (1000 * 60 * 60 * 24)); return Math.max(0, 7 - daysPassed); }, [trialStart, isPro, isMax]);
            const isTrialActive = trialDaysLeft > 0;
            const canStartTrial = !trialStart && !isPro && !isMax;
            const hasProAccess = isPro || isMax || isTrialActive;
            const hasMaxAccess = isMax;
            
            const handleNameSubmit = useCallback((name, gender) => {
                storage.set('momentum_user_name', name);
                storage.set('momentum_user_gender', gender);
                setUser(u => ({ ...u, name, gender }));
                setShowNameInput(false);
            }, []);
            
            const handleStartTrial = useCallback(() => { const now = new Date().toISOString(); setTrialStart(now); storage.set('momentum_trial_start', now); storage.set('momentum_welcomed', true); setShowWelcome(false); }, []);
            const handleSkipTrial = useCallback(() => { storage.set('momentum_welcomed', true); setShowWelcome(false); }, []);
            const handleUpgrade = useCallback(() => setShowPaywall(true), []);
            const handleUpgradeMax = useCallback(() => setShowMaxPaywall(true), []);
            const handlePurchase = useCallback((plan) => {
                if (plan === 'trial') { const now = new Date().toISOString(); setTrialStart(now); storage.set('momentum_trial_start', now); }
                else { setIsPro(true); setProSince(new Date().toISOString()); storage.set('momentum_pro', true); storage.set('momentum_pro_since', new Date().toISOString()); }
                setShowPaywall(false);
            }, []);
            const handlePurchaseMax = useCallback((plan) => {
                setIsMax(true); 
                setIsPro(true);
                setProSince(new Date().toISOString()); 
                storage.set('momentum_max', true);
                storage.set('momentum_pro', true); 
                storage.set('momentum_pro_since', new Date().toISOString());
                setShowMaxPaywall(false);
            }, []);
            
            const enableNotifications = useCallback(async () => {
                const granted = await NotificationHelper.requestPermission();
                setNotificationsEnabled(granted);
                return granted;
            }, []);
            
            const addFriend = useCallback((friend) => {
                setFriends(prev => {
                    if (prev.find(f => f.id === friend.id)) return prev;
                    return [...prev, friend];
                });
            }, []);
            
            const removeFriend = useCallback((friendId) => {
                setFriends(prev => prev.filter(f => f.id !== friendId));
            }, []);

            const getLocalizedTemplates = useCallback((categoryFilter = 'all') => {
                const allTemplates = {
                    health: [
                        { name: t.drinkWater, emoji: 'ğŸ’§', color: 'from-cyan-400 to-blue-500', category: t.health, goal: 8, unit: t.glasses },
                        { name: t.takeVitamins, emoji: 'ğŸ’Š', color: 'from-green-400 to-teal-500', category: t.health, goal: 1, unit: '' },
                        { name: t.sleepEarly, emoji: 'ğŸ˜´', color: 'from-indigo-400 to-purple-500', category: t.health, goal: 1, unit: '' },
                        { name: t.noSugar, emoji: 'ğŸ¬', color: 'from-pink-400 to-rose-500', category: t.health, goal: 1, unit: '' },
                        { name: t.skincare, emoji: 'âœ¨', color: 'from-amber-300 to-orange-400', category: t.health, goal: 1, unit: '' },
                        { name: t.coldShower, emoji: 'ğŸš¿', color: 'from-cyan-500 to-blue-600', category: t.health, goal: 1, unit: '' },
                    ],
                    fitness: [
                        { name: t.exercise, emoji: 'ğŸ’ª', color: 'from-orange-500 to-red-500', category: t.fitness, goal: 30, unit: t.min },
                        { name: t.walk, emoji: 'ğŸš¶', color: 'from-green-500 to-emerald-500', category: t.fitness, goal: 10000, unit: t.steps },
                        { name: t.runMorning, emoji: 'ğŸƒ', color: 'from-red-400 to-orange-500', category: t.fitness, goal: 30, unit: t.min },
                        { name: t.gym, emoji: 'ğŸ‹ï¸', color: 'from-slate-500 to-gray-600', category: t.fitness, goal: 1, unit: t.hours },
                        { name: t.yoga, emoji: 'ğŸ§˜', color: 'from-purple-400 to-pink-500', category: t.fitness, goal: 20, unit: t.min },
                        { name: t.cycling, emoji: 'ğŸš´', color: 'from-lime-400 to-green-500', category: t.fitness, goal: 30, unit: t.min },
                        { name: t.swimming, emoji: 'ğŸŠ', color: 'from-blue-400 to-cyan-500', category: t.fitness, goal: 30, unit: t.min },
                        { name: t.plank, emoji: 'ğŸ‹ï¸', color: 'from-amber-500 to-orange-600', category: t.fitness, goal: 60, unit: 'sec' },
                        { name: t.stretching, emoji: 'ğŸ¤¸', color: 'from-teal-400 to-cyan-500', category: t.fitness, goal: 10, unit: t.min },
                    ],
                    wellness: [
                        { name: t.meditate, emoji: 'ğŸ§˜', color: 'from-violet-500 to-purple-600', category: t.wellness, goal: 10, unit: t.min },
                        { name: t.journal, emoji: 'ğŸ“', color: 'from-amber-400 to-orange-500', category: t.wellness, goal: 1, unit: '' },
                        { name: t.breathingExercise, emoji: 'ğŸŒ¬ï¸', color: 'from-sky-400 to-blue-500', category: t.wellness, goal: 5, unit: t.min },
                        { name: t.gratitude, emoji: 'ğŸ™', color: 'from-yellow-400 to-amber-500', category: t.wellness, goal: 3, unit: t.times },
                        { name: t.noPhone, emoji: 'ğŸ“µ', color: 'from-gray-500 to-slate-600', category: t.wellness, goal: 1, unit: '' },
                    ],
                    learning: [
                        { name: t.read, emoji: 'ğŸ“š', color: 'from-blue-500 to-indigo-500', category: t.learning, goal: 20, unit: t.pages },
                        { name: t.learnLanguage, emoji: 'ğŸŒ', color: 'from-green-400 to-teal-500', category: t.learning, goal: 15, unit: t.min },
                        { name: t.podcast, emoji: 'ğŸ§', color: 'from-purple-500 to-pink-500', category: t.learning, goal: 1, unit: t.sessions },
                        { name: t.onlineCourse, emoji: 'ğŸ’»', color: 'from-blue-400 to-indigo-500', category: t.learning, goal: 1, unit: t.lessons },
                        { name: t.practiceSkill, emoji: 'ğŸ¯', color: 'from-orange-400 to-red-500', category: t.learning, goal: 30, unit: t.min },
                        { name: t.writingPractice, emoji: 'âœï¸', color: 'from-emerald-400 to-green-500', category: t.learning, goal: 500, unit: 'words' },
                    ],
                    productivity: [
                        { name: t.deepWork, emoji: 'ğŸ¯', color: 'from-indigo-500 to-purple-600', category: t.productivity, goal: 2, unit: t.hours },
                        { name: t.planDay, emoji: 'ğŸ“‹', color: 'from-blue-400 to-cyan-500', category: t.productivity, goal: 1, unit: '' },
                        { name: t.inbox0, emoji: 'ğŸ“§', color: 'from-red-400 to-pink-500', category: t.productivity, goal: 1, unit: '' },
                        { name: t.reviewGoals, emoji: 'ğŸ¯', color: 'from-amber-400 to-orange-500', category: t.productivity, goal: 1, unit: '' },
                        { name: t.networking, emoji: 'ğŸ¤', color: 'from-teal-400 to-cyan-500', category: t.productivity, goal: 1, unit: '' },
                    ],
                };
                
                if (categoryFilter === 'all') {
                    // Return a mix of all categories
                    return [
                        allTemplates.health[0],
                        allTemplates.fitness[0],
                        allTemplates.wellness[0],
                        allTemplates.learning[0],
                        allTemplates.productivity[0],
                        allTemplates.fitness[1],
                    ];
                }
                
                return allTemplates[categoryFilter] || [];
            }, [t]);

            const [habits, setHabits] = useState(() => storage.get('momentum_habits', []));
            
            // Initialize default habits based on current language - only runs once after onboarding
            useEffect(() => {
                if (habits.length === 0 && !showNameInput && !showWelcome) {
                    const defaultHabits = [
                        { id: 1, name: t.meditate, emoji: 'ğŸ§˜', color: 'from-violet-500 to-purple-600', streak: 0, completedDates: [], category: t.wellness, goal: 10, progress: {}, unit: t.min },
                        { id: 2, name: t.read, emoji: 'ğŸ“š', color: 'from-blue-500 to-cyan-500', streak: 0, completedDates: [], category: t.learning, goal: 20, progress: {}, unit: t.pages },
                        { id: 3, name: t.exercise, emoji: 'ğŸ’ª', color: 'from-green-500 to-emerald-500', streak: 0, completedDates: [], category: t.fitness, goal: 30, progress: {}, unit: t.min },
                    ];
                    setHabits(defaultHabits);
                    storage.set('momentum_habits', defaultHabits);
                }
            }, [showNameInput, showWelcome, t]);
            
            const [user, setUser] = useState(() => {
                const defaultUser = { 
                    name: 'Champion', 
                    avatar: 'ğŸ¦¸', 
                    level: 1, 
                    xp: 0, 
                    totalCompletions: 0, 
                    perfectDays: 0, 
                    perfectDaysToday: false,
                    longestStreak: 0, 
                    theme: 'purple', 
                    achievements: [], 
                    gender: null,
                    lastActiveDate: null
                };
                
                // Get saved user data
                const savedUser = storage.get('momentum_user', null);
                
                // If no saved user, return defaults
                if (!savedUser || typeof savedUser !== 'object') {
                    console.log('No saved user, using defaults');
                    return defaultUser;
                }
                
                // Merge saved with defaults, ensuring saved values take priority
                const mergedUser = {
                    ...defaultUser,
                    ...savedUser,
                    // Explicitly preserve these critical values from saved
                    level: savedUser.level || defaultUser.level,
                    xp: savedUser.xp !== undefined ? savedUser.xp : defaultUser.xp,
                    totalCompletions: savedUser.totalCompletions || defaultUser.totalCompletions,
                    perfectDays: savedUser.perfectDays || defaultUser.perfectDays,
                    longestStreak: savedUser.longestStreak || defaultUser.longestStreak,
                    achievements: savedUser.achievements || defaultUser.achievements,
                };
                
                // Override with separately saved name/gender if they exist
                const savedName = storage.get('momentum_user_name', null);
                const savedGender = storage.get('momentum_user_gender', null);
                if (savedName) mergedUser.name = savedName;
                if (savedGender) mergedUser.gender = savedGender;
                
                // Reset perfectDaysToday if it's a new day
                const today = new Date().toISOString().split('T')[0];
                if (mergedUser.lastActiveDate !== today) {
                    mergedUser.perfectDaysToday = false;
                    mergedUser.lastActiveDate = today;
                }
                
                console.log('Loaded user:', mergedUser.level, mergedUser.xp);
                return mergedUser;
            });
            const [activeTab, setActiveTab] = useState('habits');
            const [showConfetti, setShowConfetti] = useState(false);
            const [showLevelUp, setShowLevelUp] = useState(false);
            const [newLevel, setNewLevel] = useState(1);
            const [showAddHabit, setShowAddHabit] = useState(false);
            const [showTemplates, setShowTemplates] = useState(false);
            const [templateCategory, setTemplateCategory] = useState('all');
            const [darkMode, setDarkMode] = useState(() => storage.get('momentum_dark', false));
            const [showHabitDetail, setShowHabitDetail] = useState(null);
            const [showReminderModal, setShowReminderModal] = useState(null);
            const [selectedCategory, setSelectedCategory] = useState('all');
            const [showFriendsModal, setShowFriendsModal] = useState(false);
            const [showAddFriendModal, setShowAddFriendModal] = useState(false);
            const [showFriendProfile, setShowFriendProfile] = useState(null);
            const [friends, setFriends] = useState(() => storage.get('momentum_friends', []));
            const [showQuickAdd, setShowQuickAdd] = useState(null); // For quick increment modal
            const [showAICoach, setShowAICoach] = useState(false); // For AI Coach modal
            const [aiAdvice, setAiAdvice] = useState(null); // Store AI advice
            const [showReviewPopup, setShowReviewPopup] = useState(false); // Review popup
            const [showInviteModal, setShowInviteModal] = useState(false); // Invite friend modal
            const [inviteCodeInput, setInviteCodeInput] = useState(''); // Input for friend's code
            const [inviteMessage, setInviteMessage] = useState(null); // Success/error message
            const [usedInviteCodes, setUsedInviteCodes] = useState(() => storage.get('momentum_used_codes', []));
            const [userId] = useState(() => {
                let id = storage.get('momentum_user_id', null);
                if (!id) {
                    id = 'MOM' + Math.random().toString(36).substr(2, 8).toUpperCase();
                    storage.set('momentum_user_id', id);
                }
                return id;
            });

            useEffect(() => { storage.set('momentum_friends', friends); }, [friends]);
            useEffect(() => { storage.set('momentum_habits', habits); }, [habits]);
            useEffect(() => { 
                // Only save if user has meaningful data
                if (user && user.level >= 1) {
                    console.log('Saving user:', user.level, user.xp);
                    storage.set('momentum_user', user); 
                }
            }, [user]);
            useEffect(() => { storage.set('momentum_dark', darkMode); }, [darkMode]);
            
            // Check if should show review popup
            useEffect(() => {
                const hasReviewed = storage.get('momentum_reviewed', false);
                const dismissedReview = storage.get('momentum_review_dismissed', false);
                const totalCompletions = user.totalCompletions || 0;
                
                // Show review popup after 10 completions if not reviewed or dismissed
                if (!hasReviewed && !dismissedReview && totalCompletions >= 10 && totalCompletions % 20 === 10) {
                    setTimeout(() => setShowReviewPopup(true), 2000);
                }
            }, [user.totalCompletions]);

            const today = new Date().toISOString().split('T')[0];
            const todayCompletions = useMemo(() => habits.filter(h => (h.progress?.[today] || 0) >= (h.goal || 1)).length, [habits, today]);
            const completionRate = useMemo(() => habits.length > 0 ? Math.round((todayCompletions / habits.length) * 100) : 0, [todayCompletions, habits.length]);
            const canAddHabit = useMemo(() => hasProAccess || habits.length < FREE_LIMITS.maxHabits, [habits.length, hasProAccess]);

            // Invite friend functions
            const generateInviteLink = useCallback(() => {
                return `https://momentum.app/invite/${userId}`;
            }, [userId]);
            
            const copyInviteLink = useCallback(async () => {
                const link = generateInviteLink();
                try {
                    await navigator.clipboard.writeText(link);
                    SoundHelper.playSuccess();
                    setInviteMessage({ type: 'success', text: t.linkCopied });
                    setTimeout(() => setInviteMessage(null), 3000);
                } catch {
                    // Fallback for older browsers
                    const textarea = document.createElement('textarea');
                    textarea.value = link;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    SoundHelper.playSuccess();
                    setInviteMessage({ type: 'success', text: t.linkCopied });
                    setTimeout(() => setInviteMessage(null), 3000);
                }
            }, [generateInviteLink, t]);
            
            const shareInviteLink = useCallback(async () => {
                const link = generateInviteLink();
                const shareText = lang === 'ar' 
                    ? `Ø¬Ø±Ø¨ ØªØ·Ø¨ÙŠÙ‚ Momentum Ù„Ø¨Ù†Ø§Ø¡ Ø¹Ø§Ø¯Ø§Øª Ø±Ø§Ø¦Ø¹Ø©! Ø§Ø³ØªØ®Ø¯Ù… Ø±Ù…Ø² Ø§Ù„Ø¯Ø¹ÙˆØ©: ${userId}`
                    : `Try Momentum app to build amazing habits! Use my invite code: ${userId}`;
                
                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: 'Momentum - Habit Tracker',
                            text: shareText,
                            url: link
                        });
                        SoundHelper.playSuccess();
                    } catch (e) {
                        // User cancelled or error
                        copyInviteLink();
                    }
                } else {
                    copyInviteLink();
                }
            }, [generateInviteLink, userId, lang, copyInviteLink]);
            
            const applyInviteCode = useCallback((code) => {
                const trimmedCode = code.trim().toUpperCase();
                
                // Validate code format
                if (!trimmedCode || trimmedCode.length < 5) {
                    SoundHelper.playClick();
                    setInviteMessage({ type: 'error', text: t.invalidCode });
                    setTimeout(() => setInviteMessage(null), 3000);
                    return;
                }
                
                // Can't use own code
                if (trimmedCode === userId) {
                    SoundHelper.playClick();
                    setInviteMessage({ type: 'error', text: t.invalidCode });
                    setTimeout(() => setInviteMessage(null), 3000);
                    return;
                }
                
                // Check if already used
                if (usedInviteCodes.includes(trimmedCode)) {
                    SoundHelper.playClick();
                    setInviteMessage({ type: 'error', text: t.alreadyUsed });
                    setTimeout(() => setInviteMessage(null), 3000);
                    return;
                }
                
                // Apply the code - grant 7 days MAX
                SoundHelper.playLevelUp();
                const newUsedCodes = [...usedInviteCodes, trimmedCode];
                setUsedInviteCodes(newUsedCodes);
                storage.set('momentum_used_codes', newUsedCodes);
                
                // Grant MAX access for 7 days
                const currentMaxExpiry = storage.get('momentum_max_expiry', null);
                const now = new Date();
                const newExpiry = currentMaxExpiry 
                    ? new Date(Math.max(new Date(currentMaxExpiry).getTime(), now.getTime()) + 7 * 24 * 60 * 60 * 1000)
                    : new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
                
                storage.set('momentum_max', true);
                storage.set('momentum_pro', true);
                storage.set('momentum_max_expiry', newExpiry.toISOString());
                setIsMax(true);
                setIsPro(true);
                
                setInviteMessage({ type: 'success', text: t.codeApplied });
                setInviteCodeInput('');
                setTimeout(() => setInviteMessage(null), 5000);
            }, [userId, usedInviteCodes, t]);

            const categories = useMemo(() => [
                { key: 'all', label: t.all },
                { key: 'health', label: t.health },
                { key: 'fitness', label: t.fitness },
                { key: 'wellness', label: t.wellness },
                { key: 'learning', label: t.learning },
                { key: 'productivity', label: t.productivity },
            ], [t]);
            
            const filteredHabits = useMemo(() => {
                if (selectedCategory === 'all') return habits;
                const catLabel = categories.find(c => c.key === selectedCategory)?.label;
                return habits.filter(h => h.category === catLabel);
            }, [habits, selectedCategory, categories]);

            const allThemes = { purple: 'from-violet-600 via-purple-600 to-fuchsia-600', ocean: 'from-cyan-500 via-blue-600 to-indigo-600', sunset: 'from-orange-500 via-rose-500 to-pink-600', forest: 'from-emerald-500 via-green-600 to-teal-600', midnight: 'from-slate-900 via-purple-900 to-slate-800', rose: 'from-rose-400 via-pink-500 to-red-500', aurora: 'from-green-400 via-cyan-500 to-blue-500', lavender: 'from-purple-400 via-violet-500 to-indigo-500', golden: 'from-amber-400 via-orange-500 to-red-500', cosmic: 'from-indigo-900 via-purple-800 to-pink-700' };

            const incrementHabit = useCallback((habitId, amount = 1) => {
                const habit = habits.find(h => h.id === habitId);
                if (!habit) return;
                const currentProgress = habit.progress?.[today] || 0;
                const goal = habit.goal || 1;
                if (currentProgress >= goal) return;
                const newProgress = Math.min(currentProgress + amount, goal);
                const justCompleted = currentProgress < goal && newProgress >= goal;

                const updatedHabits = habits.map(h => {
                    if (h.id === habitId) {
                        let newStreak = h.streak, newCompletedDates = [...(h.completedDates || [])];
                        if (justCompleted && !h.completedDates?.includes(today)) {
                            newCompletedDates.push(today);
                            const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                            newStreak = h.completedDates?.includes(yesterday.toISOString().split('T')[0]) ? h.streak + 1 : 1;
                        }
                        return { ...h, progress: { ...h.progress, [today]: newProgress }, completedDates: newCompletedDates, streak: newStreak };
                    }
                    return h;
                });
                setHabits(updatedHabits);

                if (justCompleted) {
                    const xpGain = 25;
                    let newXP = user.xp + xpGain, newLvl = user.level;
                    while (newXP >= newLvl * 100) { newXP -= newLvl * 100; newLvl++; }
                    const completedCount = updatedHabits.filter(h => (h.progress?.[today] || 0) >= (h.goal || 1)).length;
                    const willBePerfect = completedCount === updatedHabits.length;
                    const maxStreak = Math.max(...updatedHabits.map(h => h.streak));

                    setUser(u => ({ ...u, xp: newXP, level: newLvl, totalCompletions: u.totalCompletions + 1, perfectDays: willBePerfect && !u.perfectDaysToday ? u.perfectDays + 1 : u.perfectDays, perfectDaysToday: willBePerfect, longestStreak: Math.max(u.longestStreak, maxStreak) }));

                    // Play sounds
                    SoundHelper.playSuccess();
                    
                    if (newLvl > user.level) { 
                        setNewLevel(newLvl); 
                        setShowLevelUp(true); 
                        setShowConfetti(true); 
                        SoundHelper.playLevelUp();
                        setTimeout(() => { setShowLevelUp(false); setShowConfetti(false); }, 3000); 
                    }
                    if (willBePerfect) { setShowConfetti(true); setTimeout(() => setShowConfetti(false), 3000); }
                }
            }, [habits, today, user]);

            const addHabit = useCallback((data) => {
                if (!canAddHabit) { setShowPaywall(true); return; }
                setHabits(prev => [...prev, { id: Date.now(), name: data.name, emoji: data.emoji || 'â­', color: data.color || 'from-violet-500 to-purple-600', streak: 0, completedDates: [], category: data.category || t.health, goal: data.goal || 1, unit: data.unit || '', progress: {} }]);
                setShowAddHabit(false); setShowTemplates(false);
            }, [canAddHabit, t]);

            const deleteHabit = useCallback((id) => { setHabits(prev => prev.filter(h => h.id !== id)); setShowHabitDetail(null); }, []);

            const quotes = useMemo(() => [{ text: t.quote1, author: t.quote1Author }, { text: t.quote2, author: t.quote2Author }], [t]);
            const todayQuote = quotes[new Date().getDay() % quotes.length];

            // Show onboarding screen first (includes language selection)
            if (showNameInput) {
                return (
                    <OnboardingScreen 
                        onComplete={handleNameSubmit} 
                        lang={lang} 
                        setLang={setLang} 
                    />
                );
            }

            if (showWelcome) {
                return (
                    <LanguageContext.Provider value={{ t, lang, setLang, isRTL }}>
                        <WelcomeScreen onStartTrial={handleStartTrial} onSkip={handleSkipTrial} />
                    </LanguageContext.Provider>
                );
            }

            return (
                <LanguageContext.Provider value={{ t, lang, setLang, isRTL }}>
                    <div dir={isRTL ? 'rtl' : 'ltr'} className={`min-h-screen bg-gradient-to-br ${allThemes[user.theme] || allThemes.purple} ${darkMode ? 'dark' : ''}`}>
                        <Confetti active={showConfetti} />
                        {showPaywall && <Paywall onClose={() => setShowPaywall(false)} onPurchase={handlePurchase} trialDaysLeft={trialDaysLeft} canStartTrial={canStartTrial} />}
                        {showMaxPaywall && <MaxPaywall onClose={() => setShowMaxPaywall(false)} onPurchase={handlePurchaseMax} isPro={isPro} />}
                        {showReminderModal && <ReminderModal habit={showReminderModal} onClose={() => setShowReminderModal(null)} onSave={() => {}} hasMaxAccess={hasMaxAccess} />}
                        {showFriendsModal && <FriendsModal onClose={() => setShowFriendsModal(false)} friends={friends} userId={userId} onAddFriend={() => { setShowFriendsModal(false); setShowAddFriendModal(true); }} onViewProfile={(f) => { setShowFriendsModal(false); setShowFriendProfile(f); }} onRemoveFriend={removeFriend} hasProAccess={hasProAccess} onUpgrade={handleUpgrade} />}
                        {showAddFriendModal && <AddFriendModal onClose={() => setShowAddFriendModal(false)} onAdd={addFriend} />}
                        {showFriendProfile && <FriendProfileModal friend={showFriendProfile} onClose={() => setShowFriendProfile(null)} user={user} />}

                        {showLevelUp && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm">
                                <div className="bg-white dark:bg-gray-900 rounded-3xl p-8 m-4 text-center animate-bounce-in max-w-sm">
                                    <div className="text-7xl mb-4 animate-celebrate">ğŸ‰</div>
                                    <h2 className="text-3xl font-black text-gray-800 dark:text-white mb-2">{t.levelUp}</h2>
                                    <div className="text-6xl font-black text-gradient mb-4">{newLevel}</div>
                                </div>
                            </div>
                        )}

                        <header className="glass sticky top-0 z-30 px-3 sm:px-5 py-3 sm:py-4 header-compact">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-2 sm:gap-3 flex-1 min-w-0">
                                    <div className="w-10 h-10 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl bg-white/20 flex items-center justify-center text-xl sm:text-2xl flex-shrink-0">{user.avatar}</div>
                                    <div className="text-white min-w-0">
                                        <div className="flex items-center gap-1 sm:gap-2 flex-wrap">
                                            <h1 className="font-bold text-sm sm:text-lg truncate">{user.name}</h1>
                                            {hasMaxAccess ? (
                                                <span className="badge-small inline-flex items-center bg-gradient-to-r from-amber-400 via-yellow-500 to-orange-500 text-white font-bold rounded-full text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 shadow-lg whitespace-nowrap">
                                                    {user.gender === 'female' ? 'ğŸ‘‘' : 'ğŸ‘‘'}
                                                </span>
                                            ) : hasProAccess ? (
                                                <span className="badge-small inline-flex items-center bg-gradient-to-r from-amber-400 to-orange-500 text-white font-bold rounded-full text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5">PRO</span>
                                            ) : null}
                                        </div>
                                        <div className="flex items-center gap-1 sm:gap-2 text-xs sm:text-sm opacity-80">
                                            <span className="level-badge px-1.5 sm:px-2 py-0.5 rounded-full text-[10px] sm:text-xs font-bold">Lv.{user.level}</span>
                                            <span className="text-xs">{user.xp}/{user.level * 100}</span>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex items-center gap-1 sm:gap-2 flex-shrink-0">
                                    {!hasProAccess && (
                                        <button onClick={() => { SoundHelper.playClick(); handleUpgrade(); }} className="btn-3d ripple px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg sm:rounded-xl bg-gradient-to-r from-amber-400 to-orange-500 text-white font-bold text-xs sm:text-sm shadow-lg">
                                            <span className="hidden sm:inline">ğŸ‘‘ {t.pro}</span>
                                            <span className="sm:hidden">ğŸ‘‘</span>
                                        </button>
                                    )}
                                    {hasProAccess && !hasMaxAccess && (
                                        <button onClick={() => { SoundHelper.playClick(); handleUpgradeMax(); }} className="btn-3d ripple px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg sm:rounded-xl bg-gradient-to-r from-cyan-400 to-blue-500 text-white font-bold text-xs sm:text-sm shadow-lg">
                                            <span className="hidden sm:inline">ğŸ’ MAX</span>
                                            <span className="sm:hidden">ğŸ’</span>
                                        </button>
                                    )}
                                    <button onClick={() => { SoundHelper.playTap(); setShowFriendsModal(true); }} className="icon-btn btn-3d ripple w-8 h-8 sm:w-10 sm:h-10 rounded-lg sm:rounded-xl bg-white/20 flex items-center justify-center text-white relative text-sm sm:text-base">
                                        ğŸ‘¥
                                        {friends.length > 0 && <span className="absolute -top-1 -right-1 w-4 h-4 sm:w-5 sm:h-5 bg-red-500 text-white text-[10px] sm:text-xs rounded-full flex items-center justify-center font-bold">{friends.length}</span>}
                                    </button>
                                    <button onClick={() => { SoundHelper.playTap(); setShowInviteModal(true); }} className="icon-btn btn-3d ripple w-8 h-8 sm:w-10 sm:h-10 rounded-lg sm:rounded-xl bg-gradient-to-r from-green-400 to-emerald-500 flex items-center justify-center text-white text-sm sm:text-base" title={t.inviteFriend}>
                                        ğŸ
                                    </button>
                                    {hasMaxAccess && (
                                        <button onClick={() => { SoundHelper.playTap(); setShowAICoach(true); }} className="icon-btn btn-3d ripple w-8 h-8 sm:w-10 sm:h-10 rounded-lg sm:rounded-xl bg-gradient-to-r from-cyan-400 to-blue-500 flex items-center justify-center text-white text-sm sm:text-base">
                                            ğŸ¤–
                                        </button>
                                    )}
                                    <button onClick={() => { SoundHelper.playLanguageChange(); setLang(lang === 'en' ? 'ar' : 'en'); }} className="icon-btn btn-3d ripple w-8 h-8 sm:w-10 sm:h-10 rounded-lg sm:rounded-xl bg-white/20 flex items-center justify-center text-white text-sm sm:text-lg">{lang === 'en' ? 'ğŸ‡¸ğŸ‡¦' : 'ğŸ‡ºğŸ‡¸'}</button>
                                    <button onClick={() => { SoundHelper.playThemeChange(); setDarkMode(!darkMode); }} className="icon-btn btn-3d ripple w-8 h-8 sm:w-10 sm:h-10 rounded-lg sm:rounded-xl bg-white/20 flex items-center justify-center text-white text-sm sm:text-base">{darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}</button>
                                </div>
                            </div>
                            
                            {isTrialActive && (
                                <div className="mt-2 sm:mt-3 trial-banner rounded-lg sm:rounded-xl p-2 sm:p-3 flex items-center justify-between">
                                    <div className="flex items-center gap-2"><span className="text-lg sm:text-xl">âœ¨</span><span className="text-white font-semibold text-xs sm:text-sm">{t.proTrial}: {trialDaysLeft} {t.daysLeft}</span></div>
                                    <button onClick={() => { SoundHelper.playClick(); handleUpgrade(); }} className="btn-3d bg-white/20 text-white text-xs sm:text-sm font-bold px-2 sm:px-3 py-1 rounded-lg">{t.keepPro}</button>
                                </div>
                            )}
                            
                            {!hasProAccess && canStartTrial && (
                                <div className="mt-2 sm:mt-3 bg-gradient-to-r from-green-500/20 to-emerald-500/20 border border-green-400/30 rounded-lg sm:rounded-xl p-2 sm:p-3 flex items-center justify-between">
                                    <div className="flex items-center gap-2"><span className="text-lg sm:text-xl">ğŸ</span><span className="text-white font-semibold text-xs sm:text-sm">{t.tryProFree7Days}</span></div>
                                    <button onClick={() => { SoundHelper.playClick(); handleUpgrade(); }} className="btn-3d bg-green-500 text-white text-xs sm:text-sm font-bold px-2 sm:px-3 py-1 rounded-lg">{t.startTrial}</button>
                                </div>
                            )}
                            
                            <div className="mt-2 sm:mt-3 h-1.5 sm:h-2 bg-white/20 rounded-full overflow-hidden"><div className="h-full bg-gradient-to-r from-yellow-400 to-orange-500 transition-all duration-500" style={{ width: `${(user.xp / (user.level * 100)) * 100}%` }} /></div>
                        </header>

                        <main className="pb-24">
                            {activeTab === 'habits' && (
                                <div className="px-5 py-6 space-y-6 animate-slide-down">
                                    <div className="premium-card rounded-3xl p-6">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <h2 className="text-sm font-medium text-gray-500 mb-1">{t.todaysProgress}</h2>
                                                <p className="text-4xl font-black text-gray-800 dark:text-white">{todayCompletions}/{habits.length}</p>
                                                <p className="text-sm text-gray-500">{t.habitsCompleted}</p>
                                            </div>
                                            <CircularProgress progress={completionRate}><p className="text-2xl font-black text-gray-800 dark:text-white">{completionRate}%</p></CircularProgress>
                                        </div>
                                        <div className="mt-4 pt-4 border-t border-gray-100">
                                            <p className="text-sm text-gray-600 italic">"{todayQuote.text}"</p>
                                            <p className="text-xs text-gray-400 mt-1">â€” {todayQuote.author}</p>
                                        </div>
                                    </div>

                                    <div className="flex gap-2 overflow-x-auto pb-2 -mx-5 px-5">
                                        {categories.map(cat => (<button key={cat.key} onClick={() => setSelectedCategory(cat.key)} className={`px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap transition-all ${selectedCategory === cat.key ? 'bg-white text-purple-600 shadow-lg' : 'bg-white/20 text-white'}`}>{cat.label}</button>))}
                                    </div>

                                    <div className="space-y-3">
                                        {filteredHabits.map(habit => {
                                            const todayProgress = habit.progress?.[today] || 0;
                                            const goal = habit.goal || 1;
                                            const isCompleted = todayProgress >= goal;
                                            const progressPercent = Math.min((todayProgress / goal) * 100, 100);
                                            const hasMultipleSteps = goal > 1;
                                            const isLargeGoal = goal > 5; // Show quick add for goals > 5

                                            return (
                                                <div key={habit.id} className={`habit-card premium-card rounded-2xl p-4 ${isCompleted ? 'opacity-75' : ''}`}>
                                                    <div className="flex items-center gap-4">
                                                        <button onClick={() => !hasMultipleSteps && incrementHabit(habit.id)} className={`btn-3d w-14 h-14 rounded-2xl flex items-center justify-center text-2xl transition-all ${isCompleted ? 'bg-gradient-to-br from-green-400 to-emerald-500 shadow-lg' : `bg-gradient-to-br ${habit.color} shadow-md`}`}>{isCompleted ? 'âœ“' : habit.emoji}</button>
                                                        <div className="flex-1 min-w-0" onClick={() => setShowHabitDetail(habit)}>
                                                            <p className={`font-semibold text-gray-800 dark:text-white ${isCompleted ? 'line-through opacity-50' : ''}`}>{habit.name}</p>
                                                            {hasMultipleSteps && (
                                                                <div className="mt-2">
                                                                    <div className="flex items-center justify-between text-xs mb-1">
                                                                        <span className="font-bold text-gray-600">{todayProgress} / {goal} {habit.unit}</span>
                                                                        <span className="font-semibold text-purple-600">{Math.round(progressPercent)}%</span>
                                                                    </div>
                                                                    <div className="h-2 bg-gray-100 rounded-full overflow-hidden"><div className={`h-full transition-all duration-500 rounded-full ${isCompleted ? 'bg-gradient-to-r from-green-400 to-emerald-500' : `bg-gradient-to-r ${habit.color}`}`} style={{ width: `${progressPercent}%` }} /></div>
                                                                </div>
                                                            )}
                                                            <div className="flex items-center gap-3 mt-1">
                                                                <span className="streak-badge text-white text-xs font-bold px-2 py-0.5 rounded-full">ğŸ”¥ {habit.streak}</span>
                                                                <span className="text-xs text-gray-400">{habit.category}</span>
                                                            </div>
                                                        </div>
                                                        {!isCompleted && (
                                                            <div className="flex gap-1 flex-shrink-0">
                                                                {isLargeGoal && (
                                                                    <button 
                                                                        onClick={(e) => { e.stopPropagation(); SoundHelper.playTap(); setShowQuickAdd({...habit, progress: habit.progress}); }}
                                                                        className={`btn-3d px-3 py-2 rounded-xl text-sm font-bold text-white bg-gradient-to-r ${habit.color} shadow-md`}
                                                                        title="Quick Add"
                                                                    >
                                                                        âš¡+
                                                                    </button>
                                                                )}
                                                                <button 
                                                                    onClick={(e) => { e.stopPropagation(); SoundHelper.playTap(); incrementHabit(habit.id, 1); }} 
                                                                    className={`btn-3d px-4 py-2 rounded-xl text-sm font-bold text-white bg-gradient-to-r ${habit.color} shadow-md`}
                                                                >
                                                                    {hasMultipleSteps ? '+1' : t.done}
                                                                </button>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>

                                    <div className="flex gap-3">
                                        <button onClick={() => setShowTemplates(true)} className="flex-1 premium-card rounded-2xl p-4 flex items-center justify-center gap-2 text-purple-600"><span className="text-2xl">ğŸ“‹</span><span className="font-semibold">{t.templates}</span></button>
                                        <button onClick={() => canAddHabit ? setShowAddHabit(true) : setShowPaywall(true)} className={`flex-1 premium-card rounded-2xl p-4 flex items-center justify-center gap-2 border-2 border-dashed ${canAddHabit ? 'text-gray-400 border-gray-200' : 'text-amber-500 border-amber-300'}`}><span className="text-2xl">{canAddHabit ? '+' : 'ğŸ”’'}</span><span className="font-semibold">{canAddHabit ? t.custom : t.pro}</span></button>
                                    </div>

                                    {!hasProAccess && (
                                        <div className="bg-gradient-to-r from-amber-500/10 to-orange-500/10 border border-amber-500/20 rounded-2xl p-4 flex items-center justify-between">
                                            <div><p className="text-amber-600 font-semibold text-sm">{habits.length}/{FREE_LIMITS.maxHabits} {t.freeHabits}</p><p className="text-gray-500 text-xs">{t.startTrialForUnlimited}</p></div>
                                            <button onClick={handleUpgrade} className="px-4 py-2 bg-gradient-to-r from-green-400 to-emerald-500 text-white font-bold text-sm rounded-xl shadow-lg">{t.freeTrial}</button>
                                        </div>
                                    )}
                                </div>
                            )}

                            {activeTab === 'analytics' && (
                                <div className="px-5 py-6 space-y-6 animate-slide-down">
                                    <div className="premium-card rounded-3xl p-6">
                                        <div className="flex items-center justify-between mb-4">
                                            <h2 className="font-bold text-gray-800">{hasProAccess ? '90' : '7'}{t.dayOverview}</h2>
                                            {hasProAccess && <ProBadge small />}
                                        </div>
                                        <div className="h-32 flex items-end gap-1">
                                            {Array.from({ length: hasProAccess ? 30 : 7 }).map((_, i) => (<div key={i} className="flex-1 bg-gradient-to-t from-violet-500 to-purple-400 rounded-t-sm" style={{ height: `${Math.random() * 80 + 20}%` }} />))}
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="premium-card rounded-2xl p-5 text-center"><p className="text-3xl font-black text-gray-800">{user.totalCompletions}</p><p className="text-sm text-gray-500">{t.totalCompletions}</p></div>
                                        <div className="premium-card rounded-2xl p-5 text-center"><p className="text-3xl font-black text-gray-800">{user.longestStreak}</p><p className="text-sm text-gray-500">{t.bestStreak}</p></div>
                                        <div className="premium-card rounded-2xl p-5 text-center"><p className="text-3xl font-black text-gray-800">{user.perfectDays}</p><p className="text-sm text-gray-500">{t.perfectDays}</p></div>
                                        <div className="premium-card rounded-2xl p-5 text-center"><p className="text-3xl font-black text-gray-800">{t.level}{user.level}</p><p className="text-sm text-gray-500">{t.currentLevel}</p></div>
                                    </div>
                                    
                                    <div className="space-y-3">
                                        <h3 className="font-bold text-white">{hasProAccess ? 'âœ¨' : 'ğŸ”’'} {t.proInsights}</h3>
                                        
                                        {/* Habit Heatmap - Clickable */}
                                        <button 
                                            onClick={() => {
                                                SoundHelper.playTap();
                                                if (hasProAccess) {
                                                    // Show heatmap modal
                                                    alert('ğŸ¯ Habit Heatmap\n\nYour activity patterns will be displayed here showing which days and times you\'re most active with your habits.');
                                                } else {
                                                    handleUpgrade();
                                                }
                                            }}
                                            className={`card-3d w-full insight-card rounded-2xl p-4 relative overflow-hidden text-left ${!hasProAccess ? 'opacity-50' : 'cursor-pointer'}`}
                                        >
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-3">
                                                    <span className="text-2xl">ğŸ¯</span>
                                                    <div>
                                                        <p className="font-semibold text-white">{t.habitHeatmap}</p>
                                                        <p className="text-sm text-white/70">{t.seePatterns}</p>
                                                    </div>
                                                </div>
                                                <span className="text-white/50">â†’</span>
                                            </div>
                                            {!hasProAccess && <LockedOverlay onUpgrade={handleUpgrade} />}
                                        </button>
                                        
                                        {/* Export Data - Clickable */}
                                        <button 
                                            onClick={() => {
                                                SoundHelper.playTap();
                                                if (hasProAccess) {
                                                    // Generate and download CSV
                                                    const csvContent = [
                                                        ['Habit', 'Category', 'Streak', 'Total Completions', 'Goal', 'Unit'],
                                                        ...habits.map(h => [
                                                            h.name,
                                                            h.category,
                                                            h.streak,
                                                            Object.keys(h.progress || {}).length,
                                                            h.goal,
                                                            h.unit
                                                        ])
                                                    ].map(row => row.join(',')).join('\n');
                                                    
                                                    const blob = new Blob([csvContent], { type: 'text/csv' });
                                                    const url = URL.createObjectURL(blob);
                                                    const a = document.createElement('a');
                                                    a.href = url;
                                                    a.download = `momentum_habits_${new Date().toISOString().split('T')[0]}.csv`;
                                                    a.click();
                                                    URL.revokeObjectURL(url);
                                                    SoundHelper.playSuccess();
                                                } else {
                                                    handleUpgrade();
                                                }
                                            }}
                                            className={`card-3d w-full insight-card rounded-2xl p-4 relative overflow-hidden text-left ${!hasProAccess ? 'opacity-50' : 'cursor-pointer'}`}
                                        >
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-3">
                                                    <span className="text-2xl">ğŸ“¤</span>
                                                    <div>
                                                        <p className="font-semibold text-white">{t.exportData}</p>
                                                        <p className="text-sm text-white/70">{t.downloadCsvPdf}</p>
                                                    </div>
                                                </div>
                                                <span className="text-white/50">â†“</span>
                                            </div>
                                            {!hasProAccess && <LockedOverlay onUpgrade={handleUpgrade} />}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'achievements' && (
                                <div className="px-5 py-6 space-y-6 animate-slide-down">
                                    {/* Level Progress Card */}
                                    <div className="premium-card rounded-3xl p-6">
                                        <div className="flex items-center justify-between mb-4">
                                            <div className="flex items-center gap-4">
                                                <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center text-3xl text-white font-black">{user.level}</div>
                                                <div>
                                                    <p className="text-sm text-gray-500">{t.currentLevel}</p>
                                                    <p className="text-2xl font-black text-gray-800">{t.level} {user.level}</p>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <p className="text-sm text-gray-500">{t.nextLevel}</p>
                                                <p className="text-lg font-bold text-purple-600">{user.level * 100 - user.xp} {t.xp}</p>
                                            </div>
                                        </div>
                                        <div className="h-4 bg-gray-100 rounded-full overflow-hidden mb-2">
                                            <div className="h-full bg-gradient-to-r from-violet-500 to-purple-600 transition-all duration-500 rounded-full" style={{ width: `${(user.xp / (user.level * 100)) * 100}%` }} />
                                        </div>
                                        <p className="text-center text-sm text-gray-500">{user.xp} / {user.level * 100} {t.xp}</p>
                                    </div>
                                    
                                    {/* Daily Missions */}
                                    <div className="premium-card rounded-3xl p-6">
                                        <h3 className="font-bold text-gray-800 mb-4 flex items-center gap-2">
                                            <span className="text-2xl">ğŸ“‹</span> {t.dailyMissions}
                                        </h3>
                                        <div className="space-y-3">
                                            {DAILY_MISSIONS.map(mission => {
                                                const stats = { todayCompletions, completionRate, habitsCount: habits.length };
                                                const isComplete = mission.check(stats);
                                                const claimed = storage.get(`mission_${mission.id}_${today}`, false);
                                                return (
                                                    <div key={mission.id} className={`rounded-xl p-4 flex items-center justify-between ${isComplete ? 'bg-green-50 border border-green-200' : 'bg-gray-50'}`}>
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-2xl">{mission.emoji}</span>
                                                            <div>
                                                                <p className={`font-medium ${isComplete ? 'text-green-700' : 'text-gray-700'}`}>{t[mission.key]}</p>
                                                                <p className="text-xs text-purple-600 font-bold">+{mission.xp} {t.xp}</p>
                                                            </div>
                                                        </div>
                                                        {isComplete && !claimed ? (
                                                            <button 
                                                                onClick={() => {
                                                                    storage.set(`mission_${mission.id}_${today}`, true);
                                                                    const newXp = user.xp + mission.xp;
                                                                    const newLevel = Math.floor(newXp / 100) + 1;
                                                                    if (newLevel > user.level) {
                                                                        setNewLevel(newLevel);
                                                                        setShowLevelUp(true);
                                                                        setShowConfetti(true);
                                                                        setTimeout(() => { setShowLevelUp(false); setShowConfetti(false); }, 3000);
                                                                    }
                                                                    setUser(u => ({ ...u, xp: newXp % 100, level: newLevel }));
                                                                }}
                                                                className="px-4 py-2 bg-gradient-to-r from-green-400 to-emerald-500 text-white rounded-xl font-bold text-sm"
                                                            >
                                                                {t.claimReward}
                                                            </button>
                                                        ) : claimed ? (
                                                            <span className="px-4 py-2 bg-green-100 text-green-600 rounded-xl font-bold text-sm">âœ“ {t.claimed}</span>
                                                        ) : (
                                                            <span className="px-4 py-2 bg-gray-100 text-gray-400 rounded-xl font-bold text-sm">{t.inProgress}</span>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                    
                                    {/* Weekly Missions */}
                                    <div className={`premium-card rounded-3xl p-6 relative overflow-hidden ${!hasProAccess ? 'opacity-60' : ''}`}>
                                        <h3 className="font-bold text-gray-800 mb-4 flex items-center gap-2">
                                            <span className="text-2xl">ğŸ…</span> {t.weeklyMissions}
                                        </h3>
                                        <div className="space-y-3">
                                            {WEEKLY_MISSIONS.map(mission => {
                                                const stats = { daysActiveThisWeek: user.perfectDays || 0, longestStreak: user.longestStreak || 0, friendsCount: friends.length };
                                                const isComplete = hasProAccess && mission.check(stats);
                                                return (
                                                    <div key={mission.id} className={`rounded-xl p-4 flex items-center justify-between ${isComplete ? 'bg-green-50 border border-green-200' : 'bg-gray-50'}`}>
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-2xl">{mission.emoji}</span>
                                                            <div>
                                                                <p className={`font-medium ${isComplete ? 'text-green-700' : 'text-gray-700'}`}>{t[mission.key]}</p>
                                                                <p className="text-xs text-purple-600 font-bold">+{mission.xp} {t.xp}</p>
                                                            </div>
                                                        </div>
                                                        {isComplete ? (
                                                            <span className="px-4 py-2 bg-green-100 text-green-600 rounded-xl font-bold text-sm">âœ“</span>
                                                        ) : (
                                                            <span className="px-4 py-2 bg-gray-100 text-gray-400 rounded-xl font-bold text-sm">{t.inProgress}</span>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                        {!hasProAccess && <LockedOverlay onUpgrade={handleUpgrade} />}
                                    </div>
                                    
                                    {/* Level Rewards */}
                                    <div className="premium-card rounded-3xl p-6">
                                        <h3 className="font-bold text-gray-800 mb-4 flex items-center gap-2">
                                            <span className="text-2xl">ğŸ</span> {t.levelRewards}
                                        </h3>
                                        <div className="grid grid-cols-2 gap-3">
                                            {LEVEL_REWARDS.map(reward => {
                                                const unlocked = user.level >= reward.level;
                                                const claimed = storage.get(`reward_level_${reward.level}`, false);
                                                return (
                                                    <div key={reward.level} className={`rounded-xl p-4 text-center ${unlocked ? 'bg-gradient-to-br from-amber-50 to-orange-50 border border-amber-200' : 'bg-gray-50'}`}>
                                                        <div className={`text-3xl mb-2 ${!unlocked && 'grayscale opacity-50'}`}>{reward.emoji}</div>
                                                        <p className={`text-sm font-bold ${unlocked ? 'text-amber-700' : 'text-gray-400'}`}>{t[reward.key]}</p>
                                                        <p className="text-xs text-gray-500">{t.level} {reward.level}</p>
                                                        {unlocked && !claimed && (
                                                            <button 
                                                                onClick={() => storage.set(`reward_level_${reward.level}`, true)}
                                                                className="mt-2 px-3 py-1 bg-amber-500 text-white rounded-lg text-xs font-bold"
                                                            >
                                                                {t.claimReward}
                                                            </button>
                                                        )}
                                                        {claimed && <p className="mt-2 text-xs text-green-600 font-bold">âœ“ {t.claimed}</p>}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                    
                                    {/* All Achievements */}
                                    <div className="premium-card rounded-3xl p-6">
                                        <h3 className="font-bold text-gray-800 mb-4 flex items-center gap-2">
                                            <span className="text-2xl">ğŸ†</span> {t.achievementsUnlocked}
                                        </h3>
                                        <div className="grid grid-cols-3 gap-3">
                                            {ACHIEVEMENTS.map(achievement => {
                                                const stats = { 
                                                    totalCompletions: user.totalCompletions || 0,
                                                    earlyCompletions: 0,
                                                    lateCompletions: 0,
                                                    weekendPerfect: 0,
                                                    longestStreak: user.longestStreak || 0,
                                                    friendsCount: friends.length,
                                                    perfectDays: user.perfectDays || 0,
                                                    level: user.level,
                                                    daysUsed: Math.floor((new Date() - new Date(storage.get('momentum_first_use', new Date().toISOString()))) / (1000 * 60 * 60 * 24)),
                                                    speedRuns: 0,
                                                    habitsCreated: habits.length,
                                                };
                                                const unlocked = achievement.check(stats);
                                                return (
                                                    <div key={achievement.id} className={`rounded-xl p-3 text-center ${unlocked ? 'bg-gradient-to-br from-amber-50 to-orange-50 border border-amber-200' : 'bg-gray-50'}`}>
                                                        <div className={`text-3xl mb-1 ${!unlocked && 'grayscale opacity-40'}`}>{achievement.emoji}</div>
                                                        <p className={`text-xs font-bold ${unlocked ? 'text-amber-700' : 'text-gray-400'}`}>{t[achievement.key]}</p>
                                                        {unlocked && <p className="text-green-500 text-xs mt-1">âœ“</p>}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'settings' && (
                                <div className="px-5 py-6 space-y-6 animate-slide-down">
                                    {/* Subscription Status Card */}
                                    {hasMaxAccess ? (
                                        <div className="rounded-3xl p-6 text-white" style={{background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)'}}>
                                            <div className="flex items-center gap-4">
                                                <div className="text-5xl">ğŸ’</div>
                                                <div>
                                                    <h2 className="text-2xl font-black">{t.maxSubscription}</h2>
                                                    <p className="text-white/80">{t.since} {new Date(proSince).toLocaleDateString()}</p>
                                                </div>
                                            </div>
                                        </div>
                                    ) : isPro ? (
                                        <div className="bg-gradient-to-r from-amber-400 via-orange-500 to-pink-500 rounded-3xl p-6 text-white pro-glow">
                                            <div className="flex items-center gap-4"><div className="text-5xl animate-crown">ğŸ‘‘</div><div><h2 className="text-2xl font-black">{t.proMember}</h2><p className="text-white/80">{t.since} {new Date(proSince).toLocaleDateString()}</p></div></div>
                                            <button onClick={handleUpgradeMax} className="w-full mt-4 py-3 bg-gradient-to-r from-cyan-400 to-blue-500 text-white rounded-xl font-bold">ğŸ’ {t.upgradeToMax}</button>
                                        </div>
                                    ) : isTrialActive ? (
                                        <div className="bg-gradient-to-r from-green-400 to-emerald-500 rounded-3xl p-6 text-white">
                                            <div className="flex items-center gap-4"><div className="text-5xl">âœ¨</div><div><h2 className="text-2xl font-black">{t.proTrialActive}</h2><p className="text-white/80">{trialDaysLeft} {t.daysRemaining}</p></div></div>
                                            <button onClick={handleUpgrade} className="w-full mt-4 py-3 bg-white/20 text-white rounded-xl font-bold">{t.upgradeToKeepPro}</button>
                                        </div>
                                    ) : (
                                        <div className="premium-card rounded-3xl p-6">
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-4"><div className="text-4xl">ğŸ”“</div><div><h2 className="font-bold text-gray-800">{t.freePlan}</h2><p className="text-sm text-gray-500">{habits.length}/{FREE_LIMITS.maxHabits} {t.habits}</p></div></div>
                                                <button onClick={handleUpgrade} className="px-4 py-2 bg-gradient-to-r from-green-400 to-emerald-500 text-white font-bold rounded-xl shadow-lg">{t.freeTrial}</button>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {/* MAX Upgrade Card for Pro Users */}
                                    {hasProAccess && !hasMaxAccess && (
                                        <div className="rounded-3xl p-6 border-2 border-dashed border-cyan-300" style={{background: 'linear-gradient(135deg, rgba(26,26,46,0.05) 0%, rgba(22,33,62,0.1) 100%)'}}>
                                            <div className="flex items-center gap-4 mb-4">
                                                <div className="text-4xl">ğŸ’</div>
                                                <div>
                                                    <h3 className="font-bold text-gray-800">{t.upgradeToMax}</h3>
                                                    <p className="text-sm text-gray-500">{t.everythingInPro}</p>
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-2 mb-4">
                                                {MAX_FEATURES.slice(0, 4).map(f => (
                                                    <div key={f.id} className="flex items-center gap-2 text-sm text-gray-600">
                                                        <span>{f.emoji}</span>
                                                        <span>{t[f.id]}</span>
                                                    </div>
                                                ))}
                                            </div>
                                            <button onClick={handleUpgradeMax} className="w-full py-3 bg-gradient-to-r from-cyan-400 to-blue-500 text-white rounded-xl font-bold">ğŸ’ {t.upgradeToMax}</button>
                                        </div>
                                    )}
                                    
                                    {/* Friends Card */}
                                    <div className="premium-card rounded-3xl p-6">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-4">
                                                <div className="text-4xl">ğŸ‘¥</div>
                                                <div>
                                                    <h3 className="font-bold text-gray-800">{t.friends}</h3>
                                                    <p className="text-sm text-gray-500">{friends.length} {t.friends.toLowerCase()}</p>
                                                </div>
                                            </div>
                                            <button onClick={() => setShowFriendsModal(true)} className="px-4 py-2 bg-gradient-to-r from-violet-500 to-purple-600 text-white font-bold rounded-xl shadow-lg">
                                                {hasProAccess ? t.viewProfile : 'ğŸ”’'}
                                            </button>
                                        </div>
                                        {hasProAccess && (
                                            <div className="mt-4 pt-4 border-t border-gray-100">
                                                <p className="text-sm text-gray-500 mb-2">{t.yourId}:</p>
                                                <code className="block bg-gray-50 px-4 py-2 rounded-xl font-mono text-purple-600 text-center">{userId}</code>
                                            </div>
                                        )}
                                    </div>
                                    
                                    {/* Language Selector */}
                                    <LanguageSelector currentLang={lang} onChangeLang={setLang} />
                                    
                                    <div className="premium-card rounded-3xl p-6">
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="font-bold text-gray-800">{t.theme}</h3>
                                            {hasProAccess && <span className="text-green-500 text-sm font-bold">{t.allUnlocked}</span>}
                                        </div>
                                        <div className="grid grid-cols-3 gap-3">
                                            {Object.entries(allThemes).map(([name, gradient]) => {
                                                const isAvailable = hasProAccess || name === 'purple';
                                                return (<button key={name} onClick={() => isAvailable ? setUser(u => ({ ...u, theme: name })) : handleUpgrade()} className={`relative h-14 rounded-2xl bg-gradient-to-r ${gradient} transition-all ${user.theme === name ? 'ring-4 ring-white ring-offset-2 shadow-lg' : ''} ${!isAvailable ? 'opacity-40' : ''}`}><span className="text-white font-semibold text-xs capitalize">{name}</span>{!isAvailable && <div className="absolute inset-0 flex items-center justify-center bg-black/40 rounded-2xl"><span>ğŸ”’</span></div>}</button>);
                                            })}
                                        </div>
                                    </div>
                                    
                                    <div className="premium-card rounded-3xl p-6">
                                        <h3 className="font-bold text-gray-800 mb-4">{t.proFeatures}</h3>
                                        <div className="space-y-3">
                                            {PREMIUM_FEATURES.map(f => (<div key={f.id} className="flex items-center justify-between"><div className="flex items-center gap-3"><span className="text-xl">{f.emoji}</span><span className="text-gray-700">{t[`feat_${f.id}`]}</span></div>{hasProAccess ? <span className="text-green-500 font-bold">âœ“</span> : <span className="text-gray-400">ğŸ”’</span>}</div>))}
                                        </div>
                                        {!hasProAccess && (<button onClick={handleUpgrade} className="w-full mt-4 py-3 bg-gradient-to-r from-green-400 to-emerald-500 text-white font-bold rounded-xl shadow-lg">{t.startFreeTrialBtn}</button>)}
                                    </div>
                                    
                                    <div className="premium-card rounded-3xl p-6 text-center"><div className="text-4xl mb-3">âœ¨</div><h3 className="font-bold text-gray-800 text-lg">{t.appName}</h3><p className="text-sm text-gray-500">{t.appVersion}</p></div>
                                    <button onClick={() => { 
                                        if (confirm('Reset all data? Your subscription will be preserved.')) { 
                                            // Save subscription-related data before clearing
                                            const trialData = storage.get('momentum_trial_start', null);
                                            const proData = storage.get('momentum_pro', false);
                                            const maxData = storage.get('momentum_max', false);
                                            const proSinceData = storage.get('momentum_pro_since', null);
                                            const langData = storage.get('momentum_lang', 'en');
                                            
                                            // Clear all data
                                            localStorage.clear();
                                            
                                            // Restore subscription data
                                            if (trialData) storage.set('momentum_trial_start', trialData);
                                            if (proData) storage.set('momentum_pro', proData);
                                            if (maxData) storage.set('momentum_max', maxData);
                                            if (proSinceData) storage.set('momentum_pro_since', proSinceData);
                                            storage.set('momentum_lang', langData);
                                            
                                            window.location.reload(); 
                                        } 
                                    }} className="w-full py-4 bg-red-50 text-red-600 rounded-2xl font-semibold">{t.resetAllData}</button>
                                </div>
                            )}
                        </main>

                        <nav className="tab-bar fixed bottom-0 left-0 right-0 border-t border-gray-100 px-2 py-2 safe-area-bottom">
                            <div className="flex justify-around">
                                {[{ id: 'habits', icon: 'ğŸ¯', label: t.habits }, { id: 'analytics', icon: 'ğŸ“Š', label: t.analytics }, { id: 'achievements', icon: 'ğŸ†', label: t.rewards }, { id: 'settings', icon: 'âš™ï¸', label: t.settings }].map(tab => (
                                    <button key={tab.id} onClick={() => { SoundHelper.playTap(); setActiveTab(tab.id); }} className={`btn-3d flex flex-col items-center py-2 px-3 sm:px-4 rounded-2xl transition-all ${activeTab === tab.id ? 'bg-gradient-to-r from-violet-500 to-purple-600 text-white shadow-lg' : 'text-gray-400'}`}><span className="text-lg sm:text-xl mb-0.5">{tab.icon}</span><span className="text-[10px] sm:text-xs font-semibold">{tab.label}</span></button>
                                ))}
                            </div>
                        </nav>

                        {showTemplates && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 flex items-end justify-center" onClick={() => setShowTemplates(false)}>
                                <div className="bg-white rounded-t-3xl w-full max-w-lg p-6 animate-slide-up max-h-[85vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                    <div className="flex items-center justify-between mb-4">
                                        <div>
                                            <h2 className="text-2xl font-black text-gray-800">{t.templates}</h2>
                                            <p className="text-sm text-gray-500">
                                                {templateCategory === 'all' ? t.quickStartHabits : categories.find(c => c.key === templateCategory)?.label}
                                            </p>
                                        </div>
                                        <button onClick={() => setShowTemplates(false)} className="text-gray-400 text-2xl">Ã—</button>
                                    </div>
                                    
                                    {/* Category tabs in modal */}
                                    <div className="flex gap-2 overflow-x-auto pb-3 mb-3 -mx-2 px-2">
                                        {categories.map(cat => (
                                            <button 
                                                key={cat.key} 
                                                onClick={() => setTemplateCategory(cat.key)} 
                                                className={`px-3 py-1.5 rounded-full text-xs font-semibold whitespace-nowrap transition-all ${templateCategory === cat.key ? 'bg-gradient-to-r from-violet-500 to-purple-600 text-white shadow-md' : 'bg-gray-100 text-gray-600'}`}
                                            >
                                                {cat.label}
                                            </button>
                                        ))}
                                    </div>
                                    
                                    {!canAddHabit && (<div className="bg-amber-50 border border-amber-200 rounded-2xl p-4 mb-4"><p className="text-amber-700 text-sm font-medium">ğŸ”’ {t.startTrialForMore}</p><button onClick={() => { setShowTemplates(false); handleUpgrade(); }} className="mt-2 w-full py-2 bg-gradient-to-r from-green-400 to-emerald-500 text-white font-bold rounded-xl">{t.startTrial}</button></div>)}
                                    <div className="space-y-2">
                                        {getLocalizedTemplates(templateCategory).map((template, i) => (<button key={i} onClick={() => addHabit(template)} disabled={!canAddHabit} className={`w-full flex items-center gap-4 p-4 bg-gray-50 hover:bg-gray-100 rounded-2xl text-left ${!canAddHabit ? 'opacity-50' : ''}`}><div className={`w-12 h-12 rounded-xl bg-gradient-to-br ${template.color} flex items-center justify-center text-xl shadow-md`}>{template.emoji}</div><div className="flex-1"><p className="font-semibold text-gray-800">{template.name}</p><p className="text-xs text-gray-400">{t.goal}: {template.goal} {template.unit}</p></div></button>))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {showAddHabit && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 flex items-end justify-center" onClick={() => setShowAddHabit(false)}>
                                <div className="bg-white rounded-t-3xl w-full max-w-lg p-6 animate-slide-up" onClick={e => e.stopPropagation()}>
                                    <div className="flex items-center justify-between mb-6"><h2 className="text-2xl font-black text-gray-800">{t.newHabit}</h2><button onClick={() => setShowAddHabit(false)} className="text-gray-400 text-2xl">Ã—</button></div>
                                    <div className="space-y-4">
                                        <div><label className="text-sm font-medium text-gray-600">{t.habitName}</label><input type="text" id="habitName" placeholder={t.habitNamePlaceholder} className="w-full mt-1 px-4 py-3 bg-gray-50 rounded-2xl outline-none text-gray-800" dir={isRTL ? 'rtl' : 'ltr'} /></div>
                                        <div><label className="text-sm font-medium text-gray-600">{t.dailyGoal}</label><div className="flex gap-2 mt-1"><input type="number" id="habitGoal" defaultValue="1" min="1" className="flex-1 px-4 py-3 bg-gray-50 rounded-2xl outline-none text-gray-800" /><input type="text" id="habitUnit" placeholder={t.unit} className="flex-1 px-4 py-3 bg-gray-50 rounded-2xl outline-none text-gray-800" dir={isRTL ? 'rtl' : 'ltr'} /></div></div>
                                        <div><label className="text-sm font-medium text-gray-600">{t.category}</label><select id="habitCategory" className="w-full mt-1 px-4 py-3 bg-gray-50 rounded-2xl outline-none text-gray-800">{categories.filter(c => c.key !== 'all').map(c => (<option key={c.key} value={c.label}>{c.label}</option>))}</select></div>
                                        <button onClick={() => { const n = document.getElementById('habitName').value; if (n) addHabit({ name: n, category: document.getElementById('habitCategory').value, goal: parseInt(document.getElementById('habitGoal').value) || 1, unit: document.getElementById('habitUnit').value }); }} className="w-full py-4 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-2xl font-bold text-lg shadow-lg">{t.createHabit}</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showHabitDetail && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 flex items-end justify-center" onClick={() => setShowHabitDetail(null)}>
                                <div className="relative bg-white rounded-t-3xl w-full max-w-lg p-6 animate-slide-up" onClick={e => e.stopPropagation()}>
                                    {/* Close Button - properly positioned */}
                                    <button 
                                        onClick={() => { SoundHelper.playClick(); setShowHabitDetail(null); }} 
                                        className="absolute top-4 right-4 w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-500 hover:bg-gray-200 transition-all z-10"
                                    >
                                        âœ•
                                    </button>
                                    
                                    <div className="flex items-center gap-4 mb-6 pr-12"><div className={`w-16 h-16 rounded-2xl bg-gradient-to-br ${showHabitDetail.color} flex items-center justify-center text-3xl shadow-lg`}>{showHabitDetail.emoji}</div><div><h2 className="text-xl font-bold text-gray-800">{showHabitDetail.name}</h2><p className="text-sm text-gray-500">{showHabitDetail.category}</p></div></div>
                                    <div className="grid grid-cols-2 gap-4 mb-6">
                                        <div className="bg-gradient-to-br from-orange-50 to-red-50 rounded-2xl p-4 text-center"><p className="text-3xl font-black text-orange-600">ğŸ”¥ {showHabitDetail.streak}</p><p className="text-sm text-gray-600">{t.currentStreak}</p></div>
                                        <div className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-4 text-center"><p className="text-3xl font-black text-purple-600">{showHabitDetail.completedDates?.length || 0}</p><p className="text-sm text-gray-600">{t.daysCompleted}</p></div>
                                    </div>
                                    
                                    {/* Reminder Button */}
                                    <button 
                                        onClick={() => { SoundHelper.playTap(); setShowHabitDetail(null); setShowReminderModal(showHabitDetail); }}
                                        className={`btn-3d w-full py-3 mb-3 rounded-2xl font-semibold flex items-center justify-center gap-2 ${hasMaxAccess ? 'bg-gradient-to-r from-cyan-50 to-blue-50 text-cyan-600' : 'bg-gray-50 text-gray-500'}`}
                                    >
                                        <span>ğŸ””</span> {t.setReminder}
                                        {!hasMaxAccess && <span className="text-xs bg-gradient-to-r from-cyan-400 to-blue-500 text-white px-2 py-0.5 rounded-full">MAX</span>}
                                    </button>
                                    
                                    <button onClick={() => { SoundHelper.playClick(); deleteHabit(showHabitDetail.id); }} className="btn-3d w-full py-3 bg-red-50 text-red-600 rounded-2xl font-semibold mb-3">{t.deleteHabit}</button>
                                    
                                    {/* Close Button at bottom */}
                                    <button onClick={() => { SoundHelper.playClick(); setShowHabitDetail(null); }} className="btn-3d w-full py-3 bg-gray-100 text-gray-600 rounded-2xl font-semibold">{t.close}</button>
                                </div>
                            </div>
                        )}
                        
                        {/* Quick Add Modal for Large Goals */}
                        {showQuickAdd && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowQuickAdd(null)}>
                                <div className="relative bg-white rounded-3xl w-full max-w-sm p-6 animate-bounce-in" onClick={e => e.stopPropagation()}>
                                    {/* Close button - positioned relative to container */}
                                    <button 
                                        onClick={() => { SoundHelper.playClick(); setShowQuickAdd(null); }} 
                                        className="absolute -top-2 -right-2 w-10 h-10 bg-white rounded-full flex items-center justify-center text-gray-500 shadow-lg border border-gray-100 hover:bg-gray-50 transition-all z-10"
                                    >
                                        âœ•
                                    </button>
                                    
                                    <div className="text-center mb-6">
                                        <div className={`w-16 h-16 mx-auto rounded-2xl bg-gradient-to-br ${showQuickAdd.color} flex items-center justify-center text-3xl shadow-lg mb-3`}>{showQuickAdd.emoji}</div>
                                        <h3 className="text-xl font-bold text-gray-800">{t.quickAdd}</h3>
                                        <p className="text-sm text-gray-500">{showQuickAdd.name}</p>
                                        <p className="text-lg font-bold text-purple-600 mt-2">
                                            {showQuickAdd.progress?.[today] || 0} / {showQuickAdd.goal} {showQuickAdd.unit}
                                        </p>
                                    </div>
                                    
                                    {/* Quick increment buttons based on goal size */}
                                    <div className="grid grid-cols-3 gap-3 mb-4">
                                        {(() => {
                                            const goal = showQuickAdd.goal;
                                            const currentProgress = showQuickAdd.progress?.[today] || 0;
                                            const remaining = goal - currentProgress;
                                            let increments = [];
                                            
                                            // Smart increments based on goal
                                            if (goal >= 10000) increments = [100, 500, 1000, 2500, 5000];
                                            else if (goal >= 1000) increments = [50, 100, 250, 500, 1000];
                                            else if (goal >= 100) increments = [10, 25, 50, 100];
                                            else if (goal >= 30) increments = [5, 10, 15, 30];
                                            else increments = [1, 5, 10, Math.ceil(goal/2)];
                                            
                                            // Filter to show only relevant increments
                                            increments = [...new Set(increments)].filter(i => i <= remaining).slice(0, 6);
                                            
                                            // Always add "Complete" button if remaining is reasonable
                                            if (remaining > 0 && remaining <= goal && !increments.includes(remaining)) {
                                                increments.push(remaining);
                                            }
                                            
                                            return increments.map(inc => (
                                                <button 
                                                    key={inc}
                                                    onClick={() => { 
                                                        SoundHelper.playSuccess();
                                                        incrementHabit(showQuickAdd.id, inc); 
                                                        setShowQuickAdd(null);
                                                    }}
                                                    className={`btn-3d py-4 rounded-2xl font-bold text-white bg-gradient-to-r ${showQuickAdd.color} shadow-md text-lg ${inc === remaining ? 'ring-2 ring-green-400 ring-offset-2' : ''}`}
                                                >
                                                    {inc === remaining ? `+${inc} âœ“` : `+${inc}`}
                                                </button>
                                            ));
                                        })()}
                                    </div>
                                    
                                    {/* Custom amount input */}
                                    <div className="flex gap-2 mb-4">
                                        <input 
                                            type="number" 
                                            id="customAmount"
                                            placeholder={t.enterAmount}
                                            className="flex-1 px-4 py-3 bg-gray-50 rounded-2xl outline-none text-gray-800 text-center font-bold text-lg"
                                            min="1"
                                        />
                                        <button 
                                            onClick={() => { 
                                                const amt = parseInt(document.getElementById('customAmount').value);
                                                if (amt > 0) {
                                                    SoundHelper.playSuccess();
                                                    incrementHabit(showQuickAdd.id, amt); 
                                                    setShowQuickAdd(null);
                                                }
                                            }}
                                            className={`btn-3d px-6 py-3 rounded-2xl font-bold text-white bg-gradient-to-r ${showQuickAdd.color} shadow-md`}
                                        >
                                            {t.add}
                                        </button>
                                    </div>
                                    
                                    {/* Close button at bottom */}
                                    <button 
                                        onClick={() => { SoundHelper.playClick(); setShowQuickAdd(null); }}
                                        className="w-full py-3 bg-gray-100 text-gray-600 rounded-2xl font-semibold"
                                    >
                                        {t.close}
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        {/* AI Coach Modal */}
                        {showAICoach && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end justify-center" onClick={() => setShowAICoach(false)}>
                                <div className="relative bg-white rounded-t-3xl w-full max-w-lg p-6 animate-slide-up max-h-[80vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                    <button 
                                        onClick={() => { SoundHelper.playClick(); setShowAICoach(false); }} 
                                        className="absolute -top-2 -right-2 w-10 h-10 bg-white rounded-full flex items-center justify-center text-gray-500 shadow-lg border border-gray-100 hover:bg-gray-50 z-10"
                                    >
                                        âœ•
                                    </button>
                                    
                                    <div className="text-center mb-6">
                                        <div className="w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center text-4xl shadow-lg mb-3 float-gentle">ğŸ¤–</div>
                                        <h2 className="text-2xl font-black text-gray-800">{t.aiCoach}</h2>
                                        <p className="text-sm text-gray-500">{t.personalizedAdvice}</p>
                                    </div>
                                    
                                    {aiAdvice ? (
                                        <div className="space-y-4">
                                            {aiAdvice.map((advice, i) => (
                                                <div key={i} className="card-3d bg-gradient-to-br from-cyan-50 to-blue-50 rounded-2xl p-4 border border-cyan-200">
                                                    <div className="flex items-start gap-3">
                                                        <span className="text-2xl">{advice.emoji}</span>
                                                        <div>
                                                            <p className="font-bold text-gray-800">{advice.title}</p>
                                                            <p className="text-sm text-gray-600 mt-1">{advice.message}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                            <button 
                                                onClick={() => setAiAdvice(null)}
                                                className="btn-3d w-full py-3 bg-gray-100 text-gray-600 rounded-2xl font-semibold"
                                            >
                                                {t.getAdvice} ğŸ”„
                                            </button>
                                        </div>
                                    ) : (
                                        <button 
                                            onClick={() => {
                                                SoundHelper.playSuccess();
                                                // Generate AI advice based on habits
                                                const advice = [];
                                                const completedToday = habits.filter(h => (h.progress?.[today] || 0) >= (h.goal || 1)).length;
                                                const totalHabits = habits.length;
                                                const avgStreak = habits.reduce((sum, h) => sum + (h.streak || 0), 0) / Math.max(habits.length, 1);
                                                
                                                if (completedToday < totalHabits) {
                                                    const remaining = habits.filter(h => (h.progress?.[today] || 0) < (h.goal || 1));
                                                    advice.push({
                                                        emoji: 'ğŸ¯',
                                                        title: lang === 'ar' ? 'Ø£ÙƒÙ…Ù„ Ø¹Ø§Ø¯Ø§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…' : 'Complete Your Habits Today',
                                                        message: lang === 'ar' 
                                                            ? `Ù„Ø¯ÙŠÙƒ ${remaining.length} Ø¹Ø§Ø¯Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ© Ø§Ù„ÙŠÙˆÙ…. Ø§Ø¨Ø¯Ø£ Ø¨Ù€ "${remaining[0]?.name}" Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø²Ø®Ù…Ùƒ!`
                                                            : `You have ${remaining.length} habits left today. Start with "${remaining[0]?.name}" to keep your momentum going!`
                                                    });
                                                }
                                                
                                                if (avgStreak < 3) {
                                                    advice.push({
                                                        emoji: 'ğŸ”¥',
                                                        title: lang === 'ar' ? 'Ø§Ø¨Ù†Ù Ø³Ù„Ø³Ù„Ø© Ø£Ù‚ÙˆÙ‰' : 'Build Stronger Streaks',
                                                        message: lang === 'ar'
                                                            ? 'Ø­Ø§ÙˆÙ„ Ø¥ÙƒÙ…Ø§Ù„ Ø¹Ø§Ø¯Ø§ØªÙƒ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª ÙƒÙ„ ÙŠÙˆÙ…. Ø§Ù„Ø§ØªØ³Ø§Ù‚ ÙŠØ¨Ù†ÙŠ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª!'
                                                            : 'Try completing your habits at the same time each day. Consistency builds habits!'
                                                    });
                                                } else if (avgStreak >= 7) {
                                                    advice.push({
                                                        emoji: 'ğŸŒŸ',
                                                        title: lang === 'ar' ? 'Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹!' : 'Amazing Progress!',
                                                        message: lang === 'ar'
                                                            ? `Ù…ØªÙˆØ³Ø· Ø³Ù„Ø³Ù„ØªÙƒ Ù‡Ùˆ ${Math.round(avgStreak)} Ø£ÙŠØ§Ù…. Ø§Ø³ØªÙ…Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø§Ø¦Ø¹!`
                                                            : `Your average streak is ${Math.round(avgStreak)} days. Keep up the fantastic work!`
                                                    });
                                                }
                                                
                                                if (totalHabits < 3) {
                                                    advice.push({
                                                        emoji: 'â•',
                                                        title: lang === 'ar' ? 'Ø£Ø¶Ù Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¹Ø§Ø¯Ø§Øª' : 'Add More Habits',
                                                        message: lang === 'ar'
                                                            ? 'ÙÙƒØ± ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ø¯Ø© ØµØ­ÙŠØ© Ø£Ùˆ ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„ØªÙˆØ§Ø²Ù† ÙÙŠ Ø±ÙˆØªÙŠÙ†Ùƒ.'
                                                            : 'Consider adding a new health or learning habit to balance your routine.'
                                                    });
                                                }
                                                
                                                if (user.level < 5) {
                                                    advice.push({
                                                        emoji: 'â¬†ï¸',
                                                        title: lang === 'ar' ? 'Ø§Ø±ÙØ¹ Ù…Ø³ØªÙˆØ§Ùƒ' : 'Level Up Faster',
                                                        message: lang === 'ar'
                                                            ? 'Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø¹Ø§Ø¯Ø§ØªÙƒ ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· XP Ø¥Ø¶Ø§ÙÙŠØ© ÙˆØ§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø´ÙƒÙ„ Ø£Ø³Ø±Ø¹!'
                                                            : 'Complete all your habits daily to earn bonus XP and reach the next level faster!'
                                                    });
                                                }
                                                
                                                // Always add at least one tip
                                                if (advice.length === 0) {
                                                    advice.push({
                                                        emoji: 'ğŸ’ª',
                                                        title: lang === 'ar' ? 'Ø§Ø³ØªÙ…Ø±!' : 'Keep Going!',
                                                        message: lang === 'ar'
                                                            ? 'Ø£Ù†Øª ØªÙ‚ÙˆÙ… Ø¨Ø¹Ù…Ù„ Ø±Ø§Ø¦Ø¹! Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø¹Ø§Ø¯Ø§ØªÙƒ ÙƒÙ„ ÙŠÙˆÙ….'
                                                            : "You're doing great! Keep maintaining your habits every day."
                                                    });
                                                }
                                                
                                                setAiAdvice(advice);
                                            }}
                                            className="btn-3d btn-neon w-full py-4 bg-gradient-to-r from-cyan-400 to-blue-500 text-white rounded-2xl font-bold text-lg shadow-lg"
                                        >
                                            âœ¨ {t.getAdvice}
                                        </button>
                                    )}
                                    
                                    <button 
                                        onClick={() => { SoundHelper.playClick(); setShowAICoach(false); }} 
                                        className="btn-3d w-full py-3 mt-4 bg-gray-100 text-gray-600 rounded-2xl font-semibold"
                                    >
                                        {t.close}
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        {/* Invite Friend Modal */}
                        {showInviteModal && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowInviteModal(false)}>
                                <div className="relative bg-white rounded-3xl w-full max-w-sm p-6 animate-bounce-in" onClick={e => e.stopPropagation()}>
                                    {/* Close button */}
                                    <button 
                                        onClick={() => { SoundHelper.playClick(); setShowInviteModal(false); }} 
                                        className="absolute -top-2 -right-2 w-10 h-10 bg-white rounded-full flex items-center justify-center text-gray-500 shadow-lg border border-gray-100 hover:bg-gray-50 transition-all z-10"
                                    >
                                        âœ•
                                    </button>
                                    
                                    <div className="text-center mb-6">
                                        <div className="text-6xl mb-3 float-gentle">ğŸ</div>
                                        <h2 className="text-2xl font-black text-gray-800 mb-2">{t.inviteFriend}</h2>
                                        <p className="text-gray-500 text-sm">{t.inviteDesc}</p>
                                        <div className="mt-3 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-3">
                                            <p className="text-green-600 font-semibold text-sm">ğŸ‰ {t.inviteReward}</p>
                                        </div>
                                    </div>
                                    
                                    {/* Success/Error Message */}
                                    {inviteMessage && (
                                        <div className={`mb-4 p-3 rounded-xl text-center font-semibold ${inviteMessage.type === 'success' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}`}>
                                            {inviteMessage.text}
                                        </div>
                                    )}
                                    
                                    {/* Your Invite Code */}
                                    <div className="mb-6">
                                        <p className="text-sm font-semibold text-gray-500 mb-2">{t.yourInviteCode}</p>
                                        <div className="bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-dashed border-purple-200 rounded-2xl p-4 text-center">
                                            <p className="text-2xl font-black text-purple-600 tracking-wider">{userId}</p>
                                        </div>
                                        <div className="flex gap-2 mt-3">
                                            <button 
                                                onClick={copyInviteLink}
                                                className="flex-1 btn-3d py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold flex items-center justify-center gap-2"
                                            >
                                                ğŸ“‹ {t.copyLink}
                                            </button>
                                            <button 
                                                onClick={shareInviteLink}
                                                className="flex-1 btn-3d py-3 bg-gradient-to-r from-green-400 to-emerald-500 text-white rounded-xl font-semibold flex items-center justify-center gap-2"
                                            >
                                                ğŸ“¤ {t.shareLink}
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {/* Enter Friend's Code */}
                                    <div className="border-t border-gray-100 pt-5">
                                        <p className="text-sm font-semibold text-gray-500 mb-2">{t.enterInviteCode}</p>
                                        <div className="flex gap-2">
                                            <input 
                                                type="text"
                                                value={inviteCodeInput}
                                                onChange={(e) => setInviteCodeInput(e.target.value.toUpperCase())}
                                                placeholder="MOM12345678"
                                                className="flex-1 px-4 py-3 bg-gray-50 rounded-xl outline-none text-gray-800 text-center font-bold tracking-wider uppercase"
                                                maxLength={15}
                                            />
                                            <button 
                                                onClick={() => applyInviteCode(inviteCodeInput)}
                                                className="btn-3d px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-bold"
                                            >
                                                {t.applyCode}
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {/* Close button at bottom */}
                                    <button 
                                        onClick={() => { SoundHelper.playClick(); setShowInviteModal(false); }}
                                        className="w-full py-3 mt-5 bg-gray-100 text-gray-600 rounded-2xl font-semibold"
                                    >
                                        {t.close}
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        {/* Review Popup Modal */}
                        {showReviewPopup && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => setShowReviewPopup(false)}>
                                <div className="relative bg-white rounded-3xl w-full max-w-sm p-6 animate-bounce-in text-center" onClick={e => e.stopPropagation()}>
                                    {/* Close button */}
                                    <button 
                                        onClick={() => { SoundHelper.playClick(); setShowReviewPopup(false); }} 
                                        className="absolute -top-2 -right-2 w-10 h-10 bg-white rounded-full flex items-center justify-center text-gray-500 shadow-lg border border-gray-100 hover:bg-gray-50 transition-all z-10"
                                    >
                                        âœ•
                                    </button>
                                    
                                    <div className="text-6xl mb-4 float-gentle">â­</div>
                                    <h2 className="text-2xl font-black text-gray-800 mb-2">{t.enjoyingApp}</h2>
                                    <p className="text-gray-500 mb-6">{t.rateUsDesc}</p>
                                    
                                    {/* Star Rating Display */}
                                    <div className="flex justify-center gap-2 mb-6">
                                        {[1, 2, 3, 4, 5].map(star => (
                                            <span key={star} className="text-4xl text-yellow-400 cursor-pointer hover:scale-110 transition-transform">â­</span>
                                        ))}
                                    </div>
                                    
                                    <button 
                                        onClick={() => { 
                                            SoundHelper.playSuccess();
                                            storage.set('momentum_reviewed', true);
                                            setShowReviewPopup(false);
                                            // In a real app, this would open app store
                                            alert(lang === 'ar' ? 'Ø´ÙƒØ±Ø§Ù‹ Ù„ØªÙ‚ÙŠÙŠÙ…Ùƒ! ğŸ’œ' : 'Thank you for your rating! ğŸ’œ');
                                        }}
                                        className="btn-3d w-full py-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-2xl font-bold text-lg shadow-lg mb-3"
                                    >
                                        {t.rateNow}
                                    </button>
                                    
                                    <div className="flex gap-2">
                                        <button 
                                            onClick={() => { 
                                                SoundHelper.playClick();
                                                setShowReviewPopup(false);
                                            }}
                                            className="flex-1 py-3 bg-gray-100 text-gray-600 rounded-2xl font-semibold"
                                        >
                                            {t.maybeLater}
                                        </button>
                                        <button 
                                            onClick={() => { 
                                                SoundHelper.playClick();
                                                storage.set('momentum_review_dismissed', true);
                                                setShowReviewPopup(false);
                                            }}
                                            className="flex-1 py-3 bg-gray-100 text-gray-400 rounded-2xl font-semibold"
                                        >
                                            {t.noThanks}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </LanguageContext.Provider>
            );
        }

        ReactDOM.render(<MomentumApp />, document.getElementById('root'));
    </script>
</body>
</html>
